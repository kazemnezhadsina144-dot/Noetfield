<!-- /gate/partners/deal/index.html — Noetfield Partner Deal Registration v3.1
     (Shell-aligned • enterprise clean • Deal ID + RID • tier suggestion • draft save • packet export • email builders • responsive) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Noetfield — Partner Deal Registration</title>
  <meta name="description" content="Register a partner-sourced opportunity to receive a Partner Deal ID, confirm tier eligibility, and route procurement safely — without sharing confidential data." />
  <meta name="robots" content="index,follow" />
  <meta name="author" content="Noetfield Systems Inc." />
  <meta name="theme-color" content="#07070b" />

  <link rel="canonical" href="https://www.noetfield.com/gate/partners/deal/" />
  <link rel="icon" href="/noetfield-favicon-512.png" type="image/png" />
  <link rel="apple-touch-icon" href="/noetfield-favicon-512.png" />

  <!-- OG -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Noetfield" />
  <meta property="og:title" content="Noetfield — Partner Deal Registration" />
  <meta property="og:description" content="Partner Deal ID, tier suggestion, 90-day protection (on acceptance), and procurement routing — non-confidential." />
  <meta property="og:url" content="https://www.noetfield.com/gate/partners/deal/" />
  <meta property="og:image" content="https://www.noetfield.com/noetfield-og.png" />

  <!-- LOCKED SHELL -->
  <link rel="stylesheet" href="/assets/noetfield-shell.css" />
  <script src="/assets/noetfield-shell.js" defer></script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Noetfield — Partner Deal Registration",
    "url":"https://www.noetfield.com/gate/partners/deal/",
    "isPartOf":{"@type":"WebSite","name":"Noetfield","url":"https://www.noetfield.com/"},
    "publisher":{"@type":"Organization","name":"Noetfield Systems Inc."}
  }
  </script>

  <style>
    /* Page hero */
    .hero{padding:18px 0 12px}
    .heroShell{
      position:relative;
      border-radius: calc(var(--radius) + 10px);
      border: 1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(1100px 520px at 16% 0%, rgba(200,163,73,.18), transparent 62%),
        radial-gradient(980px 520px at 92% 10%, rgba(122,167,255,.10), transparent 64%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.020));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .heroShell::before{
      content:"";
      position:absolute; inset:-1px;
      background: linear-gradient(120deg, rgba(200,163,73,.26), transparent 32%, rgba(255,255,255,.08) 68%, transparent);
      opacity:.44;
      pointer-events:none;
      mask-image: linear-gradient(180deg, black 0%, black 62%, transparent 96%);
    }
    .heroInner{padding: 22px 22px; position:relative; z-index:1}
    .kickerRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12.8px;
      white-space:nowrap;
    }
    .badge strong{color:var(--text); font-weight:950}
    .dot{width:8px; height:8px; border-radius:999px; background: rgba(200,163,73,.95); box-shadow: 0 0 0 3px rgba(200,163,73,.16);}
    .dot.good{background: rgba(115,211,155,.95); box-shadow: 0 0 0 3px rgba(115,211,155,.16);}
    .dot.warn{background: rgba(240,195,106,.95); box-shadow: 0 0 0 3px rgba(240,195,106,.16);}
    .dot.bad{background: rgba(255,122,122,.95); box-shadow: 0 0 0 3px rgba(255,122,122,.16);}

    h1{margin:12px 0 8px; font-size: clamp(26px, 2.6vw, 40px); line-height:1.08; letter-spacing:-0.7px}
    .lead{margin:0; color:var(--muted); font-size:15.6px; line-height:1.75; max-width: 980px}
    .lead strong{color:var(--text); font-weight:950}

    .notice{
      margin-top:12px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color:var(--muted2);
      font-size:12.8px;
      line-height:1.6;
    }
    .notice strong{ color:var(--text); font-weight:950; }
    .notice a{ border-bottom:1px solid rgba(255,255,255,.18); }

    .actions{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px}
    .actions .btn{min-height:44px}

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 1.12fr .88fr;
      gap:16px;
      margin: 14px 0 36px;
      align-items:start;
    }
    .card{
      border-radius:var(--radius);
      border:1px solid rgba(255,255,255,.11);
      background: linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.022));
      box-shadow: var(--shadow2);
      overflow:hidden;
      min-width:0;
    }
    .hd{ padding:18px 18px 0; display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap;}
    .bd{ padding:18px; }
    .cardTitle{ margin:0 0 6px; font-size:18px; letter-spacing:-0.2px; font-weight:950; }
    .muted{ color:var(--muted); line-height:1.7; margin:0; }

    .toolbar{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .toolbar .btn{min-height:40px}

    /* Form */
    .section{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius:16px;
      padding:14px;
      margin-top:12px;
    }
    .sectionTitle{font-weight:950; letter-spacing:-.2px; margin:0 0 6px; font-size:14px; color:var(--text)}
    .sectionDesc{margin:0 0 10px; color:var(--muted2); font-size:12.7px; line-height:1.6}

    .row{ display:grid; gap:10px; grid-template-columns: repeat(12, minmax(0, 1fr)); }
    .field{ grid-column: span 6; min-width:0; }
    .field.third{ grid-column: span 4; }
    .field.full{ grid-column: span 12; }

    .label{
      display:block;
      color: var(--muted2);
      font-size: 11px;
      letter-spacing: .28em;
      text-transform: uppercase;
      margin: 0 0 6px;
    }
    .input, .select, .textarea{
      width:100%;
      padding:10px 11px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(5,8,20,.72);
      color: rgba(255,255,255,.92);
      font-size:13px;
      outline:none;
    }
    .textarea{ resize: vertical; min-height: 120px; }

    .checkgrid{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; margin-top:10px}
    .check{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .check input{width:18px; margin-top:2px}
    .check .t{font-size:12.6px; color:var(--text); margin:0 0 2px; font-weight:900}
    .check .d{font-size:12.6px; color:var(--muted2); margin:0; line-height:1.55}

    .err{
      display:none;
      margin-top:12px;
      border:1px solid rgba(255,122,122,.25);
      background: rgba(255,122,122,.08);
      border-radius:14px;
      padding:10px 12px;
      color:var(--muted2);
      font-size:12.6px;
      line-height:1.55;
    }
    .err strong{color:var(--text); font-weight:950}
    .err ul{margin:8px 0 0 18px; padding:0}
    .err li{margin:6px 0}

    .miniRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px;}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;}

    /* Rail */
    .rail{ position: sticky; top: 14px; }
    .box{
      margin-top:12px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color:var(--muted2);
      font-size:12.8px;
      line-height:1.6;
    }
    .box strong{color:var(--text); font-weight:950}
    .box a{border-bottom:1px solid rgba(255,255,255,.18)}
    .railActions{ display:grid; gap:10px; margin-top:12px; }
    .railActions .btn{ min-height:46px; }
    .divider{ height:1px; background: rgba(255,255,255,.10); margin: 14px 0; }

    .kv{
      display:grid; gap:10px; margin-top:10px;
    }
    .kvLine{
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      padding:10px;
    }
    .kvLine .k{color:var(--muted2); font-size:11px; letter-spacing:.28em; text-transform:uppercase}
    .kvLine .v{margin-top:6px; color:var(--muted); font-size:13px; line-height:1.6}
    .kvLine .v strong{color:var(--text); font-weight:950}

    /* Mobile bottom bar */
    .bottomBar{
      z-index: 30;
      padding: 10px 0 calc(10px + env(safe-area-inset-bottom));
      background: linear-gradient(180deg, rgba(7,7,11,0) 0%, rgba(7,7,11,.78) 22%, rgba(7,7,11,.92) 100%);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255,255,255,.08);
      display:none;
    }
    .bottomInner{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      padding: 0 16px;
      max-width: 1120px;
      margin: 0 auto;
    }
    .bottomText{
      min-width:0;
      color:var(--muted);
      font-size:12.6px;
      line-height:1.4;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .bottomText strong{ color:var(--text); font-weight:950; }
    .bottomBtns{display:flex; gap:10px; align-items:center}
    .bottomInner .btn{ min-height:46px; }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .rail{ position: relative; top: 0; }
      .field, .field.third{ grid-column: span 12; }
    }
    @media (max-width: 760px){
      .heroInner{ padding: 18px 14px; }
      .hd, .bd{ padding-left:14px; padding-right:14px; }
      .bottomBar{
        display:block;
        position: fixed;
        left: 0; right: 0; bottom: 0;
      }
      body{ padding-bottom: calc(86px + env(safe-area-inset-bottom)); }
      .checkgrid{grid-template-columns:1fr}
    }
    @media (prefers-reduced-motion: reduce){
      *{ scroll-behavior:auto !important; }
    }
  </style>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>
  <a class="skip" href="#main">Skip to content</a>

  <!-- injected header -->
  <header id="nfHeader"></header>

  <main id="main" class="wrap">
    <section class="hero" aria-label="Partner deal hero">
      <div class="heroShell">
        <div class="heroInner">
          <div class="kickerRow" aria-label="Deal badges">
            <span class="badge"><span class="dot"></span><strong>Deal ID</strong> <span class="mono" id="dealIdText">NF-PD-—</span></span>
            <span class="badge"><span class="dot" id="tierDot"></span><strong>Tier</strong> <span id="tierText">Pending</span></span>
            <span class="badge" title="Protection activates after Noetfield accepts the registration (email confirmation)."><span class="dot good"></span><strong>Protection</strong> 90 days (on acceptance)</span>
            <span class="badge" title="Target turnaround for tier confirmation and next steps."><span class="dot good"></span><strong>SLA</strong> 1 business day</span>
            <span class="badge" title="RID is used for routing + status updates. Non-confidential."><strong>RID</strong> <span class="mono" id="ridText">—</span></span>
          </div>

          <h1>Partner Deal Registration</h1>

          <p class="lead">
            Register a partner-sourced opportunity to receive a <strong>Partner Deal ID</strong>, compute a clear <strong>tier suggestion</strong>,
            and route <strong>procurement safely</strong>. This page is for <strong>routing only</strong> — keep it <strong>non-confidential</strong>.
          </p>

          <div class="notice" role="note">
            <strong>Do not include:</strong> credentials, customer data, personal IDs, internal documents, pricing details, or sensitive deal notes.
            Use this page for high-level signals and routing.
          </div>

          <div class="actions" aria-label="Hero actions">
            <a class="btn secondary" href="/gate/" data-rid-link>Back to Gate</a>
            <a class="btn secondary" href="/gate/procurement/" data-rid-link>Procurement lane</a>
            <a class="btn secondary" href="/gate/partners/structure/" data-rid-link>Partner structure</a>
            <a class="btn secondary" href="/status/" data-rid-link>Status</a>
            <button class="btn primary" type="button" id="copyDealLinkBtn">Copy deal link</button>
          </div>

        </div>
      </div>
    </section>

    <section class="grid" aria-label="Deal layout">
      <!-- Left -->
      <section class="card" aria-label="Deal form">
        <div class="hd">
          <div>
            <h2 class="cardTitle">Deal details (non-confidential)</h2>
            <p class="muted">Draft-safe (local) • packet export • email builders • deep-linkable IDs</p>
          </div>
          <div class="toolbar" aria-label="Deal tools">
            <button class="btn secondary" type="button" id="newDealBtn" title="Creates a new Partner Deal ID and updates the URL.">New Deal ID</button>
            <button class="btn secondary" type="button" id="saveDraftBtn" title="Save a local draft for this Deal ID (browser only).">Save draft</button>
            <button class="btn secondary" type="button" id="loadDraftBtn" title="Load the saved local draft for this Deal ID.">Load</button>
            <button class="btn secondary" type="button" id="clearDraftBtn" title="Clear the saved local draft for this Deal ID.">Clear</button>
          </div>
        </div>

        <div class="bd">
          <div id="errBox" class="err" role="alert" aria-live="polite">
            <strong>Fix required items</strong>
            <ul id="errList"></ul>
          </div>

          <form id="dealForm" autocomplete="on" novalidate>
            <!-- Partner -->
            <div class="section">
              <div class="sectionTitle">Partner</div>
              <p class="sectionDesc">Who is submitting this deal registration.</p>

              <div class="row">
                <div class="field">
                  <label class="label" for="partnerName">Partner name</label>
                  <input class="input" id="partnerName" name="partnerName" placeholder="e.g., Northshore MSP Ltd." />
                </div>
                <div class="field">
                  <label class="label" for="partnerEmail">Partner email</label>
                  <input class="input" id="partnerEmail" name="partnerEmail" placeholder="name@partner.com" />
                </div>
                <div class="field">
                  <label class="label" for="partnerWebsite">Partner website</label>
                  <input class="input" id="partnerWebsite" name="partnerWebsite" placeholder="https://partner.com" />
                </div>
                <div class="field">
                  <label class="label" for="partnerRole">Your role</label>
                  <input class="input" id="partnerRole" name="partnerRole" placeholder="e.g., Account Executive, Consultant, MSP Owner" />
                </div>
              </div>
            </div>

            <!-- Client -->
            <div class="section">
              <div class="sectionTitle">Client (target organization)</div>
              <p class="sectionDesc">High-level only. No sensitive details.</p>

              <div class="row">
                <div class="field">
                  <label class="label" for="clientOrg">Client organization</label>
                  <input class="input" id="clientOrg" name="clientOrg" placeholder="e.g., Pacific Credit Union" />
                </div>
                <div class="field">
                  <label class="label" for="clientDomain">Client domain</label>
                  <input class="input" id="clientDomain" name="clientDomain" placeholder="e.g., client.com" />
                </div>
                <div class="field third">
                  <label class="label" for="clientSize">Size (rough)</label>
                  <select class="select" id="clientSize" name="clientSize">
                    <option value="">Select…</option>
                    <option value="200-499">200–499</option>
                    <option value="500-999">500–999</option>
                    <option value="1000-4999">1,000–4,999</option>
                    <option value="5000+">5,000+</option>
                  </select>
                </div>
                <div class="field third">
                  <label class="label" for="industry">Industry</label>
                  <select class="select" id="industry" name="industry">
                    <option value="">Select…</option>
                    <option value="financial">Financial / Insurance / Credit Union</option>
                    <option value="health">Health</option>
                    <option value="public">Public sector / Agency</option>
                    <option value="legal">Legal / Professional services</option>
                    <option value="tech">Technology</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div class="field third">
                  <label class="label" for="geo">Geography</label>
                  <select class="select" id="geo" name="geo">
                    <option value="">Select…</option>
                    <option value="canada">Canada</option>
                    <option value="usa">USA</option>
                    <option value="uk-eu">UK/EU</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>

              <div class="row" style="margin-top:10px;">
                <div class="field">
                  <label class="label" for="championRole">Operational champion (role)</label>
                  <input class="input" id="championRole" name="championRole" placeholder="e.g., Director of Modern Workplace / M365 Platform Owner" />
                </div>
                <div class="field">
                  <label class="label" for="buyerRole">Signer / budget owner (role)</label>
                  <input class="input" id="buyerRole" name="buyerRole" placeholder="e.g., CIO / CISO / VP IT" />
                </div>
              </div>
            </div>

            <!-- Routing -->
            <div class="section">
              <div class="sectionTitle">Routing</div>
              <p class="sectionDesc">How to move this cleanly through procurement.</p>

              <div class="row">
                <div class="field">
                  <label class="label" for="need">Primary need</label>
                  <select class="select" id="need" name="need">
                    <option value="">Select…</option>
                    <option value="copilot-readiness">Copilot readiness (2/4/6 weeks)</option>
                    <option value="quickscan">QuickScan (5–7 business days)</option>
                    <option value="trust-brief">Trust Brief (6-week)</option>
                    <option value="trust-ledger">Trust Ledger (ongoing)</option>
                    <option value="unknown">Not sure yet</option>
                  </select>
                </div>
                <div class="field">
                  <label class="label" for="timing">Timing</label>
                  <select class="select" id="timing" name="timing">
                    <option value="">Select…</option>
                    <option value="urgent">Urgent (days to 2 weeks)</option>
                    <option value="standard">Standard (4 weeks)</option>
                    <option value="extended">Extended (6 weeks)</option>
                    <option value="tbd">TBD</option>
                  </select>
                </div>
                <div class="field third">
                  <label class="label" for="procLane">Procurement lane</label>
                  <select class="select" id="procLane" name="procLane">
                    <option value="">Select…</option>
                    <option value="invoice-po">Invoice / PO</option>
                    <option value="card">Card checkout</option>
                    <option value="msa">MSA/SOW workflow</option>
                    <option value="unknown">Unknown</option>
                  </select>
                </div>
                <div class="field third">
                  <label class="label" for="stage">Stage</label>
                  <select class="select" id="stage" name="stage">
                    <option value="">Select…</option>
                    <option value="intro">Intro / early interest</option>
                    <option value="active">Active evaluation</option>
                    <option value="pilot">Pilot decision</option>
                    <option value="rollout">Rollout decision</option>
                  </select>
                </div>
                <div class="field third">
                  <label class="label" for="decisionWindow">Decision window</label>
                  <select class="select" id="decisionWindow" name="decisionWindow">
                    <option value="">Select…</option>
                    <option value="0-2w">0–2 weeks</option>
                    <option value="2-6w">2–6 weeks</option>
                    <option value="6-12w">6–12 weeks</option>
                    <option value="unknown">Unknown</option>
                  </select>
                </div>

                <div class="field full">
                  <label class="label" for="constraints">Constraints / notes (high-level)</label>
                  <textarea class="textarea" id="constraints" name="constraints" placeholder="e.g., audit window, client requirements, sensitive data themes, policy posture, preferred kickoff mode (email-first), stakeholder complexity..."></textarea>
                </div>
              </div>

              <div class="checkgrid" aria-label="Signals">
                <label class="check">
                  <input type="checkbox" id="sigM365" />
                  <div>
                    <div class="t">Microsoft-heavy</div>
                    <p class="d">M365 E3/E5 + Purview/DLP posture matters.</p>
                  </div>
                </label>
                <label class="check">
                  <input type="checkbox" id="sigSensitive" />
                  <div>
                    <div class="t">Sensitive data</div>
                    <p class="d">HR, finance, client files, regulated records (high-level only).</p>
                  </div>
                </label>
                <label class="check">
                  <input type="checkbox" id="sigProc" />
                  <div>
                    <div class="t">Procurement pressure</div>
                    <p class="d">Vendor onboarding, security, privacy, or legal gating expected.</p>
                  </div>
                </label>
                <label class="check">
                  <input type="checkbox" id="sigUrgent" />
                  <div>
                    <div class="t">Urgency</div>
                    <p class="d">Timeline is driving a fast decision path.</p>
                  </div>
                </label>
              </div>

              <div class="miniRow">
                <button class="btn primary" type="button" id="computeBtn">Compute tier + packet</button>
                <button class="btn secondary" type="button" id="exportBtn" disabled>Export packet (.json)</button>
                <button class="btn secondary" type="button" id="copyPacketBtn" disabled>Copy packet (JSON)</button>
              </div>
            </div>

            <!-- Email builders -->
            <div class="section">
              <div class="sectionTitle">Email builders</div>
              <p class="sectionDesc">Generated locally in your browser. Use non-confidential text only.</p>

              <div class="miniRow">
                <button class="btn secondary" type="button" id="genEmailToNoetfieldBtn">Generate email to Noetfield</button>
                <a class="btn secondary" id="mailtoNoetfieldBtn" href="#" hidden>Open in email app</a>
                <button class="btn secondary" type="button" id="copyEmailToNoetfieldBtn" disabled>Copy</button>
              </div>

              <textarea class="textarea" id="emailOut" readonly style="margin-top:12px;"></textarea>

              <div class="notice" style="margin-top:12px;">
                <strong>Recipient:</strong> defaults to <span class="mono">procurement@noetfield.com</span> for routing. Change in your email client if needed.
              </div>
            </div>

            <div class="notice" style="margin-top:12px;">
              <strong>Status:</strong> Deal protection is activated only after Noetfield accepts registration (email confirmation).
              Keep this registration link for routing and updates.
            </div>
          </form>
        </div>
      </section>

      <!-- Right rail -->
      <aside class="rail" aria-label="Deal rail">
        <div class="card">
          <div class="hd">
            <div>
              <h2 class="cardTitle">Deal summary</h2>
              <p class="muted">Tier suggestion + next best routing.</p>
            </div>
          </div>

          <div class="bd">
            <div class="box">
              <div><strong>Deal ID:</strong> <span class="mono" id="railDealId">—</span></div>
              <div style="margin-top:6px;"><strong>RID:</strong> <span class="mono" id="railRid">—</span></div>
              <div style="margin-top:6px;"><strong>Tier:</strong> <span id="railTier">Pending</span></div>

              <div class="miniRow" style="margin-top:10px;">
                <button class="btn secondary" type="button" id="copyRidBtn">Copy RID</button>
                <button class="btn secondary" type="button" id="copyDealIdBtn">Copy Deal ID</button>
              </div>
            </div>

            <div class="divider" aria-hidden="true"></div>

            <div class="kv" aria-label="Rail key values">
              <div class="kvLine">
                <div class="k">Suggested start</div>
                <div class="v"><strong id="suggestedStart">—</strong><br/><span id="suggestedWhy">—</span></div>
              </div>
              <div class="kvLine">
                <div class="k">Procurement lane</div>
                <div class="v"><strong id="railLane">—</strong></div>
              </div>
              <div class="kvLine">
                <div class="k">Next actions</div>
                <div class="v">Use <strong>Gate</strong> for a clean SKU path, then <strong>Procurement</strong> if Invoice/PO is required.</div>
              </div>
            </div>

            <div class="railActions" aria-label="Rail actions">
              <a class="btn primary" id="railGateBtn" href="/gate/" data-rid-link>Open Gate</a>
              <a class="btn secondary" id="railProcBtn" href="/gate/procurement/" data-rid-link>Procurement (Invoice/PO)</a>
              <a class="btn secondary" id="railSalesBtn" href="/gate/sales/" data-rid-link>Start (Sales)</a>
              <a class="btn secondary" id="railPartnersBtn" href="/gate/partners/" data-rid-link>Partners</a>
            </div>

            <div class="box">
              <strong>Non-confidential rule</strong><br/>
              This page is for routing signals only. Do not paste customer data or internal documents.
            </div>
          </div>
        </div>
      </aside>
    </section>
  </main>

  <!-- injected footer -->
  <footer id="nfFooter"></footer>

  <!-- Mobile bottom bar -->
  <div class="bottomBar" id="bottomBar" role="region" aria-label="Deal quick actions">
    <div class="bottomInner">
      <div class="bottomText" id="bottomText"><strong>Deal:</strong> —</div>
      <div class="bottomBtns" aria-label="Mobile quick actions">
        <a class="btn secondary" href="/gate/" data-rid-link>Gate</a>
        <a class="btn primary" href="/gate/procurement/" data-rid-link>Procurement</a>
      </div>
    </div>
  </div>

  <script>
    (function(){
      "use strict";

      function $(id){ return document.getElementById(id); }
      function qsa(sel){ try { return Array.prototype.slice.call(document.querySelectorAll(sel)); } catch(_) { return []; } }

      // RID resolution (same strategy as Gate)
      function getRid(){
        try{
          if (window.NoetfieldShell && typeof window.NoetfieldShell.getRID === "function") return window.NoetfieldShell.getRID();
          if (window.NF && typeof window.NF.getRID === "function") return window.NF.getRID();
        } catch(_) {}
        try {
          var u = new URL(window.location.href);
          var ridQ = (u.searchParams.get("rid") || "").trim();
          if (ridQ) return ridQ;
        } catch(_) {}
        try{
          var k = "nf_rid";
          var cur = (localStorage.getItem(k) || "").trim();
          if (!cur){
            cur = "NF-" + Math.random().toString(36).slice(2, 8).toUpperCase() + "-" + Date.now().toString(36).toUpperCase();
            localStorage.setItem(k, cur);
          }
          return cur;
        } catch(_){
          return "NF-" + Date.now().toString(36).toUpperCase();
        }
      }

      function applyRidToLinks(rid){
        var links = qsa("a[data-rid-link]");
        links.forEach(function(a){
          try{
            var href = a.getAttribute("href") || "";
            if (!href || href.indexOf("mailto:") === 0 || href.indexOf("#") === 0) return;
            var u = new URL(href, window.location.origin);
            if (!u.searchParams.get("rid")) u.searchParams.set("rid", rid);
            a.setAttribute("href", u.pathname + u.search + u.hash);
          } catch(_) {}
        });
      }

      function copyToClipboard(text){
        return new Promise(function(resolve){
          (async function(){
            try{
              if (navigator.clipboard && navigator.clipboard.writeText){
                await navigator.clipboard.writeText(text);
                return resolve(true);
              }
            } catch(_) {}
            try{
              var ta = document.createElement("textarea");
              ta.value = text;
              ta.style.position = "fixed";
              ta.style.left = "-9999px";
              document.body.appendChild(ta);
              ta.focus(); ta.select();
              document.execCommand("copy");
              document.body.removeChild(ta);
              return resolve(true);
            } catch(_){ return resolve(false); }
          })();
        });
      }

      function ymd(){
        var d = new Date();
        var mm = String(d.getMonth()+1).padStart(2,"0");
        var dd = String(d.getDate()).padStart(2,"0");
        return String(d.getFullYear()) + mm + dd;
      }

      function genDealId(){
        var rand = Math.random().toString(36).slice(2, 8).toUpperCase();
        return "NF-PD-" + rand + "-" + ymd();
      }

      function getDealId(){
        try{
          var u = new URL(window.location.href);
          var d = (u.searchParams.get("deal") || "").trim();
          if (d) return d;
        } catch(_) {}
        try{
          var cur = (localStorage.getItem("nf_pd_last_deal") || "").trim();
          if (cur) return cur;
        } catch(_) {}
        var fresh = genDealId();
        try{ localStorage.setItem("nf_pd_last_deal", fresh); } catch(_) {}
        return fresh;
      }

      function setQueryParam(key, value){
        try{
          var u = new URL(window.location.href);
          if (!value) u.searchParams.delete(key);
          else u.searchParams.set(key, value);
          history.replaceState({}, "", u.pathname + (u.searchParams.toString() ? ("?" + u.searchParams.toString()) : "") + u.hash);
        } catch(_) {}
      }

      function setBadges(dealId, rid){
        $("dealIdText").textContent = dealId;
        $("ridText").textContent = rid;
        $("railDealId").textContent = dealId;
        $("railRid").textContent = rid;
        $("bottomText").innerHTML = "<strong>Deal:</strong> " + dealId;
      }

      function tierDotSet(tier){
        var dot = $("tierDot");
        if (!dot) return;
        dot.classList.remove("good","warn","bad");
        if (tier === "A") dot.classList.add("good");
        else if (tier === "B") dot.classList.add("warn");
        else if (tier === "C") dot.classList.add("bad");
      }

      function showErrors(items){
        var box = $("errBox");
        var list = $("errList");
        if (!box || !list) return;
        list.innerHTML = "";
        if (!items || !items.length){
          box.style.display = "none";
          return;
        }
        items.forEach(function(t){
          var li = document.createElement("li");
          li.textContent = t;
          list.appendChild(li);
        });
        box.style.display = "block";
      }

      function readForm(){
        function v(id){ return (($ (id).value || "")).trim(); }
        function c(id){ var el = $(id); return !!(el && el.checked); }

        return {
          partnerName: v("partnerName"),
          partnerEmail: v("partnerEmail"),
          partnerWebsite: v("partnerWebsite"),
          partnerRole: v("partnerRole"),

          clientOrg: v("clientOrg"),
          clientDomain: v("clientDomain"),
          clientSize: v("clientSize"),
          industry: v("industry"),
          geo: v("geo"),

          championRole: v("championRole"),
          buyerRole: v("buyerRole"),

          need: v("need"),
          timing: v("timing"),
          procLane: v("procLane"),
          stage: v("stage"),
          decisionWindow: v("decisionWindow"),

          constraints: v("constraints"),

          sigM365: c("sigM365"),
          sigSensitive: c("sigSensitive"),
          sigProc: c("sigProc"),
          sigUrgent: c("sigUrgent")
        };
      }

      function validate(d){
        var errs = [];
        if (!d.partnerName) errs.push("Partner name is required.");
        if (!d.clientOrg) errs.push("Client organization is required.");
        if (!d.clientDomain) errs.push("Client domain is required.");
        if (!d.championRole) errs.push("Operational champion role is required.");
        return errs;
      }

      function suggestStart(d){
        // Normalize to Gate offers/SKUs
        if (d.need === "quickscan") return {id:"quickscan", label:"Copilot QuickScan", why:"Fastest decision-ready posture; feeds Readiness."};
        if (d.need === "trust-brief") return {id:"trust_brief", label:"Trust Brief (6-week)", why:"Best for governance plan + roadmap."};
        if (d.need === "trust-ledger") return {id:"trust_ledger", label:"Trust Ledger (Ongoing)", why:"Best for ongoing evidence continuity."};

        // Copilot readiness path
        if (d.need === "copilot-readiness"){
          if (d.timing === "urgent") return {id:"quickscan", label:"Copilot QuickScan", why:"Urgency suggests rapid snapshot before broad rollout."};
          if (d.timing === "extended") return {id:"readiness_extended", label:"Copilot Readiness — Extended (6 weeks)", why:"Complex scope suggests extended readiness."};
          if (d.timing === "standard") return {id:"readiness_standard", label:"Copilot Readiness — Standard (4 weeks)", why:"Default enterprise baseline for rollout approval."};
          return {id:"readiness_standard", label:"Copilot Readiness — Standard (4 weeks)", why:"Default enterprise baseline for rollout approval."};
        }

        // Unknown: infer from urgency + procurement pressure
        if (d.sigUrgent || d.timing === "urgent") return {id:"quickscan", label:"Copilot QuickScan", why:"Urgency suggests a rapid, decision-ready snapshot."};
        if (d.sigProc || d.procLane === "invoice-po") return {id:"readiness_standard", label:"Copilot Readiness — Standard (4 weeks)", why:"Procurement pressure favors a fixed-scope SKU with named outputs."};
        return {id:"readiness_standard", label:"Copilot Readiness — Standard (4 weeks)", why:"Default enterprise baseline."};
      }

      function computeTier(d){
        // Simple scoring: higher score => Tier A
        var score = 0;

        // Size
        if (d.clientSize === "5000+") score += 4;
        else if (d.clientSize === "1000-4999") score += 3;
        else if (d.clientSize === "500-999") score += 2;
        else if (d.clientSize === "200-499") score += 1;

        // Industry sensitivity
        if (d.industry === "financial" || d.industry === "health" || d.industry === "public" || d.industry === "legal") score += 3;
        else if (d.industry) score += 1;

        // Signals
        if (d.sigM365) score += 2;
        if (d.sigSensitive) score += 2;
        if (d.sigProc) score += 2;
        if (d.sigUrgent) score += 1;

        // Procurement lane
        if (d.procLane === "invoice-po" || d.procLane === "msa") score += 2;

        // Stage / decision window
        if (d.stage === "rollout" || d.stage === "pilot") score += 2;
        if (d.decisionWindow === "0-2w") score += 2;
        else if (d.decisionWindow === "2-6w") score += 1;

        // Timing selection
        if (d.timing === "urgent") score += 1;

        var tier = "B";
        if (score >= 12) tier = "A";
        else if (score <= 6) tier = "C";

        return {tier:tier, score:score};
      }

      function laneLabel(v){
        if (v === "invoice-po") return "Invoice / PO";
        if (v === "card") return "Card checkout";
        if (v === "msa") return "MSA/SOW workflow";
        if (v === "unknown") return "Unknown";
        return "—";
      }

      function buildPacket(dealId, rid, d, tierObj, startObj){
        return {
          schema: "noetfield.partner_deal.v1",
          generated_at: new Date().toISOString(),
          deal_id: dealId,
          rid: rid,
          tier: tierObj.tier,
          score: tierObj.score,
          suggested_start: startObj,
          routing: {
            procurement_lane: d.procLane || null,
            timing: d.timing || null,
            stage: d.stage || null,
            decision_window: d.decisionWindow || null
          },
          partner: {
            name: d.partnerName || null,
            email: d.partnerEmail || null,
            website: d.partnerWebsite || null,
            role: d.partnerRole || null
          },
          client: {
            org: d.clientOrg || null,
            domain: d.clientDomain || null,
            size: d.clientSize || null,
            industry: d.industry || null,
            geo: d.geo || null,
            champion_role: d.championRole || null,
            buyer_role: d.buyerRole || null
          },
          need: d.need || null,
          signals: {
            microsoft_heavy: !!d.sigM365,
            sensitive_data: !!d.sigSensitive,
            procurement_pressure: !!d.sigProc,
            urgency: !!d.sigUrgent
          },
          constraints_high_level: d.constraints || null,
          safety: {
            non_confidential_only: true
          }
        };
      }

      function downloadJson(filename, obj){
        try{
          var blob = new Blob([JSON.stringify(obj, null, 2)], {type:"application/json;charset=utf-8"});
          var url = URL.createObjectURL(blob);
          var a = document.createElement("a");
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          setTimeout(function(){ try{ URL.revokeObjectURL(url); } catch(_){} }, 500);
        } catch(_) {}
      }

      function buildMailto(to, subject, body){
        try{
          var s = "mailto:" + encodeURIComponent(to || "") + "?subject=" + encodeURIComponent(subject || "") + "&body=" + encodeURIComponent(body || "");
          return s;
        } catch(_){
          return "mailto:";
        }
      }

      function withRidAndDeal(path, rid, dealId){
        try{
          var u = new URL(path, window.location.origin);
          if (rid && !u.searchParams.get("rid")) u.searchParams.set("rid", rid);
          if (dealId && !u.searchParams.get("deal")) u.searchParams.set("deal", dealId);
          return u.pathname + u.search + u.hash;
        } catch(_){
          return path;
        }
      }

      // Elements
      var rid = getRid();
      var dealId = getDealId();

      // Ensure URL has deal + rid for shareability
      setQueryParam("rid", rid);
      setQueryParam("deal", dealId);

      applyRidToLinks(rid);
      setBadges(dealId, rid);

      // Buttons
      var newDealBtn = $("newDealBtn");
      var saveDraftBtn = $("saveDraftBtn");
      var loadDraftBtn = $("loadDraftBtn");
      var clearDraftBtn = $("clearDraftBtn");
      var computeBtn = $("computeBtn");
      var exportBtn = $("exportBtn");
      var copyPacketBtn = $("copyPacketBtn");

      var genEmailToNoetfieldBtn = $("genEmailToNoetfieldBtn");
      var mailtoNoetfieldBtn = $("mailtoNoetfieldBtn");
      var copyEmailToNoetfieldBtn = $("copyEmailToNoetfieldBtn");
      var emailOut = $("emailOut");

      var copyRidBtn = $("copyRidBtn");
      var copyDealIdBtn = $("copyDealIdBtn");
      var copyDealLinkBtn = $("copyDealLinkBtn");

      var copyDealLinkHeroBtn = $("copyDealLinkBtn");

      var tierText = $("tierText");
      var railTier = $("railTier");
      var suggestedStartEl = $("suggestedStart");
      var suggestedWhyEl = $("suggestedWhy");
      var railLane = $("railLane");

      // State
      var lastPacket = null;

      function draftKey(){ return "nf_pd_draft_" + dealId; }

      function saveDraft(){
        try{
          var d = readForm();
          localStorage.setItem(draftKey(), JSON.stringify(d));
          localStorage.setItem("nf_pd_last_deal", dealId);
          return true;
        } catch(_){ return false; }
      }

      function loadDraft(){
        try{
          var raw = localStorage.getItem(draftKey());
          if (!raw) return false;
          var d = JSON.parse(raw);

          function setVal(id, val){
            var el = $(id);
            if (!el) return;
            el.value = (val == null) ? "" : String(val);
          }
          function setChk(id, val){
            var el = $(id);
            if (!el) return;
            el.checked = !!val;
          }

          setVal("partnerName", d.partnerName);
          setVal("partnerEmail", d.partnerEmail);
          setVal("partnerWebsite", d.partnerWebsite);
          setVal("partnerRole", d.partnerRole);

          setVal("clientOrg", d.clientOrg);
          setVal("clientDomain", d.clientDomain);
          setVal("clientSize", d.clientSize);
          setVal("industry", d.industry);
          setVal("geo", d.geo);

          setVal("championRole", d.championRole);
          setVal("buyerRole", d.buyerRole);

          setVal("need", d.need);
          setVal("timing", d.timing);
          setVal("procLane", d.procLane);
          setVal("stage", d.stage);
          setVal("decisionWindow", d.decisionWindow);

          setVal("constraints", d.constraints);

          setChk("sigM365", d.sigM365);
          setChk("sigSensitive", d.sigSensitive);
          setChk("sigProc", d.sigProc);
          setChk("sigUrgent", d.sigUrgent);

          return true;
        } catch(_){ return false; }
      }

      function clearDraft(){
        try{
          localStorage.removeItem(draftKey());
          return true;
        } catch(_){ return false; }
      }

      function refreshRail(d, tierObj, startObj){
        tierText.textContent = tierObj.tier + " (score " + tierObj.score + ")";
        railTier.textContent = tierObj.tier + " (score " + tierObj.score + ")";
        tierDotSet(tierObj.tier);

        suggestedStartEl.textContent = startObj.label;
        suggestedWhyEl.textContent = startObj.why;

        railLane.textContent = laneLabel(d.procLane);

        // Update Gate & Sales links with offer hint + deal id for continuity
        var gateBtn = $("railGateBtn");
        var salesBtn = $("railSalesBtn");
        var procBtn = $("railProcBtn");
        if (gateBtn){
          gateBtn.setAttribute("href", withRidAndDeal("/gate/?offer=" + encodeURIComponent(startObj.id), rid, dealId));
        }
        if (salesBtn){
          salesBtn.setAttribute("href", withRidAndDeal("/gate/sales/?offer=" + encodeURIComponent(startObj.id), rid, dealId));
        }
        if (procBtn){
          procBtn.setAttribute("href", withRidAndDeal("/gate/procurement/?focus=" + encodeURIComponent(startObj.id), rid, dealId));
        }
        applyRidToLinks(rid);
      }

      function computeAll(){
        var d = readForm();
        var errs = validate(d);
        showErrors(errs);
        if (errs.length) return false;

        var tierObj = computeTier(d);
        var startObj = suggestStart(d);

        lastPacket = buildPacket(dealId, rid, d, tierObj, startObj);

        exportBtn.disabled = false;
        copyPacketBtn.disabled = false;

        refreshRail(d, tierObj, startObj);
        return true;
      }

      function generateEmailToNoetfield(){
        if (!lastPacket){
          var ok = computeAll();
          if (!ok) return;
        }
        var p = lastPacket;

        var subject = "Partner Deal Registration — " + p.deal_id + " — RID " + p.rid + " — Tier " + p.tier;

        var lines = [];
        lines.push("Partner Deal Registration");
        lines.push("");
        lines.push("Deal ID: " + p.deal_id);
        lines.push("RID: " + p.rid);
        lines.push("Tier (suggested): " + p.tier + " (score " + p.score + ")");
        lines.push("Suggested start: " + (p.suggested_start && p.suggested_start.label ? p.suggested_start.label : "—"));
        lines.push("");
        lines.push("Partner:");
        lines.push("- Name: " + (p.partner.name || "—"));
        lines.push("- Email: " + (p.partner.email || "—"));
        lines.push("- Website: " + (p.partner.website || "—"));
        lines.push("- Role: " + (p.partner.role || "—"));
        lines.push("");
        lines.push("Client (high-level):");
        lines.push("- Org: " + (p.client.org || "—"));
        lines.push("- Domain: " + (p.client.domain || "—"));
        lines.push("- Size: " + (p.client.size || "—"));
        lines.push("- Industry: " + (p.client.industry || "—"));
        lines.push("- Geo: " + (p.client.geo || "—"));
        lines.push("- Champion role: " + (p.client.champion_role || "—"));
        lines.push("- Buyer role: " + (p.client.buyer_role || "—"));
        lines.push("");
        lines.push("Routing:");
        lines.push("- Need: " + (p.need || "—"));
        lines.push("- Timing: " + (p.routing.timing || "—"));
        lines.push("- Stage: " + (p.routing.stage || "—"));
        lines.push("- Decision window: " + (p.routing.decision_window || "—"));
        lines.push("- Procurement lane: " + (p.routing.procurement_lane || "—"));
        lines.push("");
        lines.push("Signals:");
        lines.push("- Microsoft-heavy: " + (p.signals.microsoft_heavy ? "Yes" : "No"));
        lines.push("- Sensitive data theme: " + (p.signals.sensitive_data ? "Yes" : "No"));
        lines.push("- Procurement pressure: " + (p.signals.procurement_pressure ? "Yes" : "No"));
        lines.push("- Urgency: " + (p.signals.urgency ? "Yes" : "No"));
        lines.push("");
        if (p.constraints_high_level){
          lines.push("Constraints (high-level):");
          lines.push(p.constraints_high_level);
          lines.push("");
        }
        lines.push("Deal link (non-confidential):");
        lines.push("https://www.noetfield.com" + withRidAndDeal("/gate/partners/deal/", p.rid, p.deal_id));
        lines.push("");
        lines.push("Notes:");
        lines.push("- This message contains non-confidential routing signals only.");
        lines.push("- Please confirm acceptance to activate 90-day deal protection (per partner policy).");

        var body = lines.join("\n");
        emailOut.value = "Subject: " + subject + "\n\nTo: procurement@noetfield.com\n\n" + body;

        copyEmailToNoetfieldBtn.disabled = !emailOut.value;

        if (mailtoNoetfieldBtn){
          mailtoNoetfieldBtn.hidden = false;
          mailtoNoetfieldBtn.setAttribute("href", buildMailto("procurement@noetfield.com", subject, body));
        }
      }

      // Wire up events
      if (newDealBtn){
        newDealBtn.addEventListener("click", function(){
          dealId = genDealId();
          try{ localStorage.setItem("nf_pd_last_deal", dealId); } catch(_){}
          setQueryParam("deal", dealId);
          lastPacket = null;
          exportBtn.disabled = true;
          copyPacketBtn.disabled = true;
          emailOut.value = "";
          copyEmailToNoetfieldBtn.disabled = true;
          if (mailtoNoetfieldBtn) mailtoNoetfieldBtn.hidden = true;

          setBadges(dealId, rid);
          $("railDealId").textContent = dealId;
          $("dealIdText").textContent = dealId;
        });
      }

      if (saveDraftBtn){
        saveDraftBtn.addEventListener("click", function(){
          computeAll(); // compute also refreshes tier
          saveDraft();
        });
      }

      if (loadDraftBtn){
        loadDraftBtn.addEventListener("click", function(){
          loadDraft();
        });
      }

      if (clearDraftBtn){
        clearDraftBtn.addEventListener("click", function(){
          clearDraft();
        });
      }

      if (computeBtn){
        computeBtn.addEventListener("click", function(){
          computeAll();
        });
      }

      if (exportBtn){
        exportBtn.addEventListener("click", function(){
          if (!lastPacket){
            var ok = computeAll();
            if (!ok) return;
          }
          downloadJson("noetfield-partner-deal-" + dealId + "-" + rid + ".json", lastPacket);
        });
      }

      if (copyPacketBtn){
        copyPacketBtn.addEventListener("click", async function(){
          if (!lastPacket){
            var ok = computeAll();
            if (!ok) return;
          }
          await copyToClipboard(JSON.stringify(lastPacket, null, 2));
        });
      }

      if (genEmailToNoetfieldBtn){
        genEmailToNoetfieldBtn.addEventListener("click", generateEmailToNoetfield);
      }

      if (copyEmailToNoetfieldBtn){
        copyEmailToNoetfieldBtn.addEventListener("click", async function(){
          if (!emailOut.value) return;
          await copyToClipboard(emailOut.value);
        });
      }

      if (copyRidBtn){
        copyRidBtn.addEventListener("click", async function(){
          await copyToClipboard(rid);
        });
      }
      if (copyDealIdBtn){
        copyDealIdBtn.addEventListener("click", async function(){
          await copyToClipboard(dealId);
        });
      }

      function copyDealLink(){
        try{
          var u = new URL(window.location.href);
          u.searchParams.set("rid", rid);
          u.searchParams.set("deal", dealId);
          return copyToClipboard(u.pathname + "?" + u.searchParams.toString());
        } catch(_){
          return copyToClipboard("/gate/partners/deal/?rid=" + encodeURIComponent(rid) + "&deal=" + encodeURIComponent(dealId));
        }
      }

      if (copyDealLinkBtn){ copyDealLinkBtn.addEventListener("click", copyDealLink); }
      if (copyDealLinkHeroBtn){ copyDealLinkHeroBtn.addEventListener("click", copyDealLink); }

      // Initialize rail defaults
      $("railDealId").textContent = dealId;
      $("railRid").textContent = rid;
      $("tierText").textContent = "Pending";
      $("railTier").textContent = "Pending";
      tierDotSet(null);
      $("suggestedStart").textContent = "—";
      $("suggestedWhy").textContent = "Compute tier to populate suggested start.";
      $("railLane").textContent = "—";

      // Auto-load draft if present
      try{
        if (localStorage.getItem(draftKey())) loadDraft();
      } catch(_){}

      // Apply RID to any links
      applyRidToLinks(rid);
    })();
  </script>
</body>
</html>
