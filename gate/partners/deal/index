<!-- /gate/partners/deal/index.html — Noetfield Partner Deal Registration v3.0 (Gate-aligned • /gate/partners/deal • RID + Deal ID • 90-day protection (on acceptance) • tiering • autosave draft • email builders • mobile-safe blockers) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Noetfield — Partner Deal Registration</title>
  <meta name="description" content="Register a partner-sourced opportunity to receive a Partner Deal ID, confirm partner tier, and (upon acceptance) lock 90-day deal protection — procurement-safe and non-confidential." />
  <meta name="robots" content="index,follow" />
  <meta name="author" content="Noetfield Systems Inc." />
  <meta name="theme-color" content="#07070b" />

  <!-- Correct canonical -->
  <link rel="canonical" href="https://www.noetfield.com/gate/partners/deal/" />

  <link rel="icon" href="/noetfield-favicon-512.png" type="image/png" />
  <link rel="apple-touch-icon" href="/noetfield-favicon-512.png" />

  <!-- OG -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Noetfield" />
  <meta property="og:title" content="Noetfield — Partner Deal Registration" />
  <meta property="og:description" content="Partner Deal ID, tiering, 90-day protection (on acceptance), and procurement routing — non-confidential." />
  <meta property="og:url" content="https://www.noetfield.com/gate/partners/deal/" />
  <meta property="og:image" content="https://www.noetfield.com/noetfield-og.png" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Noetfield — Partner Deal Registration" />
  <meta name="twitter:description" content="Partner Deal ID, tiering, 90-day protection (on acceptance), and procurement routing — non-confidential." />
  <meta name="twitter:image" content="https://www.noetfield.com/noetfield-og.png" />

  <!-- Optional shared shell (if present) -->
  <!-- <link rel="stylesheet" href="/assets/noetfield-shell.css" /> -->

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Noetfield — Partner Deal Registration",
    "url":"https://www.noetfield.com/gate/partners/deal/",
    "isPartOf":{"@type":"WebSite","name":"Noetfield","url":"https://www.noetfield.com/"},
    "about":{"@type":"Organization","name":"Noetfield Systems Inc."},
    "description":"Register partner-sourced opportunities to receive a Partner Deal ID, confirm tier, and route procurement safely without sharing confidential data."
  }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#07070b;
      --panel:rgba(12,12,18,.72);
      --panel2:rgba(16,16,26,.56);
      --text:#ececf1;
      --muted:#a7a7b3;
      --faint:#7f8192;
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.08);
      --accent:#d7b56d;
      --accent2:#b89245;
      --good:#73d39b;
      --warn:#f0c36a;
      --bad:#ff7a7a;
      --shadow:0 18px 50px rgba(0,0,0,.45);
      --r:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: "Inter", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family:var(--sans);
      line-height:1.45;
      background:
        radial-gradient(1000px 600px at 25% -10%, rgba(215,181,109,.10), transparent 55%),
        radial-gradient(900px 550px at 90% 10%, rgba(215,181,109,.07), transparent 60%),
        var(--bg);
    }
    a{color:inherit; text-decoration:none}
    .wrap{max-width:1180px; margin:0 auto; padding:22px 18px 92px}

    /* Rail */
    .rail{
      display:flex; align-items:center; justify-content:space-between;
      gap:14px; padding:12px 14px;
      border:1px solid var(--line2);
      background:var(--panel);
      backdrop-filter: blur(10px);
      border-radius:18px;
      box-shadow:var(--shadow);
    }
    .brand{display:flex; align-items:center; gap:10px; min-width: 240px}
    .mark{
      width:34px; height:34px; border-radius:10px;
      background:linear-gradient(135deg, rgba(215,181,109,.22), rgba(215,181,109,.04));
      border:1px solid rgba(215,181,109,.25);
      display:grid; place-items:center;
      color:var(--accent);
      font-weight:800;
      letter-spacing:.5px;
    }
    .brand h1{font-size:14px; margin:0; letter-spacing:.2px}
    .brand .sub{font-size:12px; color:var(--muted); margin-top:1px}
    .nav{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end}

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--line2);
      background:rgba(16,16,26,.55);
      font-size:12px; color:var(--muted);
    }
    .pill strong{color:var(--text); font-weight:650}

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      gap:8px; padding:10px 12px; border-radius:12px;
      border:1px solid var(--line2);
      background:rgba(16,16,26,.55);
      color:var(--text);
      font-size:13px;
      cursor:pointer;
      transition:transform .05s ease, border-color .15s ease, background .15s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{border-color:rgba(215,181,109,.35); background:rgba(16,16,26,.72)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      border-color:rgba(215,181,109,.35);
      background:linear-gradient(180deg, rgba(215,181,109,.20), rgba(215,181,109,.08));
    }
    .btn.ghost{background:transparent}
    .btn.small{padding:7px 10px; font-size:12px; border-radius:10px}
    .btn.danger:hover{border-color:rgba(255,122,122,.45)}
    .btn[disabled]{opacity:.55; cursor:not-allowed}

    /* Hero */
    .hero{padding:18px 6px 6px}
    .hero .kicker{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      color:var(--muted); font-size:12px; margin-bottom:10px
    }
    .tag{
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(215,181,109,.22);
      background:rgba(215,181,109,.08);
      color:var(--accent);
      font-family:var(--mono);
      font-size:11px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line2);
      background:rgba(16,16,26,.52);
      font-size:12px; color:var(--muted)
    }
    .dot{width:8px; height:8px; border-radius:999px; background:var(--warn)}
    .dot.good{background:var(--good)}
    .dot.bad{background:var(--bad)}
    .hero h2{margin:0 0 8px; font-size:26px; letter-spacing:.2px}
    .hero p{margin:0; color:var(--muted); max-width:980px}
    .hero .alert{
      margin-top:12px;
      border:1px solid rgba(240,195,106,.25);
      background:rgba(240,195,106,.08);
      border-radius:14px;
      padding:10px 12px;
      color:var(--muted);
      font-size:12px;
    }
    .hero .alert strong{color:var(--text)}
    .steps{
      display:grid; grid-template-columns:repeat(3,1fr); gap:10px;
      margin-top:14px;
    }
    @media (max-width: 880px){ .steps{grid-template-columns:1fr} }
    .step{
      border:1px solid var(--line2);
      background:rgba(16,16,26,.50);
      border-radius:14px;
      padding:12px;
    }
    .step .n{
      width:26px; height:26px; border-radius:9px;
      display:grid; place-items:center; font-weight:800;
      color:var(--accent);
      border:1px solid rgba(215,181,109,.25);
      background:rgba(215,181,109,.08);
      margin-bottom:8px;
      font-family:var(--mono);
      font-size:12px;
    }
    .step .t{font-size:13px; margin:0 0 4px}
    .step .d{font-size:12px; margin:0; color:var(--muted)}

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      margin-top:16px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .nav{justify-content:flex-start}
      .brand{min-width:auto}
    }

    /* Card */
    .card{
      border:1px solid var(--line2);
      background:var(--panel);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line2);
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .card .hd h3{margin:0; font-size:14px; letter-spacing:.2px}
    .card .hd .meta{color:var(--muted); font-size:12px}
    .card .bd{padding:14px}

    /* Form */
    .sectionTitle{
      margin:14px 0 10px;
      font-size:12px; color:var(--faint);
      letter-spacing:.35px; text-transform:uppercase
    }
    .formgrid{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width: 720px){ .formgrid{grid-template-columns:1fr} }
    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px}
    input, select, textarea{
      width:100%;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid var(--line2);
      background:rgba(16,16,26,.52);
      color:var(--text);
      outline:none;
      font-family:inherit;
    }
    textarea{min-height:104px; resize:vertical}
    input:focus, select:focus, textarea:focus{
      border-color:rgba(215,181,109,.35);
      box-shadow:0 0 0 3px rgba(215,181,109,.12);
    }
    input::placeholder, textarea::placeholder{color:rgba(167,167,179,.55)}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .hint{font-size:12px; color:var(--muted)}
    .fine{
      font-size:11px; color:var(--faint);
      border-top:1px solid var(--line2);
      padding-top:10px;
      margin-top:12px;
    }
    .mono{font-family:var(--mono)}
    .req{color:var(--accent); font-family:var(--mono); font-weight:700}

    /* Blockers: mobile-friendly */
    .checks{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:8px;
    }
    @media (max-width: 520px){ .checks{grid-template-columns:1fr} }
    .check{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid var(--line2);
      background:rgba(16,16,26,.40);
    }
    .check input{width:18px; height:18px; margin-top:1px}
    .check .t{font-size:12px; color:var(--text); font-weight:600; line-height:1.2}
    .check .d{font-size:12px; color:var(--muted); margin-top:2px; line-height:1.35}

    /* Right-side summary */
    .kv{display:grid; gap:10px}
    .kv .line{
      border:1px solid var(--line2);
      background:rgba(16,16,26,.50);
      border-radius:14px; padding:12px;
    }
    .kv .k{font-size:11px; color:var(--muted); letter-spacing:.25px}
    .kv .v{margin-top:4px; font-size:13px}
    .kv .v strong{font-weight:750}
    .split{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 980px){ .split{grid-template-columns:1fr} }

    details{
      border:1px solid var(--line2);
      background:rgba(16,16,26,.40);
      border-radius:14px;
      padding:10px 12px;
    }
    details summary{
      cursor:pointer;
      font-size:12px;
      color:var(--muted);
      list-style:none;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    details summary::-webkit-details-marker{display:none}
    .chev{opacity:.8; font-family:var(--mono); transform-origin:center}
    details[open] .chev{transform:rotate(180deg)}
    .detailsBody{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
    }
    .detailsBody ul{margin:8px 0 0 18px; padding:0}
    .detailsBody li{margin:6px 0}

    /* Footer */
    .footer{
      margin-top:18px; padding:14px 2px 0; color:var(--faint); font-size:12px;
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
    }
    .footer a{color:var(--muted); text-decoration:underline; text-underline-offset:2px}

    /* Mobile action bar */
    .actionbar{
      position:fixed; left:0; right:0; bottom:0;
      background:rgba(7,7,11,.72);
      backdrop-filter: blur(10px);
      border-top:1px solid var(--line2);
      padding:10px 12px;
      z-index:50;
    }
    .actionbar .inner{
      max-width:1180px; margin:0 auto;
      display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .actionbar .meta{
      color:var(--muted); font-size:12px;
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .actionbar .cta{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    @media (min-width: 981px){
      .actionbar{display:none}
      .wrap{padding-bottom:40px}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- Rail -->
    <div class="rail" role="navigation" aria-label="Gate navigation">
      <a class="brand" href="/gate/">
        <div class="mark">N</div>
        <div>
          <h1>Noetfield</h1>
          <div class="sub">Partner deal registration • Deal ID • RID • tiering • protection</div>
        </div>
      </a>

      <div class="nav">
        <a class="btn small ghost" href="/gate/">Gate</a>
        <a class="btn small ghost" href="/gate/procurement/">Procurement</a>
        <a class="btn small ghost" href="/gate/partners/">Partners</a>
        <a class="btn small ghost" href="/gate/partners/structure/">Partner structure</a>
        <a class="btn small ghost" href="/gate/notes/">Notes</a>
        <a class="btn small ghost" href="/status/">Status</a>

        <span class="pill mono" title="RID is used for routing + status updates. Non-confidential.">
          RID: <strong id="ridText">—</strong>
          <button class="btn small" type="button" id="copyRidBtn">Copy</button>
        </span>
      </div>
    </div>

    <!-- Hero -->
    <div class="hero">
      <div class="kicker">
        <span class="tag mono" id="dealIdTag">NF-PD-—</span>
        <span class="badge"><span class="dot" id="tierDot"></span><span id="tierText">Tier: pending</span></span>
        <span class="badge" title="Protection activates after Noetfield accepts the registration (email confirmation).">
          <span class="dot good"></span><span id="protectText">Protection: 90 days (on acceptance)</span>
        </span>
        <span class="badge" title="Target turnaround for tier confirmation and next steps.">
          <span class="dot good"></span><span id="slaText">Response SLA: 1 business day</span>
        </span>
      </div>

      <h2>Partner Deal Registration</h2>
      <p>
        Register a partner-sourced opportunity to receive a <strong>Partner Deal ID</strong>, confirm partner tier (Referral / Channel / Prime / Delivery),
        and route procurement cleanly. Keep it <strong>non-confidential</strong> and procurement-safe.
      </p>

      <div class="alert">
        <strong class="mono">Do not include:</strong> credentials, secrets, customer data, personal IDs, internal documents, or deal-sensitive pricing.
        Use this page for routing, tiering, and protection signals only.
      </div>

      <div class="steps" aria-label="Process steps">
        <div class="step">
          <div class="n">1</div>
          <p class="t"><strong>Register</strong> the opportunity</p>
          <p class="d">Company + buyer roles + procurement lane + constraints. No confidential details.</p>
        </div>
        <div class="step">
          <div class="n">2</div>
          <p class="t"><strong>Tier + accept</strong> (fast)</p>
          <p class="d">We confirm tier and accept registration; protection activates upon written acceptance.</p>
        </div>
        <div class="step">
          <div class="n">3</div>
          <p class="t"><strong>Close clean</strong></p>
          <p class="d">Route via Invoice/PO if needed; deliver board-ready evidence outputs and a procurement pack.</p>
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- Left: Form -->
      <div class="card">
        <div class="hd">
          <div>
            <h3>Deal details (non-confidential)</h3>
            <div class="meta">Autosave draft • packet copy/export • email builders • deep-linking (RID + Deal ID)</div>
          </div>
          <div class="row">
            <button class="btn small primary" type="button" id="genDealBtn" title="Creates a new Partner Deal ID and updates the URL.">New Deal ID</button>
            <button class="btn small" type="button" id="saveDraftBtn" title="Save a local draft for this Deal ID (browser only).">Save</button>
            <button class="btn small danger" type="button" id="clearDraftBtn" title="Clear the saved local draft for this Deal ID.">Clear</button>
          </div>
        </div>

        <div class="bd">
          <form id="dealForm" autocomplete="on" novalidate>
            <div class="sectionTitle">Partner info</div>
            <div class="formgrid">
              <div>
                <label for="partnerName">Partner legal / brand name <span class="req">*</span></label>
                <input id="partnerName" name="partnerName" placeholder="e.g., Northshore MSP Ltd." required />
              </div>
              <div>
                <label for="partnerType">Partner type (self-declared) <span class="req">*</span></label>
                <select id="partnerType" name="partnerType" required>
                  <option value="Channel">Channel (co-selling / account owner)</option>
                  <option value="Referral">Referral (warm intro only)</option>
                  <option value="Delivery">Delivery (implementation partner)</option>
                  <option value="Alliance">Alliance (co-marketing / ecosystem)</option>
                </select>
              </div>
              <div>
                <label for="partnerContact">Partner contact name <span class="req">*</span></label>
                <input id="partnerContact" name="partnerContact" placeholder="Full name" required />
              </div>
              <div>
                <label for="partnerEmail">Partner contact email <span class="req">*</span></label>
                <input id="partnerEmail" name="partnerEmail" type="email" placeholder="name@partner.com" required />
              </div>
            </div>

            <div class="sectionTitle">Opportunity basics</div>
            <div class="formgrid">
              <div>
                <label for="companyName">Company name <span class="req">*</span></label>
                <input id="companyName" name="companyName" placeholder="e.g., Example Credit Union" required />
              </div>
              <div>
                <label for="companyDomain">Company domain</label>
                <input id="companyDomain" name="companyDomain" placeholder="example.com" />
              </div>
              <div>
                <label for="industry">Industry</label>
                <select id="industry" name="industry">
                  <option value="Financial">Financial / Credit Union / Insurance</option>
                  <option value="Health">Health</option>
                  <option value="Public">Public sector / Agency</option>
                  <option value="Legal">Legal / Professional services</option>
                  <option value="Tech">Technology</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div>
                <label for="sizeBand">Employee band</label>
                <select id="sizeBand" name="sizeBand">
                  <option value="200-500">200–500</option>
                  <option value="500-1k">500–1,000</option>
                  <option value="1k-5k">1,000–5,000</option>
                  <option value="5k+">5,000+</option>
                </select>
              </div>
            </div>

            <div class="sectionTitle">Buyer-side roles</div>
            <div class="formgrid">
              <div>
                <label for="championRole">Champion role <span class="req">*</span></label>
                <select id="championRole" name="championRole" required>
                  <option value="Modern Workplace / M365 Owner">Modern Workplace / M365 Platform Owner</option>
                  <option value="IT Transformation">IT Transformation</option>
                  <option value="Security">Security (CISO org)</option>
                  <option value="Privacy">Privacy / Records</option>
                  <option value="Procurement">Procurement / Vendor Risk</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div>
                <label for="championEmail">Champion email (if permitted)</label>
                <input id="championEmail" name="championEmail" type="email" placeholder="optional@company.com" />
              </div>
              <div>
                <label for="buyLane">Likely buying lane</label>
                <select id="buyLane" name="buyLane">
                  <option value="Invoice">Invoice</option>
                  <option value="PO">PO</option>
                  <option value="Card">Card</option>
                  <option value="Unknown">Unknown</option>
                </select>
              </div>
              <div>
                <label for="decisionOwner">Likely signer / decision owner</label>
                <select id="decisionOwner" name="decisionOwner">
                  <option value="CIO">CIO</option>
                  <option value="CISO">CISO</option>
                  <option value="CTO">CTO</option>
                  <option value="VP IT / Director">VP IT / Director</option>
                  <option value="Procurement">Procurement</option>
                  <option value="Unknown">Unknown</option>
                </select>
              </div>
            </div>

            <div class="sectionTitle">Blockers present (select all that apply)</div>
            <div class="checks" role="group" aria-label="Blockers">
              <label class="check"><input type="checkbox" name="blockers" value="Privacy"><span><div class="t">Privacy</div><div class="d">Data handling, disclosure, DPIA/PIA posture.</div></span></label>
              <label class="check"><input type="checkbox" name="blockers" value="Legal"><span><div class="t">Legal</div><div class="d">MSA/SOW/DPA review, terms, liability.</div></span></label>
              <label class="check"><input type="checkbox" name="blockers" value="Procurement"><span><div class="t">Procurement</div><div class="d">Vendor onboarding, PO/invoice lane, pricing steps.</div></span></label>
              <label class="check"><input type="checkbox" name="blockers" value="Vendor Risk"><span><div class="t">Vendor Risk</div><div class="d">Security posture, evidence, risk questionnaire.</div></span></label>
              <label class="check"><input type="checkbox" name="blockers" value="InfoSec"><span><div class="t">InfoSec</div><div class="d">Access, controls, logging, data boundary.</div></span></label>
              <label class="check"><input type="checkbox" name="blockers" value="Records / Retention"><span><div class="t">Records / Retention</div><div class="d">Retention, eDiscovery, audit trail expectations.</div></span></label>
            </div>

            <div class="sectionTitle">Need & timing</div>
            <div class="formgrid">
              <div>
                <label for="pain">Primary pain <span class="req">*</span></label>
                <select id="pain" name="pain" required>
                  <option value="Copilot rollout blocked by procurement/privacy">Copilot rollout blocked by procurement/privacy</option>
                  <option value="Oversharing / external sharing risk">Oversharing / external sharing risk</option>
                  <option value="Purview/DLP readiness gaps">Purview/DLP readiness gaps</option>
                  <option value="Retention/eDiscovery posture unclear">Retention/eDiscovery posture unclear</option>
                  <option value="Connector / plugin governance">Connector / plugin governance</option>
                  <option value="Data boundary / sensitivity mapping">Data boundary / sensitivity mapping</option>
                </select>
              </div>
              <div>
                <label for="timeline">Timeline</label>
                <select id="timeline" name="timeline">
                  <option value="0-30">0–30 days</option>
                  <option value="31-60">31–60 days</option>
                  <option value="61-90">61–90 days</option>
                  <option value="90+">90+ days</option>
                </select>
              </div>
              <div>
                <label for="budgetBand">Budget band (optional)</label>
                <select id="budgetBand" name="budgetBand">
                  <option value="unknown">Unknown</option>
                  <option value="<10k">&lt; 10k</option>
                  <option value="10-25k">10–25k</option>
                  <option value="25-50k">25–50k</option>
                  <option value="50k+">50k+</option>
                </select>
              </div>
              <div>
                <label for="offerHint">Suggested entry offer</label>
                <select id="offerHint" name="offerHint">
                  <option value="QuickScan (5–7 business days)">QuickScan (5–7 business days)</option>
                  <option value="Readiness (2 weeks) — Starter (CAD 9,500)">Readiness (2 weeks) — Starter (CAD 9,500)</option>
                  <option value="Readiness (4 weeks) — Standard (CAD 15,000)">Readiness (4 weeks) — Standard (CAD 15,000)</option>
                  <option value="Readiness (6 weeks) — Extended (CAD 25,000)">Readiness (6 weeks) — Extended (CAD 25,000)</option>
                </select>
              </div>
            </div>

            <div class="sectionTitle">Sourcing signals (tiering)</div>
            <div class="formgrid">
              <div>
                <label for="partnerSourced">Partner-sourced (your account/network)?</label>
                <select id="partnerSourced" name="partnerSourced">
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                  <option value="unknown">Unknown</option>
                </select>
              </div>
              <div>
                <label for="canArrangeMeetings">Can you arrange 2 buyer-side meetings?</label>
                <select id="canArrangeMeetings" name="canArrangeMeetings">
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                  <option value="unknown">Unknown</option>
                </select>
              </div>
              <div>
                <label for="canSupportClose">Support close through signature + payment/PO?</label>
                <select id="canSupportClose" name="canSupportClose">
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                  <option value="unknown">Unknown</option>
                </select>
              </div>
              <div>
                <label for="requestedTier">Requested tier</label>
                <select id="requestedTier" name="requestedTier">
                  <option value="auto">Auto (system suggestion)</option>
                  <option value="Referral (15%)">Referral (15%)</option>
                  <option value="Channel (20% + bonus)">Channel (20% + bonus)</option>
                  <option value="Prime (30% — eligibility)">Prime (30% — eligibility)</option>
                  <option value="Delivery (scope split)">Delivery (scope split)</option>
                </select>
              </div>
            </div>

            <div class="sectionTitle">Notes (non-confidential)</div>
            <div>
              <label for="notes">Context / constraints / what you want us to do next</label>
              <textarea id="notes" name="notes" placeholder="Example: Copilot pilot is live; privacy wants retention proof; procurement needs vendor snapshot; aim to decide in 30 days."></textarea>
              <div class="hint">No secrets. No customer data. Use high-level constraints and routing needs.</div>
            </div>

            <div class="sectionTitle">Attestations</div>
            <div class="row">
              <label class="row" style="gap:10px; align-items:flex-start;">
                <input type="checkbox" id="attest1" required style="width:18px; margin-top:3px;" />
                <span class="hint">I confirm this registration is for routing/tiering and does not contain confidential data.</span>
              </label>
            </div>
            <div class="row">
              <label class="row" style="gap:10px; align-items:flex-start;">
                <input type="checkbox" id="attest2" required style="width:18px; margin-top:3px;" />
                <span class="hint">I understand deal protection is 90 days <strong>after acceptance</strong> (email confirmation), subject to Partner terms.</span>
              </label>
            </div>
          </form>

          <div class="row" style="margin-top:12px">
            <button class="btn primary" type="button" id="copyPacketBtn">Copy deal packet</button>
            <button class="btn" type="button" id="downloadJsonBtn">Download JSON</button>
            <button class="btn" type="button" id="downloadTxtBtn">Download TXT</button>
            <button class="btn" type="button" id="emailRegBtn">Email registration</button>
            <button class="btn" type="button" id="emailIntroBtn">Build warm intro</button>
          </div>

          <details style="margin-top:12px">
            <summary>
              Tier definitions & payout baseline (summary)
              <span class="chev">˅</span>
            </summary>
            <div class="detailsBody">
              <ul>
                <li><strong>Referral (15%)</strong>: warm intro only; Noetfield runs the sales cycle. Payable on first paid engagement (Net Fee), after client funds received.</li>
                <li><strong>Channel (20% + bonus, cap 30%)</strong>: co-selling/account influence; bonus for accelerating close, procurement routing, and repeat volume.</li>
                <li><strong>Prime (30%)</strong>: eligibility requires partner-sourced + 2 meetings + close support through signature + payment/PO.</li>
                <li><strong>Delivery</strong>: implementation scope split via SOW/RACI; commercials handled per delivery agreement (commission not default).</li>
              </ul>
              <div class="hint" style="margin-top:8px">
                This page is not a contract. Final terms follow the Partner Agreement and written acceptance.
              </div>
            </div>
          </details>

          <details style="margin-top:10px">
            <summary>
              Deal protection (90 days) — how it works (summary)
              <span class="chev">˅</span>
            </summary>
            <div class="detailsBody">
              <ul>
                <li><strong>Protection is not automatic</strong>: it starts only after Noetfield sends written acceptance (email confirmation).</li>
                <li><strong>Protection window</strong>: 90 days from acceptance date, covering the specific opportunity registered under the Deal ID.</li>
                <li><strong>Scope</strong>: intended to protect partner-originated introductions from internal channel conflict, subject to Partner terms and good-faith progression.</li>
                <li><strong>Audit trail</strong>: keep the registration email and the RID + Deal ID for traceability.</li>
              </ul>
            </div>
          </details>

          <div class="fine">
            Net Fee excludes taxes and pass-through costs. Commissions/margins are payable after client funds are received.
            For procurement routing, use <a href="/gate/procurement/">/gate/procurement/</a> and include your RID + Deal ID.
          </div>
        </div>
      </div>

      <!-- Right: Summary -->
      <div class="card" id="summaryCard">
        <div class="hd">
          <div>
            <h3>Summary (auto)</h3>
            <div class="meta">Tier suggestion • IDs • next actions • deep links</div>
          </div>
          <div class="row">
            <button class="btn small" type="button" id="refreshBtn">Refresh</button>
          </div>
        </div>

        <div class="bd">
          <div class="kv">
            <div class="line">
              <div class="k">Partner Deal ID</div>
              <div class="v mono" id="dealIdText">NF-PD-—</div>
              <div class="row" style="margin-top:10px">
                <button class="btn small" type="button" id="copyDealBtn">Copy</button>
                <button class="btn small" type="button" id="copyDeepLinkBtn" title="Copy this page link with RID + Deal ID.">Copy link</button>
              </div>
              <div class="hint" style="margin-top:8px">Share this link internally to continue the same Deal ID + RID.</div>
            </div>

            <div class="line">
              <div class="k">Tier suggestion</div>
              <div class="v" id="tierExplain">Complete the sourcing signals to compute tier.</div>
              <div class="split">
                <div class="badge"><span class="dot good"></span>Referral: 15%</div>
                <div class="badge"><span class="dot"></span>Channel: 20% + bonus (cap 30%)</div>
              </div>
              <div class="badge" style="margin-top:10px"><span class="dot good"></span>Prime: 30% (eligibility-based)</div>
            </div>

            <div class="line">
              <div class="k">Recommended next step</div>
              <div class="v" id="nextStep">Generate a Deal ID, then email the registration packet to Noetfield.</div>
              <div class="row" style="margin-top:10px">
                <button class="btn small primary" type="button" id="copySubjectBtn" title="Copy a procurement-safe subject line.">Copy subject</button>
                <button class="btn small" type="button" id="copyPacketMiniBtn">Copy packet</button>
              </div>
            </div>

            <div class="line">
              <div class="k">Procurement lane</div>
              <div class="v">
                If the buyer needs Invoice/PO routing, send:
                <div class="row" style="margin-top:10px">
                  <a class="btn small primary" href="/gate/procurement/" id="procLink">Open procurement page</a>
                  <button class="btn small" type="button" id="copyProcLinkBtn">Copy link</button>
                </div>
                <div class="hint" style="margin-top:8px">Use the subject line with RID + Deal ID.</div>
              </div>
            </div>

            <div class="line">
              <div class="k">Protection status</div>
              <div class="v" id="protectStatus">
                Pending acceptance. Protection starts after Noetfield confirms acceptance by email and lasts 90 days.
              </div>
              <div class="hint" style="margin-top:8px" id="protectDatesHint">Tip: keep a copy of your registration email for audit trail.</div>
            </div>
          </div>

          <div class="fine">
            Prime eligibility requires: partner-sourced + 2 buyer-side meetings + close support through signature/payment/PO.
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <div>© <span id="y"></span> Noetfield Systems Inc.</div>
      <div class="hint">
        Use: <a href="/gate/">/gate/</a> • <a href="/gate/procurement/">/gate/procurement/</a> • <a href="/status/">/status/</a>
      </div>
    </div>
  </div>

  <!-- Mobile action bar -->
  <div class="actionbar" role="region" aria-label="Quick actions">
    <div class="inner">
      <div class="meta">
        <span class="tag mono" id="dealIdTag2">NF-PD-—</span>
        <span class="pill mono">RID: <strong id="ridText2">—</strong></span>
      </div>
      <div class="cta">
        <button class="btn small" type="button" id="copyPacketBarBtn">Copy packet</button>
        <button class="btn small primary" type="button" id="emailRegBarBtn">Email</button>
      </div>
    </div>
  </div>

  <script>
    // ---------------- config ----------------
    // Change routing address if you prefer (e.g., partnerships@noetfield.com)
    const ROUTE_EMAIL = "sales@noetfield.com";

    // ---------------- helpers ----------------
    const $ = (id)=>document.getElementById(id);

    function randAlphaNum(n){
      const chars="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
      let out="";
      for(let i=0;i<n;i++) out += chars[Math.floor(Math.random()*chars.length)];
      return out;
    }
    function todayYYYYMMDD(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return `${y}${m}${day}`;
    }
    function normalizeDomain(s){
      return (s || "").trim().replace(/^https?:\/\//i,"").replace(/\/.*$/,"");
    }
    function getCheckedValues(name){
      return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(x=>x.value);
    }
    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        return true;
      }catch(e){
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand("copy"); }catch(_){}
        document.body.removeChild(ta);
        return false;
      }
    }
    function downloadText(filename, content, mime="text/plain"){
      const blob = new Blob([content], {type:mime});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      URL.revokeObjectURL(a.href);
      document.body.removeChild(a);
    }
    function buildMailto(to, subject, body){
      const u = new URL("mailto:" + to);
      u.searchParams.set("subject", subject);
      u.searchParams.set("body", body);
      return u.toString();
    }
    function setURLParams(params){
      const url = new URL(location.href);
      Object.entries(params).forEach(([k,v])=>{
        if(v === null || v === undefined || v === "") url.searchParams.delete(k);
        else url.searchParams.set(k, v);
      });
      history.replaceState({}, "", url.toString());
    }

    // ---------------- ID management (Gate-aligned) ----------------
    function ensureRID(){
      const qs = new URLSearchParams(location.search);
      const urlRid = qs.get("rid");
      const lsKey = "nf_rid";
      let rid = urlRid || localStorage.getItem(lsKey);
      if(!rid){
        rid = `RID-${randAlphaNum(8)}-${randAlphaNum(6)}`;
      }
      localStorage.setItem(lsKey, rid);
      return rid;
    }
    function newDealID(){
      const stamp = todayYYYYMMDD();
      const seq = String(Math.floor(Math.random()*9000)+1000);
      return `NF-PD-${stamp}-${seq}`;
    }
    function ensureDealID(forceNew=false){
      const qs = new URLSearchParams(location.search);
      const urlDeal = qs.get("deal");
      const lsKey = "nf_partner_deal_last";
      if(forceNew){
        const fresh = newDealID();
        localStorage.setItem(lsKey, fresh);
        setURLParams({ deal: fresh });
        return fresh;
      }
      let id = urlDeal || localStorage.getItem(lsKey);
      if(!id){
        id = newDealID();
        localStorage.setItem(lsKey, id);
      }
      setURLParams({ deal: id });
      return id;
    }
    function draftKey(dealId){ return `nf_pd_draft__${dealId}`; }

    // ---------------- packet ----------------
    function getFormPacket(){
      const blockers = getCheckedValues("blockers");
      return {
        rid: $("ridText").textContent,
        partner_deal_id: $("dealIdText").textContent,
        timestamp_iso: new Date().toISOString(),
        partner: {
          name: $("partnerName").value.trim(),
          type: $("partnerType").value,
          contact: $("partnerContact").value.trim(),
          email: $("partnerEmail").value.trim()
        },
        opportunity: {
          company: $("companyName").value.trim(),
          domain: normalizeDomain($("companyDomain").value),
          industry: $("industry").value,
          employee_band: $("sizeBand").value
        },
        buyer_side: {
          champion_role: $("championRole").value,
          champion_email: $("championEmail").value.trim(),
          buying_lane: $("buyLane").value,
          decision_owner: $("decisionOwner").value,
          blockers_present: blockers
        },
        need: {
          primary_pain: $("pain").value,
          timeline: $("timeline").value,
          budget_band: $("budgetBand").value,
          suggested_entry_offer: $("offerHint").value
        },
        tiering_signals: {
          partner_sourced: $("partnerSourced").value,
          can_arrange_two_meetings: $("canArrangeMeetings").value,
          can_support_close: $("canSupportClose").value,
          requested_tier: $("requestedTier").value
        },
        notes: $("notes").value.trim(),
        attestations: {
          non_confidential: $("attest1").checked,
          deal_protection_understood: $("attest2").checked
        }
      };
    }

    function packetToText(packet){
      const lines = [];
      lines.push(`RID: ${packet.rid}`);
      lines.push(`Partner Deal ID: ${packet.partner_deal_id}`);
      lines.push(`Timestamp: ${packet.timestamp_iso}`);
      lines.push("");
      lines.push("Partner");
      lines.push(`- Name: ${packet.partner.name || "—"}`);
      lines.push(`- Type: ${packet.partner.type}`);
      lines.push(`- Contact: ${packet.partner.contact || "—"}`);
      lines.push(`- Email: ${packet.partner.email || "—"}`);
      lines.push("");
      lines.push("Opportunity");
      lines.push(`- Company: ${packet.opportunity.company || "—"}`);
      lines.push(`- Domain: ${packet.opportunity.domain || "—"}`);
      lines.push(`- Industry: ${packet.opportunity.industry}`);
      lines.push(`- Employee band: ${packet.opportunity.employee_band}`);
      lines.push("");
      lines.push("Buyer-side");
      lines.push(`- Champion role: ${packet.buyer_side.champion_role}`);
      lines.push(`- Champion email: ${packet.buyer_side.champion_email || "—"}`);
      lines.push(`- Decision owner: ${packet.buyer_side.decision_owner}`);
      lines.push(`- Blockers: ${(packet.buyer_side.blockers_present || []).join(", ") || "—"}`);
      lines.push(`- Buying lane: ${packet.buyer_side.buying_lane}`);
      lines.push("");
      lines.push("Need & timing");
      lines.push(`- Primary pain: ${packet.need.primary_pain}`);
      lines.push(`- Timeline: ${packet.need.timeline}`);
      lines.push(`- Budget band: ${packet.need.budget_band}`);
      lines.push(`- Suggested entry offer: ${packet.need.suggested_entry_offer}`);
      lines.push("");
      lines.push("Tiering signals");
      lines.push(`- Partner-sourced: ${packet.tiering_signals.partner_sourced}`);
      lines.push(`- Can arrange 2 meetings: ${packet.tiering_signals.can_arrange_two_meetings}`);
      lines.push(`- Can support close: ${packet.tiering_signals.can_support_close}`);
      lines.push(`- Requested tier: ${packet.tiering_signals.requested_tier}`);
      lines.push("");
      lines.push("Notes");
      lines.push(packet.notes || "—");
      lines.push("");
      lines.push("Attestations");
      lines.push(`- Non-confidential: ${packet.attestations.non_confidential}`);
      lines.push(`- Deal protection understood: ${packet.attestations.deal_protection_understood}`);
      lines.push("");
      lines.push("Operational note");
      lines.push("- Protection is 90 days after written acceptance by Noetfield (email confirmation), subject to Partner terms.");
      return lines.join("\n");
    }

    function validateRequired(){
      const requiredOk =
        !!$("partnerName").value.trim() &&
        !!$("partnerContact").value.trim() &&
        !!$("partnerEmail").value.trim() &&
        !!$("companyName").value.trim() &&
        $("attest1").checked &&
        $("attest2").checked;

      if(!requiredOk){
        alert("Please complete required fields: Partner name, partner contact, partner email, company name, and both attestations.");
        return false;
      }
      return true;
    }

    // ---------------- tier computation (simple + explainable) ----------------
    function computeTier(packet){
      const ps = packet.tiering_signals.partner_sourced === "yes";
      const meet = packet.tiering_signals.can_arrange_two_meetings === "yes";
      const close = packet.tiering_signals.can_support_close === "yes";
      const requested = packet.tiering_signals.requested_tier;

      let suggested = "Pending";
      let explain = "Complete the sourcing signals to compute tier.";
      let dot = "warn";

      if(packet.partner.type === "Delivery"){
        suggested = "Delivery (scope split)";
        explain = "Delivery Partner: implementation scope split via SOW/RACI. Commercials handled per delivery agreement (not default commission).";
        dot = "good";
      } else if(ps && meet && close){
        suggested = "Prime (30% — eligibility met)";
        explain = "Prime eligible: partner-sourced + 2 buyer-side meetings + close support through signature + payment/PO.";
        dot = "good";
      } else if(packet.partner.type === "Referral" || packet.tiering_signals?.partner_sourced === "no"){
        suggested = "Referral (15%)";
        explain = "Referral: warm intro only; Noetfield runs the sales cycle. Paid on first paid engagement (Net Fee), after client funds received.";
        dot = "good";
      } else {
        suggested = "Channel (20% + bonus, cap 30%)";
        explain = "Channel: co-selling/account influence. 20% base; bonus up to 30% for accelerating close + procurement routing + volume.";
        dot = "warn";
      }

      if(requested && requested !== "auto"){
        const eligibility = (ps && meet && close) ? "eligible" : "not eligible yet";
        explain = `Requested: ${requested}. System: ${suggested}. Prime eligibility: ${eligibility}.`;
      }

      return { suggested, explain, dot, primeEligible: (ps && meet && close) };
    }

    // ---------------- draft save/restore (+ autosave) ----------------
    function saveDraft(){
      const dealId = $("dealIdText").textContent;
      const k = draftKey(dealId);
      const packet = getFormPacket();
      localStorage.setItem(k, JSON.stringify(packet));
      localStorage.setItem("nf_partner_deal_autosave_last", new Date().toISOString());
      return true;
    }

    function restoreDraftIfAny(){
      const dealId = $("dealIdText").textContent;
      const k = draftKey(dealId);
      const raw = localStorage.getItem(k);
      if(!raw) return false;

      try{
        const p = JSON.parse(raw);
        $("partnerName").value = p.partner?.name || "";
        $("partnerType").value = p.partner?.type || "Channel";
        $("partnerContact").value = p.partner?.contact || "";
        $("partnerEmail").value = p.partner?.email || "";

        $("companyName").value = p.opportunity?.company || "";
        $("companyDomain").value = p.opportunity?.domain || "";
        $("industry").value = p.opportunity?.industry || "Financial";
        $("sizeBand").value = p.opportunity?.employee_band || "500-1k";

        $("championRole").value = p.buyer_side?.champion_role || "Modern Workplace / M365 Owner";
        $("championEmail").value = p.buyer_side?.champion_email || "";
        $("buyLane").value = p.buyer_side?.buying_lane || "Unknown";
        $("decisionOwner").value = p.buyer_side?.decision_owner || "Unknown";

        const blockers = p.buyer_side?.blockers_present || [];
        Array.from(document.querySelectorAll('input[name="blockers"]')).forEach(cb=>{
          cb.checked = blockers.includes(cb.value);
        });

        $("pain").value = p.need?.primary_pain || "Copilot rollout blocked by procurement/privacy";
        $("timeline").value = p.need?.timeline || "31-60";
        $("budgetBand").value = p.need?.budget_band || "unknown";
        $("offerHint").value = p.need?.suggested_entry_offer || "QuickScan (5–7 business days)";

        $("partnerSourced").value = p.tiering_signals?.partner_sourced || "unknown";
        $("canArrangeMeetings").value = p.tiering_signals?.can_arrange_two_meetings || "unknown";
        $("canSupportClose").value = p.tiering_signals?.can_support_close || "unknown";
        $("requestedTier").value = p.tiering_signals?.requested_tier || "auto";

        $("notes").value = p.notes || "";
        $("attest1").checked = !!p.attestations?.non_confidential;
        $("attest2").checked = !!p.attestations?.deal_protection_understood;
        return true;
      }catch(_){
        return false;
      }
    }

    function clearDraft(){
      const dealId = $("dealIdText").textContent;
      localStorage.removeItem(draftKey(dealId));
      return true;
    }

    let autosaveTimer = null;
    function autosaveDebounced(){
      clearTimeout(autosaveTimer);
      autosaveTimer = setTimeout(()=>{ saveDraft(); }, 650);
    }

    // ---------------- render ----------------
    function render(){
      $("y").textContent = new Date().getFullYear();

      const rid = ensureRID();
      $("ridText").textContent = rid;
      $("ridText2").textContent = rid;

      const dealId = ensureDealID(false);
      $("dealIdText").textContent = dealId;
      $("dealIdTag").textContent = dealId;
      $("dealIdTag2").textContent = dealId;

      // keep URL synced
      setURLParams({ rid, deal: dealId });

      const packet = getFormPacket();
      packet.rid = rid;
      packet.partner_deal_id = dealId;

      const tier = computeTier(packet);
      $("tierText").textContent = `Tier: ${tier.suggested}`;
      $("tierExplain").textContent = tier.explain;

      const dot = $("tierDot");
      dot.classList.remove("good","bad");
      if(tier.dot === "good") dot.classList.add("good");
      if(tier.dot === "bad") dot.classList.add("bad");

      const lane = packet.buyer_side.buying_lane;
      const next = (lane === "PO" || lane === "Invoice")
        ? "Email the registration packet now. Then route the buyer to Procurement (Invoice/PO) with RID + Deal ID."
        : "Email the registration packet now. If procurement is required, route via Procurement with RID + Deal ID.";
      $("nextStep").textContent = next;

      // procurement link with RID + Deal ID
      const proc = new URL(location.origin + "/gate/procurement/");
      proc.searchParams.set("rid", rid);
      proc.searchParams.set("deal", dealId);
      $("procLink").href = proc.toString();

      const company = packet.opportunity.company || "—";
      $("protectStatus").textContent =
        `Pending acceptance. Protection starts after written acceptance by Noetfield (email confirmation) and lasts 90 days. Deal: ${company}.`;
    }

    // ---------------- events ----------------
    window.addEventListener("DOMContentLoaded", () => {
      render();
      restoreDraftIfAny();
      render();

      $("dealForm").addEventListener("input", () => { render(); autosaveDebounced(); });
      $("dealForm").addEventListener("change", () => { render(); autosaveDebounced(); });

      $("genDealBtn").addEventListener("click", () => {
        const fresh = ensureDealID(true);
        $("dealIdText").textContent = fresh;
        $("dealIdTag").textContent = fresh;
        $("dealIdTag2").textContent = fresh;

        $("attest1").checked = false;
        $("attest2").checked = false;

        render();
        restoreDraftIfAny();
        render();
      });

      $("saveDraftBtn").addEventListener("click", () => {
        saveDraft();
        $("saveDraftBtn").textContent = "Saved";
        setTimeout(()=> $("saveDraftBtn").textContent = "Save", 900);
      });

      $("clearDraftBtn").addEventListener("click", () => {
        clearDraft();
        $("clearDraftBtn").textContent = "Cleared";
        setTimeout(()=> $("clearDraftBtn").textContent = "Clear", 900);
        render();
      });

      $("refreshBtn").addEventListener("click", () => render());

      $("copyRidBtn").addEventListener("click", async () => {
        await copyText($("ridText").textContent);
        $("copyRidBtn").textContent = "Copied";
        setTimeout(()=> $("copyRidBtn").textContent = "Copy", 900);
      });

      $("copyDealBtn").addEventListener("click", async () => {
        await copyText($("dealIdText").textContent);
        $("copyDealBtn").textContent = "Copied";
        setTimeout(()=> $("copyDealBtn").textContent = "Copy", 900);
      });

      $("copyDeepLinkBtn").addEventListener("click", async () => {
        await copyText(location.href);
        $("copyDeepLinkBtn").textContent = "Copied";
        setTimeout(()=> $("copyDeepLinkBtn").textContent = "Copy link", 900);
      });

      $("copySubjectBtn").addEventListener("click", async () => {
        const p = getFormPacket();
        const subject = `[Partner Deal] ${p.opportunity.company || "Company"} — ${$("dealIdText").textContent} — RID ${$("ridText").textContent}`;
        await copyText(subject);
        $("copySubjectBtn").textContent = "Copied";
        setTimeout(()=> $("copySubjectBtn").textContent = "Copy subject", 900);
      });

      async function doCopyPacket(buttonEl, resetText){
        if(!validateRequired()) return;
        const packet = getFormPacket();
        packet.rid = $("ridText").textContent;
        packet.partner_deal_id = $("dealIdText").textContent;
        const txt = packetToText(packet);
        await copyText(txt);
        buttonEl.textContent = "Copied";
        setTimeout(()=> buttonEl.textContent = resetText, 1100);
      }

      $("copyPacketBtn").addEventListener("click", () => doCopyPacket($("copyPacketBtn"), "Copy deal packet"));
      $("copyPacketMiniBtn").addEventListener("click", () => doCopyPacket($("copyPacketMiniBtn"), "Copy packet"));
      $("copyPacketBarBtn").addEventListener("click", () => doCopyPacket($("copyPacketBarBtn"), "Copy packet"));

      $("downloadJsonBtn").addEventListener("click", () => {
        if(!validateRequired()) return;
        const packet = getFormPacket();
        packet.rid = $("ridText").textContent;
        packet.partner_deal_id = $("dealIdText").textContent;
        downloadText(`${packet.partner_deal_id}.json`, JSON.stringify(packet, null, 2), "application/json");
      });

      $("downloadTxtBtn").addEventListener("click", () => {
        if(!validateRequired()) return;
        const packet = getFormPacket();
        packet.rid = $("ridText").textContent;
        packet.partner_deal_id = $("dealIdText").textContent;
        downloadText(`${packet.partner_deal_id}.txt`, packetToText(packet), "text/plain");
      });

      function emailRegistration(){
        if(!validateRequired()) return;

        const packet = getFormPacket();
        packet.rid = $("ridText").textContent;
        packet.partner_deal_id = $("dealIdText").textContent;

        const tier = computeTier(packet);
        const subject = `[Partner Deal Registration] ${packet.opportunity.company} — ${packet.partner_deal_id} — RID ${packet.rid}`;
        const body =
`Hello Noetfield Partnerships,

Please find the partner deal registration packet below.

Tier (system): ${tier.suggested}
Link (RID+Deal): ${location.href}

${packetToText(packet)}

Thank you,
${packet.partner.contact || "—"}
${packet.partner.name || "—"}`;

        location.href = buildMailto(ROUTE_EMAIL, subject, body);
      }

      $("emailRegBtn").addEventListener("click", emailRegistration);
      $("emailRegBarBtn").addEventListener("click", emailRegistration);

      $("emailIntroBtn").addEventListener("click", () => {
        const company = $("companyName").value.trim();
        if(!company){
          alert("Please add at least the company name.");
          return;
        }
        const rid = $("ridText").textContent;
        const dealId = $("dealIdText").textContent;
        const pain = $("pain").value;
        const offer = $("offerHint").value;

        const subject = `Intro — Noetfield (Copilot governance + procurement pack) — ${company}`;
        const body =
`Hi [Buyer Name],

Introducing Noetfield (Sina). They help Microsoft-heavy teams unblock Copilot rollout decisions with board-ready evidence and a procurement pack aligned to privacy/procurement.

Why this is relevant: ${pain}
Suggested entry: ${offer}

If helpful, can we do 15 minutes next week? (Invoice/PO supported.)

Ref: RID ${rid} • Deal ID ${dealId}`;

        location.href = buildMailto("", subject, body);
      });

      $("copyProcLinkBtn").addEventListener("click", async () => {
        await copyText($("procLink").href);
        $("copyProcLinkBtn").textContent = "Copied";
        setTimeout(()=> $("copyProcLinkBtn").textContent = "Copy link", 900);
      });
    });
  </script>
</body>
</html>

