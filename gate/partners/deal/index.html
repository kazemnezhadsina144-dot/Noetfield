<!-- /gate/partners/deal/index.html — Noetfield Partner Deal Registration v4.2
     (Prime qualifiers • lane confirmation • SLA aligned • partner tier vs deal signal • email routing fixed) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Noetfield — Partner Deal Registration</title>
  <meta name="description" content="Register a partner-sourced opportunity to receive a Partner Deal ID, compute a partner tier suggestion, and route procurement safely — without sharing confidential data." />
  <meta name="robots" content="index,follow" />
  <meta name="author" content="Noetfield Systems Inc." />
  <meta name="theme-color" content="#07070b" />

  <link rel="canonical" href="https://www.noetfield.com/gate/partners/deal/" />
  <link rel="icon" href="/noetfield-favicon-512.png" type="image/png" />
  <link rel="apple-touch-icon" href="/noetfield-favicon-512.png" />

  <!-- OG -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Noetfield" />
  <meta property="og:title" content="Noetfield — Partner Deal Registration" />
  <meta property="og:description" content="Partner Deal ID, tier suggestion, protection (on acceptance), and procurement routing — non-confidential." />
  <meta property="og:url" content="https://www.noetfield.com/gate/partners/deal/" />
  <meta property="og:image" content="https://www.noetfield.com/noetfield-og.png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Noetfield — Partner Deal Registration" />
  <meta name="twitter:description" content="Partner Deal ID, tier suggestion, protection (on acceptance), and procurement routing — non-confidential." />
  <meta name="twitter:image" content="https://www.noetfield.com/noetfield-og.png" />

  <!-- Shell -->
  <link rel="stylesheet" href="/assets/noetfield-shell.css" />
  <script src="/assets/noetfield-shell.js" defer></script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Noetfield — Partner Deal Registration",
    "url":"https://www.noetfield.com/gate/partners/deal/",
    "isPartOf":{"@type":"WebSite","name":"Noetfield","url":"https://www.noetfield.com/"},
    "publisher":{"@type":"Organization","name":"Noetfield Systems Inc."}
  }
  </script>

  <style>
    .hero{padding:18px 0 12px}
    .heroShell{
      position:relative;
      border-radius: calc(var(--radius) + 10px);
      border: 1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(1100px 520px at 16% 0%, rgba(200,163,73,.18), transparent 62%),
        radial-gradient(980px 520px at 92% 10%, rgba(122,167,255,.10), transparent 64%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.020));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .heroShell::before{
      content:"";
      position:absolute; inset:-1px;
      background: linear-gradient(120deg, rgba(200,163,73,.26), transparent 32%, rgba(255,255,255,.08) 68%, transparent);
      opacity:.44;
      pointer-events:none;
      mask-image: linear-gradient(180deg, black 0%, black 62%, transparent 96%);
    }
    .heroInner{padding: 22px 22px; position:relative; z-index:1}

    .kickerRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12.8px;
      white-space:nowrap;
    }
    .badge strong{color:var(--text); font-weight:950}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace}
    .dot{width:8px; height:8px; border-radius:999px; background: rgba(200,163,73,.95); box-shadow: 0 0 0 3px rgba(200,163,73,.16);}
    .dot.good{background: rgba(115,211,155,.95); box-shadow: 0 0 0 3px rgba(115,211,155,.16);}
    .dot.warn{background: rgba(240,195,106,.95); box-shadow: 0 0 0 3px rgba(240,195,106,.16);}
    .dot.bad{background: rgba(255,122,122,.95); box-shadow: 0 0 0 3px rgba(255,122,122,.16);}

    h1{margin:12px 0 8px; font-size: clamp(26px, 2.6vw, 40px); line-height:1.08; letter-spacing:-0.7px}
    .lead{margin:0; color:var(--muted); font-size:15.6px; line-height:1.75; max-width: 980px}
    .lead strong{color:var(--text); font-weight:950}

    .notice{
      margin-top:12px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color:var(--muted2);
      font-size:12.8px;
      line-height:1.6;
    }
    .notice strong{ color:var(--text); font-weight:950; }
    .notice a{ border-bottom:1px solid rgba(255,255,255,.18); }

    .actions{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px}
    .actions .btn{min-height:44px}

    .grid{
      display:grid;
      grid-template-columns: 1.12fr .88fr;
      gap:16px;
      margin: 14px 0 36px;
      align-items:start;
    }
    .card{
      border-radius:var(--radius);
      border:1px solid rgba(255,255,255,.11);
      background: linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.022));
      box-shadow: var(--shadow2);
      overflow:hidden;
      min-width:0;
    }
    .hd{ padding:18px 18px 0; display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap;}
    .bd{ padding:18px; }
    .cardTitle{ margin:0 0 6px; font-size:18px; letter-spacing:-0.2px; font-weight:950; }
    .muted{ color:var(--muted); line-height:1.7; margin:0; }

    .toolbar{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .toolbar .btn{min-height:40px}

    .section{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius:16px;
      padding:14px;
      margin-top:12px;
    }
    .sectionTitle{font-weight:950; letter-spacing:-.2px; margin:0 0 6px; font-size:14px; color:var(--text)}
    .sectionDesc{margin:0 0 10px; color:var(--muted2); font-size:12.7px; line-height:1.6}

    .row{ display:grid; gap:10px; grid-template-columns: repeat(12, minmax(0, 1fr)); }
    .field{ grid-column: span 6; min-width:0; }
    .field.third{ grid-column: span 4; }
    .field.full{ grid-column: span 12; }

    .label{
      display:block;
      color: var(--muted2);
      font-size: 11px;
      letter-spacing: .28em;
      text-transform: uppercase;
      margin: 0 0 6px;
    }
    .input, .select, .textarea{
      width:100%;
      padding:10px 11px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(5,8,20,.72);
      color: rgba(255,255,255,.92);
      font-size:13px;
      outline:none;
    }
    .textarea{ resize: vertical; min-height: 120px; }

    .checkgrid{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; margin-top:10px}
    .check{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .check input{width:18px; margin-top:2px}
    .check .t{font-size:12.6px; color:var(--text); margin:0 0 2px; font-weight:950}
    .check .d{font-size:12.6px; color:var(--muted2); margin:0; line-height:1.55}

    .err{
      display:none;
      margin-top:12px;
      border:1px solid rgba(255,122,122,.25);
      background: rgba(255,122,122,.08);
      border-radius:14px;
      padding:10px 12px;
      color:var(--muted2);
      font-size:12.6px;
      line-height:1.55;
    }
    .err strong{color:var(--text); font-weight:950}
    .err ul{margin:8px 0 0 18px; padding:0}
    .err li{margin:6px 0}

    .rail{ position: sticky; top: 14px; }
    .box{
      margin-top:12px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color:var(--muted2);
      font-size:12.8px;
      line-height:1.6;
    }
    .box strong{color:var(--text); font-weight:950}
    .box a{border-bottom:1px solid rgba(255,255,255,.18)}
    .railActions{ display:grid; gap:10px; margin-top:12px; }
    .railActions .btn{ min-height:46px; }
    .divider{ height:1px; background: rgba(255,255,255,.10); margin: 14px 0; }

    .kv{display:grid; gap:10px; margin-top:10px}
    .kvLine{
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      padding:10px;
    }
    .kvLine .k{color:var(--muted2); font-size:11px; letter-spacing:.28em; text-transform:uppercase}
    .kvLine .v{margin-top:6px; color:var(--muted); font-size:13px; line-height:1.6}
    .kvLine .v strong{color:var(--text); font-weight:950}

    .bottomBar{
      z-index: 30;
      padding: 10px 0 calc(10px + env(safe-area-inset-bottom));
      background: linear-gradient(180deg, rgba(7,7,11,0) 0%, rgba(7,7,11,.78) 22%, rgba(7,7,11,.92) 100%);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255,255,255,.08);
      display:none;
    }
    .bottomInner{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      padding: 0 16px; max-width: 1120px; margin: 0 auto;
    }
    .bottomText{
      min-width:0; color:var(--muted); font-size:12.6px; line-height:1.4;
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }
    .bottomText strong{ color:var(--text); font-weight:950; }
    .bottomBtns{display:flex; gap:10px; align-items:center}
    .bottomInner .btn{ min-height:46px; }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .rail{ position: relative; top: 0; }
      .field, .field.third{ grid-column: span 12; }
    }
    @media (max-width: 760px){
      .heroInner{ padding: 18px 14px; }
      .hd, .bd{ padding-left:14px; padding-right:14px; }
      .bottomBar{
        display:block;
        position: fixed;
        left: 0; right: 0; bottom: 0;
      }
      body{ padding-bottom: calc(86px + env(safe-area-inset-bottom)); }
      .checkgrid{grid-template-columns:1fr}
    }
    @media (prefers-reduced-motion: reduce){
      *{ scroll-behavior:auto !important; }
    }
  </style>

  <script>
    (function(){
      function rnd(n){
        try{
          if (window.crypto && crypto.getRandomValues){
            var a = new Uint8Array(n);
            crypto.getRandomValues(a);
            return Array.from(a).map(x => (x % 36).toString(36)).join("").toUpperCase().slice(0,n);
          }
        }catch(e){}
        return Math.random().toString(36).slice(2, 2+n).toUpperCase();
      }

      function ensureRID(){
        try{
          var url = new URL(window.location.href);
          var rid = (url.searchParams.get("rid") || "").trim();
          if(!rid) rid = (sessionStorage.getItem("nf_rid") || "").trim();
          if(!rid){
            var c = document.cookie.match(/(?:^|;\s*)nf_rid=([^;]+)/);
            if(c && c[1]) rid = decodeURIComponent(c[1]).trim();
          }
          if(!rid){
            var d = new Date(), y=String(d.getUTCFullYear()).slice(2),
            m=String(d.getUTCMonth()+1).padStart(2,"0"), day=String(d.getUTCDate()).padStart(2,"0");
            rid="NF-"+y+m+day+"-"+rnd(6);
          }
          sessionStorage.setItem("nf_rid", rid);
          document.cookie = "nf_rid=" + encodeURIComponent(rid) + "; Path=/; SameSite=Lax";
          window.__NF_RID = rid;
          return rid;
        }catch(e){ return ""; }
      }

      function ensureDealId(){
        try{
          var url = new URL(window.location.href);
          var deal = (url.searchParams.get("deal") || "").trim();
          if(!deal){
            var d = new Date(), y=String(d.getUTCFullYear()).slice(2),
            m=String(d.getUTCMonth()+1).padStart(2,"0"), day=String(d.getUTCDate()).padStart(2,"0");
            deal = "NF-PD-" + y + m + day + "-" + rnd(5);
          }
          window.__NF_DEAL = deal;
          return deal;
        }catch(e){ return "NF-PD-—"; }
      }

      function stitchIds(){
        var rid = ensureRID();
        var deal = ensureDealId();

        var url = new URL(window.location.href);
        if(!url.searchParams.get("rid")) url.searchParams.set("rid", rid);
        if(!url.searchParams.get("deal")) url.searchParams.set("deal", deal);
        window.history.replaceState({}, "", url.pathname + url.search + url.hash);

        var ridText = document.getElementById("ridText"); if(ridText) ridText.textContent = rid;
        var dealText = document.getElementById("dealIdText"); if(dealText) dealText.textContent = deal;

        var dealRail = document.getElementById("dealIdRail"); if(dealRail) dealRail.textContent = deal;
        var ridRail = document.getElementById("ridRail"); if(ridRail) ridRail.textContent = rid;
        var bottomDeal = document.getElementById("bottomDeal"); if(bottomDeal) bottomDeal.textContent = "Deal: " + deal;

        document.querySelectorAll("[data-rid-link]").forEach(function(a){
          try{
            var href=a.getAttribute("href")||"";
            if(!href || href.indexOf("#")===0) return;
            var u=new URL(href, window.location.origin);
            if(!u.searchParams.get("rid")) u.searchParams.set("rid", rid);
            a.setAttribute("href", u.pathname+u.search+u.hash);
          }catch(e){}
        });

        var hiddenDeal = document.getElementById("dealIdHidden"); if(hiddenDeal) hiddenDeal.value = deal;
      }

      if(document.readyState==="loading") document.addEventListener("DOMContentLoaded", stitchIds);
      else stitchIds();
    })();
  </script>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>
  <a class="skip" href="#main">Skip to content</a>

  <header id="nfHeader"></header>

  <main id="main" class="wrap">
    <section class="hero" aria-label="Partner deal hero">
      <div class="heroShell">
        <div class="heroInner">
          <div class="kickerRow" aria-label="Deal badges">
            <span class="badge"><span class="dot"></span><strong>Deal ID</strong> <span class="mono" id="dealIdText">NF-PD-—</span></span>

            <span class="badge"><span class="dot" id="partnerTierDot"></span><strong>Partner Tier</strong> <span id="partnerTierText">Pending</span></span>

            <span class="badge"><span class="dot" id="dealSignalDot"></span><strong>Deal Signal</strong> <span id="dealSignalText">Pending</span></span>

            <span class="badge" title="Protection activates only after Noetfield accepts the registration (email confirmation)."><span class="dot good"></span><strong>Protection</strong> 90 days (on acceptance)</span>

            <span class="badge" title="Target turnaround for review and next steps."><span class="dot good"></span><strong>Target</strong> 1 business day • <strong>SLA</strong> 2 business days</span>

            <span class="badge" title="RID is used for routing + status updates. Non-confidential."><strong>RID</strong> <span class="mono" id="ridText">—</span></span>
          </div>

          <h1>Partner Deal Registration</h1>

          <p class="lead">
            Register a partner-sourced opportunity to receive a <strong>Deal ID</strong>, compute a <strong>partner tier suggestion</strong>,
            and route <strong>procurement safely</strong>. Submission is <strong>not acceptance</strong>. This page is for <strong>routing only</strong> — keep it <strong>non-confidential</strong>.
          </p>

          <div class="notice" role="note">
            <strong>Do not include:</strong> credentials, customer data, personal IDs, internal documents, pricing terms, or sensitive deal notes.
            Use sanitized, high-level signals only. Procurement onboarding routes via <a href="/gate/procurement/" data-rid-link>Invoice/PO lane</a>.
          </div>

          <div class="actions" aria-label="Hero actions">
            <a class="btn secondary" href="/gate/partners/" data-rid-link>Back to Partners</a>
            <a class="btn secondary" href="/gate/procurement/" data-rid-link>Procurement lane</a>
            <a class="btn secondary" href="/status/" data-rid-link>Status</a>
            <button class="btn secondary" type="button" id="copyDealLinkBtn">Copy deal link</button>
            <button class="btn primary" type="button" id="exportPacketBtn">Export packet</button>
          </div>
        </div>
      </div>
    </section>

    <section class="grid" aria-label="Deal layout">
      <!-- Left -->
      <section class="card" aria-label="Deal form">
        <div class="hd">
          <div>
            <h2 class="cardTitle">Deal details (non-confidential)</h2>
            <p class="muted">Draft-safe (local) • partner tier suggestion • deal signal • packet export • email builders • deep-linkable IDs</p>
          </div>
          <div class="toolbar" aria-label="Deal tools">
            <button class="btn secondary" type="button" id="newDealBtn" title="Creates a new Partner Deal ID and updates the URL.">New Deal ID</button>
            <button class="btn secondary" type="button" id="saveDraftBtn" title="Save a local draft for this Deal ID (browser only).">Save draft</button>
            <button class="btn secondary" type="button" id="loadDraftBtn" title="Load the saved local draft for this Deal ID.">Load</button>
            <button class="btn secondary" type="button" id="clearDraftBtn" title="Clear the saved local draft for this Deal ID.">Clear</button>
          </div>
        </div>

        <div class="bd">
          <div id="errBox" class="err" role="alert" aria-live="polite">
            <strong>Fix required items</strong>
            <ul id="errList"></ul>
          </div>

          <form id="dealForm" autocomplete="on" novalidate>
            <input type="hidden" id="dealIdHidden" name="dealId" value="" />

            <!-- Partner -->
            <div class="section">
              <div class="sectionTitle">Partner</div>
              <p class="sectionDesc">Submitting entity for the deal registration.</p>

              <div class="row">
                <div class="field">
                  <label class="label" for="partnerName">Partner name</label>
                  <input class="input" id="partnerName" name="partnerName" placeholder="e.g., Northshore MSP Ltd." />
                </div>
                <div class="field">
                  <label class="label" for="partnerEmail">Partner email</label>
                  <input class="input" id="partnerEmail" name="partnerEmail" placeholder="name@partner.com" inputmode="email" />
                </div>
                <div class="field">
                  <label class="label" for="partnerWebsite">Partner website</label>
                  <input class="input" id="partnerWebsite" name="partnerWebsite" placeholder="https://partner.com" inputmode="url" />
                </div>
                <div class="field">
                  <label class="label" for="partnerRole">Submitter role</label>
                  <input class="input" id="partnerRole" name="partnerRole" placeholder="e.g., Account Executive, Consultant, MSP Owner" />
                </div>
              </div>
            </div>

            <!-- Client -->
            <div class="section">
              <div class="sectionTitle">Client (target organization)</div>
              <p class="sectionDesc">High-level only. No sensitive details.</p>

              <div class="row">
                <div class="field">
                  <label class="label" for="clientOrg">Client organization</label>
                  <input class="input" id="clientOrg" name="clientOrg" placeholder="e.g., Pacific Credit Union" />
                </div>
                <div class="field">
                  <label class="label" for="clientDomain">Client domain</label>
                  <input class="input" id="clientDomain" name="clientDomain" placeholder="e.g., client.com" />
                </div>
                <div class="field third">
                  <label class="label" for="clientSize">Size (rough)</label>
                  <select class="select" id="clientSize" name="clientSize">
                    <option value="">Select…</option>
                    <option value="200-499">200–499</option>
                    <option value="500-999">500–999</option>
                    <option value="1000-4999">1,000–4,999</option>
                    <option value="5000+">5,000+</option>
                  </select>
                </div>
                <div class="field third">
                  <label class="label" for="industry">Industry</label>
                  <select class="select" id="industry" name="industry">
                    <option value="">Select…</option>
                    <option value="financial">Financial / Insurance / Credit Union</option>
                    <option value="health">Health</option>
                    <option value="public">Public sector / Agency</option>
                    <option value="legal">Legal / Professional services</option>
                    <option value="tech">Technology</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div class="field third">
                  <label class="label" for="geo">Geography</label>
                  <select class="select" id="geo" name="geo">
                    <option value="">Select…</option>
                    <option value="canada">Canada</option>
                    <option value="usa">USA</option>
                    <option value="uk-eu">UK/EU</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>

              <div class="row" style="margin-top:10px;">
                <div class="field">
                  <label class="label" for="championRole">Operational champion (role)</label>
                  <input class="input" id="championRole" name="championRole" placeholder="e.g., Director of Modern Workplace / M365 Platform Owner" />
                </div>
                <div class="field">
                  <label class="label" for="buyerRole">Signer / budget owner (role)</label>
                  <input class="input" id="buyerRole" name="buyerRole" placeholder="e.g., CIO / CISO / VP IT" />
                </div>
              </div>
            </div>

            <!-- Opportunity -->
            <div class="section">
              <div class="sectionTitle">Opportunity</div>
              <p class="sectionDesc">Stage + next-step timing. Keep wording non-confidential.</p>

              <div class="row">
                <div class="field third">
                  <label class="label" for="stage">Stage</label>
                  <select class="select" id="stage" name="stage">
                    <option value="">Select…</option>
                    <option value="sourced">Sourced (lead identified)</option>
                    <option value="intro">Warm intro sent</option>
                    <option value="meeting-set">Meeting set</option>
                    <option value="meeting-held">Meeting held</option>
                    <option value="qualified">Qualified (scope + urgency)</option>
                    <option value="proposal">Proposal / SOW in progress</option>
                    <option value="procurement">Procurement / onboarding</option>
                    <option value="commit">Verbal commit / signature pending</option>
                  </select>
                </div>

                <div class="field third">
                  <label class="label" for="lane">Primary lane</label>
                  <select class="select" id="lane" name="lane">
                    <option value="">Select…</option>
                    <option value="delivery">Delivery (artefacts)</option>
                    <option value="integration">Integration (controls)</option>
                    <option value="both">Both (Delivery + Integration)</option>
                    <option value="procurement">Procurement-led (Invoice/PO)</option>
                  </select>
                </div>

                <div class="field third">
                  <label class="label" for="package">Likely package</label>
                  <select class="select" id="package" name="package">
                    <option value="">Select…</option>
                    <option value="quickscan">Copilot QuickScan (5–7 days)</option>
                    <option value="readiness-2w">Copilot Readiness — Starter (2 weeks)</option>
                    <option value="readiness-4w">Copilot Readiness — Standard (4 weeks)</option>
                    <option value="readiness-6w">Copilot Readiness — Extended (6 weeks)</option>
                    <option value="trust-brief">Trust Brief (diagnostic)</option>
                    <option value="trust-ledger">Trust Ledger (retainer)</option>
                    <option value="unknown">Unknown / TBD</option>
                  </select>
                </div>

                <div class="field">
                  <label class="label" for="nextStep">Next step (what is scheduled)</label>
                  <input class="input" id="nextStep" name="nextStep" placeholder="e.g., Security review call, procurement intake, scope workshop" />
                </div>

                <div class="field">
                  <label class="label" for="nextDate">Next-step date (target)</label>
                  <input class="input" id="nextDate" name="nextDate" type="date" />
                </div>

                <div class="field full">
                  <label class="label" for="notes">Non-confidential notes</label>
                  <textarea class="textarea" id="notes" name="notes" placeholder="High-level context only. Ex: 'M365-heavy org evaluating Copilot rollout; needs evidence-first readiness pack for procurement.'"></textarea>
                </div>
              </div>

              <div class="checkgrid" aria-label="Signals and constraints">
                <label class="check">
                  <input type="checkbox" id="sigProc" name="sigProc" />
                  <div>
                    <p class="t">Procurement pressure exists</p>
                    <p class="d">Vendor onboarding, privacy/security questions, Invoice/PO path required.</p>
                  </div>
                </label>
                <label class="check">
                  <input type="checkbox" id="sigEvidence" name="sigEvidence" />
                  <div>
                    <p class="t">Evidence is accessible</p>
                    <p class="d">Exports/logs/policies/configs can be provided post-kickoff (under NDA if needed).</p>
                  </div>
                </label>
                <label class="check">
                  <input type="checkbox" id="sigUrgent" name="sigUrgent" />
                  <div>
                    <p class="t">Timing is urgent</p>
                    <p class="d">Decision window ≤ 30 days, or active rollout/pilot pressure.</p>
                  </div>
                </label>
                <label class="check">
                  <input type="checkbox" id="sigCopilot" name="sigCopilot" />
                  <div>
                    <p class="t">Copilot/GenAI is in scope</p>
                    <p class="d">Copilot readiness, extension/connector governance, oversharing exposure.</p>
                  </div>
                </label>
                <label class="check">
                  <input type="checkbox" id="sigLaneConfirmed" name="sigLaneConfirmed" />
                  <div>
                    <p class="t">Lane is confirmed with buyer</p>
                    <p class="d">Buyer has agreed the primary lane (Delivery / Integration / Procurement-led).</p>
                  </div>
                </label>
                <label class="check">
                  <input type="checkbox" id="sigMeetingConfirmed" name="sigMeetingConfirmed" />
                  <div>
                    <p class="t">Meeting is confirmed</p>
                    <p class="d">Next-step is confirmed (not tentative).</p>
                  </div>
                </label>
              </div>
            </div>

            <!-- Prime qualifiers -->
            <div class="section">
              <div class="sectionTitle">Prime qualifiers (partner involvement)</div>
              <p class="sectionDesc">Used to suggest partner tier (Referral / Channel / Prime Channel). Commercial terms are provided under the partner agreement.</p>

              <div class="checkgrid" aria-label="Prime qualifiers">
                <label class="check">
                  <input type="checkbox" id="pqSourced" name="pqSourced" />
                  <div>
                    <p class="t">Partner-sourced account</p>
                    <p class="d">Opportunity originates from partner relationship/network.</p>
                  </div>
                </label>

                <label class="check">
                  <input type="checkbox" id="pqMeetings" name="pqMeetings" />
                  <div>
                    <p class="t">Two buyer-side meetings feasible</p>
                    <p class="d">Champion + one of Procurement/Privacy/Security can be arranged.</p>
                  </div>
                </label>

                <label class="check">
                  <input type="checkbox" id="pqClose" name="pqClose" />
                  <div>
                    <p class="t">Close support through signature + payment/PO</p>
                    <p class="d">Partner supports the close through contracting and payment lane.</p>
                  </div>
                </label>

                <label class="check">
                  <input type="checkbox" id="pqRegisteredFirst" name="pqRegisteredFirst" />
                  <div>
                    <p class="t">Registered before external sharing</p>
                    <p class="d">Deal is registered before buyer contacts are shared outside this form.</p>
                  </div>
                </label>
              </div>
            </div>

            <!-- Acknowledgements -->
            <div class="section">
              <div class="sectionTitle">Acknowledgements</div>
              <p class="sectionDesc">Required for acceptance review. Keeps submissions procurement-safe.</p>

              <div class="checkgrid">
                <label class="check">
                  <input type="checkbox" id="ackNonConf" name="ackNonConf" />
                  <div>
                    <p class="t">Submission is non-confidential</p>
                    <p class="d">No customer data, credentials, internal documents, or pricing terms are included.</p>
                  </div>
                </label>
                <label class="check">
                  <input type="checkbox" id="ackAcceptance" name="ackAcceptance" />
                  <div>
                    <p class="t">Submission is not acceptance</p>
                    <p class="d">Protection starts only after a Deal Accepted email is issued.</p>
                  </div>
                </label>
              </div>

              <div class="actions" style="margin-top:12px;">
                <button class="btn primary" type="button" id="computeBtn">Compute</button>
                <button class="btn secondary" type="button" id="copyIntroEmailBtn">Copy warm intro email</button>
                <button class="btn secondary" type="button" id="copySalesRegEmailBtn">Copy registration email (sales@)</button>
                <button class="btn secondary" type="button" id="copyOpsEmailBtn">Copy procurement email (ops@)</button>
              </div>
            </div>
          </form>
        </div>
      </section>

      <!-- Right rail -->
      <aside class="card rail" aria-label="Deal rail">
        <div class="hd">
          <div>
            <h2 class="cardTitle">Routing summary</h2>
            <p class="muted">IDs + next actions + procurement links</p>
          </div>
        </div>

        <div class="bd">
          <div class="box">
            <strong>Deal ID:</strong> <span class="mono" id="dealIdRail">—</span><br />
            <strong>RID:</strong> <span class="mono" id="ridRail">—</span>
          </div>

          <div class="kv" aria-label="Key values">
            <div class="kvLine">
              <div class="k">Partner tier suggestion</div>
              <div class="v" id="partnerTierRail"><strong>Pending</strong> — based on prime qualifiers.</div>
            </div>
            <div class="kvLine">
              <div class="k">Deal signal</div>
              <div class="v" id="dealSignalRail"><strong>Pending</strong> — based on stage + size + signals.</div>
            </div>
            <div class="kvLine">
              <div class="k">Recommended route</div>
              <div class="v" id="routeText"><strong>Pending</strong> — compute after filling key fields.</div>
            </div>
          </div>

          <div class="divider" aria-hidden="true"></div>

          <div class="railActions" aria-label="Rail actions">
            <a class="btn primary" href="/gate/procurement/" data-rid-link>Open Procurement lane</a>
            <a class="btn secondary" href="/status/" data-rid-link>Open Status</a>
            <a class="btn secondary" href="/gate/" data-rid-link>Back to Gate</a>
          </div>

          <div class="box">
            <strong>Email routing rule:</strong> deal registration is routed to <strong>sales@noetfield.com</strong>.
            If Invoice/PO is selected (or procurement pressure is checked), also notify <strong>ops@noetfield.com</strong>.
          </div>

          <div class="box">
            <strong>Minimum for acceptance review:</strong><br />
            Partner name + email, client org, champion role, stage, next-step (and date), lane, acknowledgements.
          </div>
        </div>
      </aside>
    </section>
  </main>

  <!-- Mobile bottom bar -->
  <div class="bottomBar" role="region" aria-label="Mobile actions">
    <div class="bottomInner">
      <div class="bottomText">
        <strong id="bottomPartnerTier">Partner Tier: Pending</strong> · <span class="mono" id="bottomDeal">Deal: —</span>
      </div>
      <div class="bottomBtns">
        <button class="btn secondary" type="button" id="bottomCopyLink">Copy link</button>
        <button class="btn primary" type="button" id="bottomExport">Export</button>
      </div>
    </div>
  </div>

  <footer id="nfFooter"></footer>

  <script>
    (function(){
      function $(id){ return document.getElementById(id); }
      function safe(v){ return (v || "").toString().trim(); }
      function val(id){ var el=$(id); return el ? safe(el.value) : ""; }
      function checked(id){ var el=$(id); return !!(el && el.checked); }

      function getRID(){ return (window.__NF_RID || "").trim(); }
      function getDeal(){ return (window.__NF_DEAL || "").trim(); }

      function setDot(dotEl, level){
        if(!dotEl) return;
        dotEl.className = "dot";
        if(level === "good") dotEl.classList.add("good");
        else if(level === "warn") dotEl.classList.add("warn");
        else if(level === "bad") dotEl.classList.add("bad");
      }

      function setPartnerTier(label, level){
        if($("partnerTierText")) $("partnerTierText").textContent = label;
        if($("partnerTierRail")) $("partnerTierRail").innerHTML = "<strong>"+label+"</strong>";
        if($("bottomPartnerTier")) $("bottomPartnerTier").textContent = "Partner Tier: " + label;
        setDot($("partnerTierDot"), level);
      }

      function setDealSignal(label, level){
        if($("dealSignalText")) $("dealSignalText").textContent = label;
        if($("dealSignalRail")) $("dealSignalRail").innerHTML = "<strong>"+label+"</strong>";
        setDot($("dealSignalDot"), level);
      }

      function validate(){
        var errs = [];
        function req(cond, msg){ if(!cond) errs.push(msg); }

        req(val("partnerName"), "Partner name is required.");
        req(val("partnerEmail"), "Partner email is required.");
        req(val("clientOrg"), "Client organization is required.");
        req(val("championRole"), "Operational champion role is required.");
        req(val("stage"), "Stage is required.");
        req(val("lane"), "Primary lane is required.");
        req(val("nextStep"), "Next step is required.");
        req(val("nextDate"), "Next-step date is required.");
        req(checked("ackNonConf"), "Acknowledgement: submission is non-confidential.");
        req(checked("ackAcceptance"), "Acknowledgement: submission is not acceptance.");

        var errBox = $("errBox"), errList = $("errList");
        if(errBox && errList){
          errList.innerHTML = "";
          if(errs.length){
            errs.forEach(function(e){
              var li=document.createElement("li"); li.textContent=e; errList.appendChild(li);
            });
            errBox.style.display = "block";
          }else{
            errBox.style.display = "none";
          }
        }
        return errs;
      }

      function computePartnerTier(){
        // Prime Channel requires: sourced + meetings + close + registered-first
        var prime =
          checked("pqSourced") &&
          checked("pqMeetings") &&
          checked("pqClose") &&
          checked("pqRegisteredFirst");

        // Channel requires at least meaningful involvement
        var channel =
          checked("pqMeetings") || checked("pqClose") || val("stage")==="meeting-held" || val("stage")==="qualified" || val("stage")==="proposal" || val("stage")==="procurement" || val("stage")==="commit";

        if(prime){ setPartnerTier("Prime Channel (eligible)", "good"); return "Prime Channel (eligible)"; }
        if(channel){ setPartnerTier("Channel (standard)", "good"); return "Channel (standard)"; }
        setPartnerTier("Referral (intro + routing)", "warn"); return "Referral (intro + routing)";
      }

      function computeDealSignal(){
        // Defensible heuristic based on non-confidential signals (not commercial terms)
        var stage = val("stage");
        var size = val("clientSize");
        var lane = val("lane");

        var urgent = checked("sigUrgent");
        var proc = checked("sigProc");
        var evidence = checked("sigEvidence");
        var copilot = checked("sigCopilot");
        var laneConfirmed = checked("sigLaneConfirmed");
        var meetingConfirmed = checked("sigMeetingConfirmed");

        var score = 0;

        var stageScore = {
          "sourced": 1,
          "intro": 2,
          "meeting-set": 3,
          "meeting-held": 4,
          "qualified": 5,
          "proposal": 6,
          "procurement": 7,
          "commit": 8
        }[stage] || 0;
        score += stageScore;

        var sizeScore = {
          "200-499": 1,
          "500-999": 2,
          "1000-4999": 3,
          "5000+": 4
        }[size] || 0;
        score += sizeScore;

        if(urgent) score += 2;
        if(proc) score += 2;
        if(evidence) score += 2;
        if(copilot) score += 1;
        if(lane === "both") score += 1;
        if(laneConfirmed) score += 1;
        if(meetingConfirmed) score += 1;

        var label = "Low";
        var level = "bad";
        if(score >= 13){ label = "High"; level = "good"; }
        else if(score >= 9){ label = "Medium"; level = "good"; }
        else if(score >= 6){ label = "Developing"; level = "warn"; }
        else { label = "Low"; level = "bad"; }

        setDealSignal(label, level);
        return { label: label, score: score };
      }

      function computeRoute(){
        var lane = val("lane");
        var proc = checked("sigProc") || lane === "procurement";
        var route = "Route: Gate → confirm lane → proceed";
        if(proc) route = "Route: Procurement lane (Invoice/PO) → Status (RID)";
        else if(lane === "integration") route = "Route: Integration lane → Procurement if PO/Invoice → Status (RID)";
        else if(lane === "delivery") route = "Route: Delivery lane → Procurement if PO/Invoice → Status (RID)";
        else if(lane === "both") route = "Route: Delivery + Integration → Procurement if PO/Invoice → Status (RID)";
        if($("routeText")) $("routeText").innerHTML = "<strong>"+route+"</strong>";
        return route;
      }

      function computeAll(){
        computePartnerTier();
        computeDealSignal();
        computeRoute();
      }

      function formData(){
        var rid = getRID(), deal = getDeal();
        return {
          rid: rid,
          deal_id: deal,
          submitted_at_utc: (new Date()).toISOString(),
          partner: {
            name: val("partnerName"),
            email: val("partnerEmail"),
            website: val("partnerWebsite"),
            role: val("partnerRole")
          },
          client: {
            organization: val("clientOrg"),
            domain: val("clientDomain"),
            size: val("clientSize"),
            industry: val("industry"),
            geography: val("geo"),
            champion_role: val("championRole"),
            buyer_role: val("buyerRole")
          },
          opportunity: {
            stage: val("stage"),
            lane: val("lane"),
            likely_package: val("package"),
            next_step: val("nextStep"),
            next_step_date: val("nextDate"),
            notes: val("notes"),
            signals: {
              procurement_pressure: checked("sigProc"),
              evidence_accessible: checked("sigEvidence"),
              urgent_window: checked("sigUrgent"),
              copilot_in_scope: checked("sigCopilot"),
              lane_confirmed: checked("sigLaneConfirmed"),
              meeting_confirmed: checked("sigMeetingConfirmed")
            },
            prime_qualifiers: {
              partner_sourced_account: checked("pqSourced"),
              two_buyer_side_meetings_feasible: checked("pqMeetings"),
              close_support_signature_and_payment: checked("pqClose"),
              registered_before_external_sharing: checked("pqRegisteredFirst")
            },
            acknowledgements: {
              non_confidential: checked("ackNonConf"),
              submission_not_acceptance: checked("ackAcceptance")
            }
          }
        };
      }

      function download(filename, text){
        var a = document.createElement("a");
        a.href = URL.createObjectURL(new Blob([text], {type:"text/plain"}));
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        setTimeout(function(){ URL.revokeObjectURL(a.href); a.remove(); }, 2000);
      }

      function exportPacket(){
        var errs = validate();
        if(errs.length) return;

        var pt = computePartnerTier();
        var ds = computeDealSignal();
        var route = computeRoute();
        var data = formData();

        var rid = data.rid, deal = data.deal_id;

        var summary =
`Noetfield — Partner Deal Registration Packet (Non-Confidential)
RID: ${rid}
Deal ID: ${deal}

Partner Tier: ${pt}
Deal Signal: ${ds.label} (score: ${ds.score})

Partner:
- Name: ${data.partner.name}
- Email: ${data.partner.email}
- Website: ${data.partner.website || "-"}
- Role: ${data.partner.role || "-"}

Client:
- Organization: ${data.client.organization}
- Domain: ${data.client.domain || "-"}
- Size: ${data.client.size || "-"}
- Industry: ${data.client.industry || "-"}
- Geography: ${data.client.geography || "-"}
- Champion Role: ${data.client.champion_role}
- Buyer Role: ${data.client.buyer_role || "-"}

Opportunity:
- Stage: ${data.opportunity.stage}
- Lane: ${data.opportunity.lane}
- Likely Package: ${data.opportunity.likely_package || "-"}
- Next Step: ${data.opportunity.next_step}
- Next Step Date: ${data.opportunity.next_step_date}
- Signals: Procurement=${data.opportunity.signals.procurement_pressure ? "Yes":"No"}, Evidence=${data.opportunity.signals.evidence_accessible ? "Yes":"No"}, Urgent=${data.opportunity.signals.urgent_window ? "Yes":"No"}, Copilot=${data.opportunity.signals.copilot_in_scope ? "Yes":"No"}, LaneConfirmed=${data.opportunity.signals.lane_confirmed ? "Yes":"No"}, MeetingConfirmed=${data.opportunity.signals.meeting_confirmed ? "Yes":"No"}
- Prime qualifiers: Sourced=${data.opportunity.prime_qualifiers.partner_sourced_account ? "Yes":"No"}, 2Meetings=${data.opportunity.prime_qualifiers.two_buyer_side_meetings_feasible ? "Yes":"No"}, CloseSupport=${data.opportunity.prime_qualifiers.close_support_signature_and_payment ? "Yes":"No"}, RegisteredFirst=${data.opportunity.prime_qualifiers.registered_before_external_sharing ? "Yes":"No"}

Notes (sanitized):
${data.opportunity.notes || "-"}

Acknowledgements:
- Non-confidential submission: ${data.opportunity.acknowledgements.non_confidential ? "Yes":"No"}
- Submission is not acceptance: ${data.opportunity.acknowledgements.submission_not_acceptance ? "Yes":"No"}

Routing suggestion:
${route}

Boundary note:
Public packet is routing-only. If sensitive context is required, route via Procurement lane after NDA/kickoff.
`;

        var json = JSON.stringify(data, null, 2);

        download(deal + "-packet.txt", summary);
        download(deal + "-data.json", json);
      }

      async function copy(text){
        try{
          await navigator.clipboard.writeText(text);
          return true;
        }catch(e){
          try{
            var ta=document.createElement("textarea");
            ta.value=text; document.body.appendChild(ta); ta.select();
            document.execCommand("copy"); ta.remove();
            return true;
          }catch(e2){ return false; }
        }
      }

      function dealLink(){
        var rid=getRID(), deal=getDeal();
        var u = new URL(window.location.origin + "/gate/partners/deal/");
        u.searchParams.set("rid", rid);
        u.searchParams.set("deal", deal);
        return u.toString();
      }

      function buildWarmIntroEmail(){
        var rid=getRID(), deal=getDeal();
        var org=val("clientOrg"), champ=val("championRole");
        var pkg=val("package") || "TBD";
        var proc = (checked("sigProc") || val("lane")==="procurement") ? "Procurement/PO path likely" : "Procurement path TBD";

        return (
`Subject: Intro — Noetfield governance artefacts (RID ${rid}, Deal ${deal})

Hello [Name],

Introduction for ${org || "[Organization]"}.
Scope: evidence-first governance + board-ready artefacts (package: ${pkg}).
Champion role: ${champ || "[Champion role]"}.
Routing: ${proc}. Procurement lane: ${window.location.origin}/gate/procurement/?rid=${encodeURIComponent(rid)}.

This note is non-confidential. Next step: ${val("nextStep") || "[Next step]"} on ${val("nextDate") || "[Date]"}.

Regards,
[Partner Name]`
        );
      }

      function buildSalesRegistrationEmail(){
        var rid=getRID(), deal=getDeal();
        var org=val("clientOrg");
        var pt = $("partnerTierText") ? $("partnerTierText").textContent : "Pending";
        var ds = $("dealSignalText") ? $("dealSignalText").textContent : "Pending";

        return (
`To: sales@noetfield.com
Subject: Partner Deal Registration — ${org || "[Organization]"} (Deal ${deal}, RID ${rid})

Partner Deal Registration submitted (non-confidential).
Deal link: ${dealLink()}

Partner tier suggestion: ${pt}
Deal signal: ${ds}

Minimum fields included: partner, org, champion role, stage, next-step date, lane, acknowledgements.
Acceptance required: protection starts only upon Deal Accepted email.

Regards,
[Partner Name]`
        );
      }

      function buildOpsProcurementEmail(){
        var rid=getRID(), deal=getDeal();
        var org=val("clientOrg") || "[Organization]";
        return (
`To: ops@noetfield.com
Subject: Procurement lane routing — ${org} (RID ${rid}, Deal ${deal})

Routing note (non-confidential):
- Buyer likely requires Invoice/PO onboarding.
- Please expect procurement contact to use: ${window.location.origin}/gate/procurement/?rid=${encodeURIComponent(rid)}

Deal link: ${dealLink()}

Regards,
[Partner Name]`
        );
      }

      function newDeal(){
        try{
          var d = new Date(), y=String(d.getUTCFullYear()).slice(2),
          m=String(d.getUTCMonth()+1).padStart(2,"0"), day=String(d.getUTCDate()).padStart(2,"0");
          var rand = (window.crypto && crypto.getRandomValues) ? (function(){
            var a=new Uint8Array(5); crypto.getRandomValues(a);
            return Array.from(a).map(x => (x%36).toString(36)).join("").toUpperCase();
          })() : Math.random().toString(36).slice(2,7).toUpperCase();

          var deal="NF-PD-" + y + m + day + "-" + rand;
          window.__NF_DEAL = deal;

          var url=new URL(window.location.href);
          url.searchParams.set("deal", deal);
          window.history.replaceState({}, "", url.pathname + url.search + url.hash);

          if($("dealIdText")) $("dealIdText").textContent = deal;
          if($("dealIdRail")) $("dealIdRail").textContent = deal;
          if($("bottomDeal")) $("bottomDeal").textContent = "Deal: " + deal;
          if($("dealIdHidden")) $("dealIdHidden").value = deal;

          setPartnerTier("Pending", "warn");
          setDealSignal("Pending", "warn");
          if($("routeText")) $("routeText").innerHTML = "<strong>Pending</strong> — compute after filling key fields.";
        }catch(e){}
      }

      function draftKey(){ return "nf_pd_draft_" + (getDeal() || "unknown"); }
      function saveDraft(){
        try{
          var data=formData();
          localStorage.setItem(draftKey(), JSON.stringify(data));
        }catch(e){}
      }
      function loadDraft(){
        try{
          var raw=localStorage.getItem(draftKey());
          if(!raw) return;
          var data=JSON.parse(raw);

          function set(id, v){ var el=$(id); if(el) el.value = (v||""); }
          function setChk(id, v){ var el=$(id); if(el) el.checked = !!v; }

          set("partnerName", data.partner?.name);
          set("partnerEmail", data.partner?.email);
          set("partnerWebsite", data.partner?.website);
          set("partnerRole", data.partner?.role);

          set("clientOrg", data.client?.organization);
          set("clientDomain", data.client?.domain);
          set("clientSize", data.client?.size);
          set("industry", data.client?.industry);
          set("geo", data.client?.geography);
          set("championRole", data.client?.champion_role);
          set("buyerRole", data.client?.buyer_role);

          set("stage", data.opportunity?.stage);
          set("lane", data.opportunity?.lane);
          set("package", data.opportunity?.likely_package);
          set("nextStep", data.opportunity?.next_step);
          set("nextDate", data.opportunity?.next_step_date);
          set("notes", data.opportunity?.notes);

          setChk("sigProc", data.opportunity?.signals?.procurement_pressure);
          setChk("sigEvidence", data.opportunity?.signals?.evidence_accessible);
          setChk("sigUrgent", data.opportunity?.signals?.urgent_window);
          setChk("sigCopilot", data.opportunity?.signals?.copilot_in_scope);
          setChk("sigLaneConfirmed", data.opportunity?.signals?.lane_confirmed);
          setChk("sigMeetingConfirmed", data.opportunity?.signals?.meeting_confirmed);

          setChk("pqSourced", data.opportunity?.prime_qualifiers?.partner_sourced_account);
          setChk("pqMeetings", data.opportunity?.prime_qualifiers?.two_buyer_side_meetings_feasible);
          setChk("pqClose", data.opportunity?.prime_qualifiers?.close_support_signature_and_payment);
          setChk("pqRegisteredFirst", data.opportunity?.prime_qualifiers?.registered_before_external_sharing);

          setChk("ackNonConf", data.opportunity?.acknowledgements?.non_confidential);
          setChk("ackAcceptance", data.opportunity?.acknowledgements?.submission_not_acceptance);

          computeAll();
        }catch(e){}
      }
      function clearDraft(){
        try{ localStorage.removeItem(draftKey()); }catch(e){}
      }

      function bind(){
        // initial
        setPartnerTier("Pending", "warn");
        setDealSignal("Pending", "warn");
        computeAll();

        var computeBtn=$("computeBtn");
        if(computeBtn) computeBtn.addEventListener("click", function(){
          validate();
          computeAll();
        });

        [
          "stage","clientSize","lane","sigUrgent","sigProc","sigEvidence","sigCopilot","sigLaneConfirmed","sigMeetingConfirmed",
          "pqSourced","pqMeetings","pqClose","pqRegisteredFirst"
        ].forEach(function(id){
          var el=$(id);
          if(el) el.addEventListener("change", function(){ computeAll(); });
        });

        var copyLink=$("copyDealLinkBtn");
        if(copyLink) copyLink.addEventListener("click", function(){ copy(dealLink()); });

        var exportBtn=$("exportPacketBtn");
        if(exportBtn) exportBtn.addEventListener("click", exportPacket);

        var bottomCopy=$("bottomCopyLink");
        if(bottomCopy) bottomCopy.addEventListener("click", function(){ copy(dealLink()); });

        var bottomExport=$("bottomExport");
        if(bottomExport) bottomExport.addEventListener("click", exportPacket);

        var newDealBtn=$("newDealBtn");
        if(newDealBtn) newDealBtn.addEventListener("click", newDeal);

        var saveBtn=$("saveDraftBtn");
        if(saveBtn) saveBtn.addEventListener("click", saveDraft);

        var loadBtn=$("loadDraftBtn");
        if(loadBtn) loadBtn.addEventListener("click", loadDraft);

        var clearBtn=$("clearDraftBtn");
        if(clearBtn) clearBtn.addEventListener("click", clearDraft);

        var copyIntro=$("copyIntroEmailBtn");
        if(copyIntro) copyIntro.addEventListener("click", function(){
          var errs=validate(); if(errs.length) return;
          computeAll();
          copy(buildWarmIntroEmail());
        });

        var copySales=$("copySalesRegEmailBtn");
        if(copySales) copySales.addEventListener("click", function(){
          var errs=validate(); if(errs.length) return;
          computeAll();
          copy(buildSalesRegistrationEmail());
        });

        var copyOps=$("copyOpsEmailBtn");
        if(copyOps) copyOps.addEventListener("click", function(){
          var errs=validate(); if(errs.length) return;
          computeAll();
          copy(buildOpsProcurementEmail());
        });
      }

      if(document.readyState==="loading") document.addEventListener("DOMContentLoaded", bind);
      else bind();
    })();
  </script>
</body>
</html>
