<!-- /gate/index.html — Noetfield Gate v3.2 (Buyer-first hub + QuickScan tiers + Procurement pack + Sticky CTA) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Noetfield — Gate</title>
  <meta name="description" content="Purchase-ready entry to Noetfield packages. Card checkout for Copilot QuickScan, a procurement-ready invoice/PO path, and a clean intake route for tailored scope. Public intake is non-confidential." />
  <meta name="robots" content="index,follow" />
  <meta name="author" content="Noetfield Systems Inc." />
  <meta name="theme-color" content="#07070b" />

  <link rel="canonical" href="https://www.noetfield.com/gate/" />
  <meta property="og:title" content="Noetfield — Gate" />
  <meta property="og:description" content="Start point for purchase, procurement, and intake. QuickScan card checkout or invoice/PO. Board-safe. Evidence-first." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.noetfield.com/gate/" />
  <meta property="og:image" content="https://www.noetfield.com/og.png" />

  <link rel="icon" href="/noetfield-favicon-512.png" type="image/png" />
  <link rel="apple-touch-icon" href="/noetfield-favicon-512.png" />

  <link rel="preload" href="/assets/noetfield-shell.css" as="style" />
  <link rel="stylesheet" href="/assets/noetfield-shell.css" />
  <script defer src="/assets/noetfield-shell.js"></script>

  <style>
    /* Gate-specific layer: minimal overrides, shell-safe */
    :root { color-scheme: dark; }

    .nfGateWrap { max-width: 1100px; margin: 0 auto; padding: 28px 16px 96px; }
    .nfHero { display: grid; gap: 14px; margin-top: 8px; }
    .nfKicker { opacity: .82; font-size: 13px; letter-spacing: .04em; text-transform: uppercase; }
    .nfTitle { font-size: clamp(26px, 3.2vw, 40px); line-height: 1.12; margin: 0; }
    .nfSub { opacity: .88; max-width: 70ch; margin: 0; }
    .nfPills { display:flex; flex-wrap:wrap; gap: 8px; margin-top: 4px; }
    .nfPill {
      display:inline-flex; align-items:center; gap:8px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      padding: 7px 10px; border-radius: 999px;
      font-size: 13px; opacity: .92;
    }

    .nfGrid { display:grid; gap: 14px; margin-top: 18px; }
    @media (min-width: 920px) {
      .nfGrid { grid-template-columns: 1.3fr .7fr; align-items: start; }
    }

    .nfPanel {
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.02);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 0 0 1px rgba(0,0,0,.12) inset;
    }
    .nfPanel h2 { margin: 0 0 8px; font-size: 16px; letter-spacing: .01em; }
    .nfPanel p { margin: 8px 0; opacity: .88; }
    .nfSmall { font-size: 13px; opacity: .78; }
    .nfNote {
      border-left: 2px solid rgba(255,255,255,.18);
      padding: 10px 12px;
      background: rgba(255,255,255,.02);
      border-radius: 10px;
      margin-top: 10px;
    }

    .nfToggle {
      display:flex; gap: 8px; flex-wrap: wrap;
      margin-top: 10px;
    }
    .nfToggle button {
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.03);
      color: inherit;
      border-radius: 999px;
      padding: 10px 12px;
      font-size: 13px;
      cursor: pointer;
      transition: transform .05s ease;
    }
    .nfToggle button[aria-selected="true"] {
      border-color: rgba(255,255,255,.30);
      background: rgba(255,255,255,.06);
    }
    .nfToggle button:active { transform: translateY(1px); }

    .nfCards { display:grid; gap: 12px; margin-top: 12px; }
    .nfCard {
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.02);
      border-radius: 16px;
      padding: 14px;
    }
    .nfCardTop { display:flex; align-items:flex-start; justify-content: space-between; gap: 10px; }
    .nfCardTitle { margin: 0; font-size: 15px; }
    .nfBadge {
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.03);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      opacity: .9;
      white-space: nowrap;
    }
    .nfBullets { margin: 10px 0 0; padding-left: 18px; opacity: .9; }
    .nfBullets li { margin: 6px 0; }
    .nfRow { display:flex; flex-wrap: wrap; gap: 10px; align-items: center; margin-top: 12px; }
    .nfBtn {
      display:inline-flex; align-items:center; justify-content:center;
      gap: 8px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      padding: 11px 12px;
      font-size: 13px;
      color: inherit;
      text-decoration: none;
      cursor: pointer;
      min-height: 42px;
      user-select: none;
    }
    .nfBtnPrimary {
      border-color: rgba(255,255,255,.26);
      background: rgba(255,255,255,.10);
    }
    .nfBtnGhost {
      background: rgba(255,255,255,.03);
      border-color: rgba(255,255,255,.14);
    }
    .nfBtn:active { transform: translateY(1px); }

    .nfDivider { height: 1px; background: rgba(255,255,255,.12); margin: 14px 0; }

    .nfTierGrid { display:grid; gap: 10px; margin-top: 10px; }
    @media (min-width: 720px) { .nfTierGrid { grid-template-columns: repeat(3, 1fr); } }

    .nfTier {
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.02);
      border-radius: 14px;
      padding: 12px;
      cursor: pointer;
      position: relative;
    }
    .nfTier[aria-checked="true"] {
      border-color: rgba(255,255,255,.28);
      background: rgba(255,255,255,.05);
    }
    .nfTierHead { display:flex; align-items: baseline; justify-content: space-between; gap: 10px; }
    .nfTierName { font-size: 13px; margin: 0; opacity: .95; }
    .nfTierPrice { font-size: 14px; margin: 0; opacity: .95; }
    .nfTierMeta { margin-top: 8px; font-size: 12px; opacity: .78; line-height: 1.35; }
    .nfTierInput { position:absolute; inset: 0; opacity: 0; cursor: pointer; }

    .nfAsideList { margin: 10px 0 0; padding-left: 18px; opacity: .9; }
    .nfAsideList li { margin: 7px 0; }
    .nfKey { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; opacity: .88; }
    .nfCodeBox {
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      border-radius: 14px;
      padding: 12px;
      margin-top: 10px;
    }
    .nfCodeBox textarea {
      width: 100%;
      min-height: 150px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.02);
      color: inherit;
      padding: 10px;
      font-size: 12px;
      line-height: 1.4;
      resize: vertical;
    }
    .nfCopyRow { display:flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }

    /* Sticky CTA (mobile-first) */
    .nfSticky {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      padding: 10px 12px;
      background: rgba(7,7,11,.78);
      border-top: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(10px);
      display: none;
      z-index: 50;
    }
    .nfStickyInner {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }
    .nfStickyMeta { display:flex; flex-direction: column; gap: 2px; }
    .nfStickyTitle { font-size: 12px; opacity: .92; }
    .nfStickySub { font-size: 12px; opacity: .70; }
    @media (max-width: 860px) { .nfSticky { display: block; } }
  </style>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Noetfield — Gate",
    "url":"https://www.noetfield.com/gate/",
    "description":"Purchase-ready entry to Noetfield packages with card checkout, procurement invoice/PO path, and intake routing.",
    "isPartOf":{
      "@type":"WebSite",
      "name":"Noetfield",
      "url":"https://www.noetfield.com/"
    },
    "publisher":{
      "@type":"Organization",
      "name":"Noetfield Systems Inc."
    }
  }
  </script>
</head>

<body>
  <!-- Shell partial mounts (kept simple; /assets/noetfield-shell.js handles injection) -->
  <div id="nfHeader" data-partial="/assets/partials/header.html"></div>

  <main class="nfGateWrap" id="top">
    <section class="nfHero" aria-label="Gate hero">
      <div class="nfKicker">Gate</div>
      <h1 class="nfTitle">Purchase, procurement, or intake — the clean start point</h1>
      <p class="nfSub">
        Evidence-first AI governance packages for organizations adopting Microsoft 365 Copilot and related AI workflows.
        Card checkout for QuickScan, procurement-ready invoice/PO path, and a public intake route for tailored scope.
      </p>

      <div class="nfPills" aria-label="Key promises">
        <div class="nfPill">Board-safe language</div>
        <div class="nfPill">Procurement-ready snapshot</div>
        <div class="nfPill">Evidence discipline</div>
        <div class="nfPill">Public intake is non-confidential</div>
      </div>

      <div class="nfNote" role="note">
        <div class="nfSmall">
          <strong>Public intake = non-confidential.</strong> Do not submit secrets, credentials, personal data, or regulated information.
          For sensitive scope, request NDA via procurement.
        </div>
      </div>
    </section>

    <section class="nfGrid" aria-label="Gate layout">
      <!-- LEFT: Offers -->
      <div class="nfPanel" aria-label="Offers panel">
        <h2>Choose a path</h2>
        <p class="nfSmall">
          Buyer mode controls CTAs. Card = checkout where available. Invoice/PO = procurement summary + email builder.
        </p>

        <div class="nfToggle" role="tablist" aria-label="Buyer mode">
          <button id="modeCard" role="tab" aria-selected="true" aria-controls="offers" type="button">
            Card checkout (fast)
          </button>
          <button id="modeProc" role="tab" aria-selected="false" aria-controls="offers" type="button">
            Invoice / PO (procurement)
          </button>
        </div>

        <div class="nfCards" id="offers" role="region" aria-label="Offers">
          <!-- Copilot QuickScan -->
          <article class="nfCard" data-offer="quickscan" id="offer-quickscan">
            <div class="nfCardTop">
              <h3 class="nfCardTitle">Copilot QuickScan</h3>
              <div class="nfBadge">5–7 business days</div>
            </div>
            <p class="nfSmall">
              Board-ready evidence for Microsoft 365 Copilot readiness: oversharing exposure, sensitive boundaries,
              retention posture, and extension/connector controls — packaged for procurement and decision-making.
            </p>

            <div class="nfTierGrid" role="radiogroup" aria-label="QuickScan tier">
              <div class="nfTier" data-tier="base" role="radio" aria-checked="true" tabindex="0">
                <input class="nfTierInput" type="radio" name="qsTier" value="base" checked aria-label="QuickScan Base" />
                <div class="nfTierHead">
                  <p class="nfTierName"><strong>Base</strong></p>
                  <p class="nfTierPrice" id="qsPriceBase">$2,500</p>
                </div>
                <div class="nfTierMeta">
                  Quick governance scan + board snapshot.<br/>
                  Best for single team / initial decision.
                </div>
              </div>

              <div class="nfTier" data-tier="pro" role="radio" aria-checked="false" tabindex="0">
                <input class="nfTierInput" type="radio" name="qsTier" value="pro" aria-label="QuickScan Pro" />
                <div class="nfTierHead">
                  <p class="nfTierName"><strong>Pro</strong></p>
                  <p class="nfTierPrice" id="qsPricePro">$6,500</p>
                </div>
                <div class="nfTierMeta">
                  Wider coverage + stronger evidence pack.<br/>
                  Best for multi-team rollout planning.
                </div>
              </div>

              <div class="nfTier" data-tier="ent" role="radio" aria-checked="false" tabindex="0">
                <input class="nfTierInput" type="radio" name="qsTier" value="ent" aria-label="QuickScan Enterprise" />
                <div class="nfTierHead">
                  <p class="nfTierName"><strong>Enterprise</strong></p>
                  <p class="nfTierPrice" id="qsPriceEnt">$9,500</p>
                </div>
                <div class="nfTierMeta">
                  Board-grade package + stakeholder readiness.<br/>
                  Best for regulated or high visibility orgs.
                </div>
              </div>
            </div>

            <ul class="nfBullets" aria-label="QuickScan outputs">
              <li>Oversharing exposure map (material scenarios)</li>
              <li>Data boundary posture (sensitive classes + guardrails)</li>
              <li>Retention & audit posture snapshot</li>
              <li>Extensions / connectors risk posture</li>
              <li>Board-ready findings + actions (non-legal)</li>
            </ul>

            <div class="nfRow" aria-label="QuickScan actions">
              <a class="nfBtn nfBtnPrimary" id="qsPrimaryCta" href="/gate/intake/?need=quickscan" data-cta="primary">
                Start QuickScan
              </a>
              <a class="nfBtn nfBtnGhost" id="qsProcCta" href="#procurement">
                Procurement pack
              </a>
              <span class="nfSmall">RID: <span class="nfKey" id="ridInline"></span></span>
            </div>
          </article>

          <!-- Playbook Standard -->
          <article class="nfCard" data-offer="playbook_standard" id="offer-playbook-standard">
            <div class="nfCardTop">
              <h3 class="nfCardTitle">Playbook — Standard</h3>
              <div class="nfBadge">Digital delivery</div>
            </div>
            <p class="nfSmall">
              Governance-first 0–90 day rollout pattern: control baseline, evidence discipline, templates, and a board/procurement-ready brief.
            </p>
            <ul class="nfBullets" aria-label="Playbook standard bullets">
              <li>One organization license</li>
              <li>Templates + checklists</li>
              <li>Procurement-friendly summary</li>
            </ul>
            <div class="nfRow">
              <a class="nfBtn nfBtnPrimary" id="pbStdPrimaryCta" href="/playbook/standard/" data-cta="primary">View / buy</a>
              <a class="nfBtn nfBtnGhost" href="#procurement">Procurement pack</a>
            </div>
          </article>

          <!-- Playbook Pro -->
          <article class="nfCard" data-offer="playbook_pro" id="offer-playbook-pro">
            <div class="nfCardTop">
              <h3 class="nfCardTitle">Playbook — Pro</h3>
              <div class="nfBadge">Advisor / agency use</div>
            </div>
            <p class="nfSmall">
              Multi-client license for advisors and agencies: reusable 0–90 day governance playbook with client-ready templates and due diligence kit.
            </p>
            <ul class="nfBullets" aria-label="Playbook pro bullets">
              <li>Reusable across clients</li>
              <li>Client-ready due diligence kit</li>
              <li>Board/procurement brief template</li>
            </ul>
            <div class="nfRow">
              <a class="nfBtn nfBtnPrimary" id="pbProPrimaryCta" href="/playbook/pro/" data-cta="primary">View / buy</a>
              <a class="nfBtn nfBtnGhost" href="#procurement">Procurement pack</a>
            </div>
          </article>

          <!-- Trust Brief -->
          <article class="nfCard" data-offer="trust_brief" id="offer-trust-brief">
            <div class="nfCardTop">
              <h3 class="nfCardTitle">Trust Brief</h3>
              <div class="nfBadge">6 weeks</div>
            </div>
            <p class="nfSmall">
              Governance-first diagnostic: map material AI use cases, risks, controls, and decision options, producing board-ready Trust Ledger entries.
            </p>
            <ul class="nfBullets" aria-label="Trust Brief bullets">
              <li>Use-case inventory + materiality</li>
              <li>Risk/control mapping (evidence-first)</li>
              <li>Board-ready decision options</li>
            </ul>
            <div class="nfRow">
              <a class="nfBtn nfBtnPrimary" id="tbPrimaryCta" href="/gate/intake/?need=trust-brief" data-cta="primary">Start intake</a>
              <a class="nfBtn nfBtnGhost" href="#procurement">Procurement pack</a>
            </div>
          </article>

          <!-- Trust Ledger -->
          <article class="nfCard" data-offer="trust_ledger" id="offer-trust-ledger">
            <div class="nfCardTop">
              <h3 class="nfCardTitle">Trust Ledger</h3>
              <div class="nfBadge">Ongoing cadence</div>
            </div>
            <p class="nfSmall">
              Living governance register: decisions, evidence, controls, and expiry discipline — maintained as a board-ready operational cadence.
            </p>
            <ul class="nfBullets" aria-label="Trust Ledger bullets">
              <li>Evidence/expiry registry and updates</li>
              <li>Board-ready reporting cadence</li>
              <li>Operational governance discipline</li>
            </ul>
            <div class="nfRow">
              <a class="nfBtn nfBtnPrimary" id="tlPrimaryCta" href="/gate/intake/?need=trust-ledger" data-cta="primary">Start intake</a>
              <a class="nfBtn nfBtnGhost" href="/vendor/" id="vendorLink">Vendor / security</a>
            </div>
          </article>
        </div>
      </div>

      <!-- RIGHT: Procurement + How it works -->
      <aside class="nfPanel" aria-label="Procurement panel">
        <h2 id="procurement">Procurement pack</h2>
        <p class="nfSmall">
          Internal-ready summary + copy/paste email to procurement. RID stays attached across links.
        </p>

        <ul class="nfAsideList" aria-label="Procurement steps">
          <li><strong>Step 1:</strong> Select buyer mode = Invoice/PO.</li>
          <li><strong>Step 2:</strong> Select an offer (and QuickScan tier if applicable).</li>
          <li><strong>Step 3:</strong> Copy internal summary + email draft.</li>
          <li><strong>Step 4:</strong> Submit intake for kickoff details.</li>
        </ul>

        <div class="nfDivider"></div>

        <p class="nfSmall"><strong>Request ID (RID)</strong><br/>
          <span class="nfKey" id="ridBox"></span>
        </p>

        <div class="nfRow" aria-label="Procurement quick links">
          <a class="nfBtn nfBtnPrimary" id="procIntakeCta" href="/gate/intake/" data-cta="primary">Submit intake</a>
          <a class="nfBtn nfBtnGhost" id="procStatusCta" href="/status/?rid=">Status</a>
        </div>

        <div class="nfCodeBox" aria-label="Internal summary builder">
          <div class="nfSmall"><strong>Internal summary</strong> (paste into approval ticket / email)</div>
          <textarea id="internalSummary" spellcheck="false"></textarea>
          <div class="nfCopyRow">
            <button class="nfBtn nfBtnPrimary" type="button" id="copySummaryBtn">Copy summary</button>
            <button class="nfBtn nfBtnGhost" type="button" id="refreshSummaryBtn">Refresh</button>
          </div>
        </div>

        <div class="nfCodeBox" aria-label="Email draft builder">
          <div class="nfSmall"><strong>Email draft</strong> (procurement / manager)</div>
          <textarea id="emailDraft" spellcheck="false"></textarea>
          <div class="nfCopyRow">
            <button class="nfBtn nfBtnPrimary" type="button" id="copyEmailBtn">Copy email</button>
            <a class="nfBtn nfBtnGhost" id="mailtoBtn" href="#">Open mail app</a>
          </div>
        </div>

        <div class="nfDivider"></div>

        <p class="nfSmall"><strong>Contact</strong></p>
        <ul class="nfAsideList">
          <li><span class="nfKey">procurement@noetfield.com</span> (invoice/PO path)</li>
          <li><span class="nfKey">billing@noetfield.com</span> (invoice/payment)</li>
          <li><span class="nfKey">support@noetfield.com</span> (operations)</li>
          <li><span class="nfKey">feedback@noetfield.com</span> (general)</li>
          <li class="nfSmall">If a dedicated mailbox is not available, route via <span class="nfKey">procurement@</span>.</li>
        </ul>

        <div class="nfNote" role="note">
          <div class="nfSmall">
            Terms: Digital services and templates. Not legal advice. Scope confirmed after intake.
          </div>
        </div>
      </aside>
    </section>

    <div class="nfDivider"></div>

    <section class="nfPanel" aria-label="Routing notes">
      <h2>Routing rules (what happens next)</h2>
      <ul class="nfAsideList">
        <li><strong>Card checkout:</strong> QuickScan checkout opens directly (when link exists). Intake still recommended for kickoff details.</li>
        <li><strong>Invoice / PO:</strong> Procurement pack provides internal summary + email. Intake collects operational details for invoicing and scheduling.</li>
        <li><strong>Tailored scope:</strong> Trust Brief / Trust Ledger always start with intake to confirm scope and fit.</li>
        <li><strong>Confidentiality:</strong> Public intake is non-confidential. Procurement can route NDA request.</li>
      </ul>
    </section>
  </main>

  <!-- Sticky CTA bar (mobile) -->
  <div class="nfSticky" role="region" aria-label="Sticky call to action">
    <div class="nfStickyInner">
      <div class="nfStickyMeta">
        <div class="nfStickyTitle" id="stickyTitle">Copilot QuickScan — Base</div>
        <div class="nfStickySub" id="stickySub">Card checkout (fast)</div>
      </div>
      <a class="nfBtn nfBtnPrimary" id="stickyBtn" href="/gate/intake/?need=quickscan">Start</a>
    </div>
  </div>

  <div id="nfFooter" data-partial="/assets/partials/footer.html"></div>

  <script>
    (function () {
      "use strict";

      // ---------- CONFIG (replace Stripe links as needed) ----------
      const QS_TIERS = {
        base: { label: "Base", priceText: "$2,500", priceCad: 2500, delivery: "5–7 business days",
          stripe: "REPLACE_STRIPE_LINK_QUICKSCAN_BASE"
        },
        pro:  { label: "Pro",  priceText: "$6,500", priceCad: 6500, delivery: "5–7 business days",
          stripe: "REPLACE_STRIPE_LINK_QUICKSCAN_PRO"
        },
        ent:  { label: "Enterprise", priceText: "$9,500", priceCad: 9500, delivery: "5–7 business days",
          stripe: "REPLACE_STRIPE_LINK_QUICKSCAN_ENT"
        }
      };

      const OFFER_CATALOG = {
        quickscan: {
          label: "Copilot QuickScan",
          type: "service",
          defaultNeed: "quickscan"
        },
        playbook_standard: {
          label: "Playbook — Standard",
          type: "digital",
          url: "/playbook/standard/"
        },
        playbook_pro: {
          label: "Playbook — Pro",
          type: "digital",
          url: "/playbook/pro/"
        },
        trust_brief: {
          label: "Trust Brief",
          type: "service",
          defaultNeed: "trust-brief"
        },
        trust_ledger: {
          label: "Trust Ledger",
          type: "service",
          defaultNeed: "trust-ledger"
        }
      };

      // ---------- Helpers ----------
      const $ = (sel, root=document) => root.querySelector(sel);
      const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

      function getParams() {
        const u = new URL(window.location.href);
        return {
          buyer: (u.searchParams.get("buyer") || "card").toLowerCase(), // card | proc
          offer: (u.searchParams.get("offer") || "quickscan").toLowerCase(),
          tier:  (u.searchParams.get("tier")  || "base").toLowerCase(), // base | pro | ent
          rid:   (u.searchParams.get("rid")   || "").trim()
        };
      }

      function setParams(patch) {
        const u = new URL(window.location.href);
        Object.entries(patch).forEach(([k,v]) => {
          if (v === null || v === undefined || v === "") u.searchParams.delete(k);
          else u.searchParams.set(k, String(v));
        });
        window.history.replaceState({}, "", u.toString());
      }

      function ensureRid(existingRid) {
        const key = "nf_rid";
        const stored = localStorage.getItem(key);
        if (existingRid) { localStorage.setItem(key, existingRid); return existingRid; }
        if (stored) return stored;

        // RID: NF-YYYYMMDD-HHMMSS-XXXX
        const d = new Date();
        const pad = (n) => String(n).padStart(2, "0");
        const stamp = [
          d.getFullYear(),
          pad(d.getMonth()+1),
          pad(d.getDate())
        ].join("") + "-" + [pad(d.getHours()), pad(d.getMinutes()), pad(d.getSeconds())].join("");
        const rand = Math.random().toString(16).slice(2, 6).toUpperCase();
        const rid = `NF-${stamp}-${rand}`;
        localStorage.setItem(key, rid);
        return rid;
      }

      function buildUrl(path, params) {
        const u = new URL(path, window.location.origin);
        Object.entries(params || {}).forEach(([k,v]) => {
          if (v !== null && v !== undefined && v !== "") u.searchParams.set(k, String(v));
        });
        return u.pathname + (u.search ? u.search : "");
      }

      function copyToClipboard(text) {
        return navigator.clipboard.writeText(text);
      }

      // ---------- State ----------
      const state = getParams();
      state.rid = ensureRid(state.rid);
      if (!QS_TIERS[state.tier]) state.tier = "base";
      if (!OFFER_CATALOG[state.offer]) state.offer = "quickscan";
      if (state.buyer !== "proc" && state.buyer !== "card") state.buyer = "card";

      setParams({ buyer: state.buyer, offer: state.offer, tier: state.tier, rid: state.rid });

      // ---------- UI: Buyer mode ----------
      const modeCard = $("#modeCard");
      const modeProc = $("#modeProc");

      function setBuyerMode(mode) {
        state.buyer = mode;
        modeCard.setAttribute("aria-selected", mode === "card" ? "true" : "false");
        modeProc.setAttribute("aria-selected", mode === "proc" ? "true" : "false");
        setParams({ buyer: mode });
        updateAll();
      }

      modeCard.addEventListener("click", () => setBuyerMode("card"));
      modeProc.addEventListener("click", () => setBuyerMode("proc"));

      // ---------- UI: Tier selection ----------
      const tierRadios = $$('input[name="qsTier"]');
      const tierCards = $$('.nfTier');

      function setTier(tier) {
        if (!QS_TIERS[tier]) tier = "base";
        state.tier = tier;
        tierRadios.forEach(r => { r.checked = (r.value === tier); });
        tierCards.forEach(c => c.setAttribute("aria-checked", c.getAttribute("data-tier") === tier ? "true" : "false"));
        setParams({ tier });
        updateAll();
      }

      tierRadios.forEach(r => r.addEventListener("change", () => setTier(r.value)));

      // keyboard support for tier cards
      tierCards.forEach(card => {
        card.addEventListener("click", () => setTier(card.getAttribute("data-tier")));
        card.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            setTier(card.getAttribute("data-tier"));
          }
        });
      });

      // ---------- Offer selection (for procurement summary + sticky CTA) ----------
      const offerEls = $$(".nfCard[data-offer]");
      offerEls.forEach(el => {
        el.addEventListener("mouseenter", () => { state.offer = el.getAttribute("data-offer"); updateAll(false); });
        el.addEventListener("focusin", () => { state.offer = el.getAttribute("data-offer"); updateAll(false); });
      });

      // ---------- Primary CTAs / Links ----------
      const qsPrimaryCta = $("#qsPrimaryCta");
      const procIntakeCta = $("#procIntakeCta");
      const procStatusCta = $("#procStatusCta");
      const ridInline = $("#ridInline");
      const ridBox = $("#ridBox");

      const stickyTitle = $("#stickyTitle");
      const stickySub = $("#stickySub");
      const stickyBtn = $("#stickyBtn");

      const internalSummary = $("#internalSummary");
      const emailDraft = $("#emailDraft");
      const mailtoBtn = $("#mailtoBtn");

      function offerNeed(offerKey) {
        const o = OFFER_CATALOG[offerKey];
        if (!o) return "general";
        if (offerKey === "quickscan") return "quickscan";
        return o.defaultNeed || "general";
      }

      function selectedOfferLabel() {
        const o = OFFER_CATALOG[state.offer] || OFFER_CATALOG.quickscan;
        if (state.offer === "quickscan") return `Copilot QuickScan — ${QS_TIERS[state.tier].label}`;
        return o.label;
      }

      function buildProcurementSummary() {
        const buyerLine = (state.buyer === "proc") ? "Invoice/PO procurement path" : "Card checkout path";
        const offerLine = selectedOfferLabel();
        const ridLine = state.rid;

        let priceLine = "";
        if (state.offer === "quickscan") {
          const t = QS_TIERS[state.tier];
          priceLine = `Price: ${t.priceText} CAD (approx.) | Delivery: ${t.delivery}`;
        } else {
          priceLine = "Price: per page / quote (see linked page) | Delivery: per scope";
        }

        const links = {
          gate: buildUrl("/gate/", { buyer: state.buyer, offer: state.offer, tier: state.tier, rid: state.rid }),
          intake: buildUrl("/gate/intake/", { need: offerNeed(state.offer), offer: state.offer, tier: state.tier, rid: state.rid }),
          vendor: buildUrl("/vendor/", { rid: state.rid }),
          status: buildUrl("/status/", { rid: state.rid })
        };

        const scope = (state.offer === "quickscan")
          ? "Scope: evidence-first readiness scan for Microsoft 365 Copilot adoption (oversharing exposure, data boundaries, retention/audit posture, extensions/connectors posture)."
          : "Scope: governance-first AI adoption package (details confirmed after intake).";

        const output = [
          `Noetfield purchase request (${buyerLine})`,
          `Offer: ${offerLine}`,
          priceLine,
          `RID: ${ridLine}`,
          "",
          scope,
          "Outputs: board-safe snapshot, procurement-ready brief, and a clear next-step plan (non-legal).",
          "",
          "Links:",
          `Gate:   ${links.gate}`,
          `Intake:  ${links.intake}`,
          `Vendor:  ${links.vendor}`,
          `Status:  ${links.status}`,
          "",
          "Notes: Public intake is non-confidential. For sensitive scope, request NDA via procurement."
        ].join("\n");

        return output;
      }

      function buildEmailDraft() {
        const offerLine = selectedOfferLabel();
        const subject = `Purchase request: ${offerLine} (RID ${state.rid})`;

        const summary = buildProcurementSummary();

        const body = [
          "Hello,",
          "",
          "Requesting approval to proceed with the following Noetfield package:",
          "",
          summary,
          "",
          "Procurement / invoicing contact: procurement@noetfield.com",
          "Billing contact: billing@noetfield.com",
          "",
          "Thank you,"
        ].join("\n");

        return { subject, body };
      }

      function updateCtas() {
        // QuickScan primary CTA behavior:
        // - buyer=card AND stripe link present -> direct checkout
        // - otherwise -> intake
        const t = QS_TIERS[state.tier];
        const hasStripe = t.stripe && !String(t.stripe).startsWith("REPLACE_STRIPE_LINK");
        const intakeHref = buildUrl("/gate/intake/", { need: "quickscan", offer: "quickscan", tier: state.tier, rid: state.rid });

        if (state.buyer === "card" && hasStripe) {
          qsPrimaryCta.textContent = `Checkout QuickScan (${t.label})`;
          qsPrimaryCta.setAttribute("href", t.stripe);
          qsPrimaryCta.setAttribute("rel", "noopener");
          qsPrimaryCta.setAttribute("target", "_blank");
        } else {
          qsPrimaryCta.textContent = (state.buyer === "proc") ? `Start intake (invoice/PO)` : `Start QuickScan`;
          qsPrimaryCta.removeAttribute("target");
          qsPrimaryCta.removeAttribute("rel");
          qsPrimaryCta.setAttribute("href", intakeHref);
        }

        // procurement panel links
        procIntakeCta.setAttribute("href", buildUrl("/gate/intake/", {
          need: offerNeed(state.offer), offer: state.offer, tier: state.tier, rid: state.rid
        }));
        procStatusCta.setAttribute("href", buildUrl("/status/", { rid: state.rid }));

        // vendor link carries RID
        const vendorLink = $("#vendorLink");
        if (vendorLink) vendorLink.setAttribute("href", buildUrl("/vendor/", { rid: state.rid }));
      }

      function updateSticky() {
        stickyTitle.textContent = selectedOfferLabel();
        stickySub.textContent = (state.buyer === "proc") ? "Invoice / PO (procurement)" : "Card checkout (fast)";

        let href = buildUrl("/gate/intake/", { need: offerNeed(state.offer), offer: state.offer, tier: state.tier, rid: state.rid });
        let label = "Start";

        if (state.offer === "quickscan") {
          const t = QS_TIERS[state.tier];
          const hasStripe = t.stripe && !String(t.stripe).startsWith("REPLACE_STRIPE_LINK");
          if (state.buyer === "card" && hasStripe) {
            href = t.stripe;
            label = `Checkout (${t.label})`;
            stickyBtn.setAttribute("target", "_blank");
            stickyBtn.setAttribute("rel", "noopener");
          } else {
            label = (state.buyer === "proc") ? "Start intake" : "Start QuickScan";
            stickyBtn.removeAttribute("target");
            stickyBtn.removeAttribute("rel");
          }
        } else {
          stickyBtn.removeAttribute("target");
          stickyBtn.removeAttribute("rel");
          label = (state.buyer === "proc") ? "Start intake" : "Start";
        }

        stickyBtn.textContent = label;
        stickyBtn.setAttribute("href", href);
      }

      function updateProcurementText() {
        ridInline.textContent = state.rid;
        ridBox.textContent = state.rid;

        const summary = buildProcurementSummary();
        internalSummary.value = summary;

        const mail = buildEmailDraft();
        emailDraft.value = `Subject: ${mail.subject}\n\n${mail.body}`;

        const mailto = new URL("mailto:procurement@noetfield.com");
        mailto.searchParams.set("subject", mail.subject);
        mailto.searchParams.set("body", mail.body);
        mailtoBtn.setAttribute("href", mailto.toString());
      }

      function updateAll(pushOfferParam=true) {
        if (pushOfferParam) setParams({ offer: state.offer });
        updateCtas();
        updateSticky();
        updateProcurementText();
      }

      // Wire copy buttons
      $("#copySummaryBtn").addEventListener("click", async () => {
        await copyToClipboard(internalSummary.value);
        $("#copySummaryBtn").textContent = "Copied";
        setTimeout(() => $("#copySummaryBtn").textContent = "Copy summary", 900);
      });

      $("#copyEmailBtn").addEventListener("click", async () => {
        await copyToClipboard(emailDraft.value);
        $("#copyEmailBtn").textContent = "Copied";
        setTimeout(() => $("#copyEmailBtn").textContent = "Copy email", 900);
      });

      $("#refreshSummaryBtn").addEventListener("click", () => updateProcurementText());

      // Initial tier + mode
      setBuyerMode(state.buyer);
      setTier(state.tier);
      updateAll(true);

      // Keep offer synced to URL when user clicks inside cards (best-effort)
      offerEls.forEach(el => {
        el.addEventListener("click", () => {
          state.offer = el.getAttribute("data-offer");
          setParams({ offer: state.offer });
          updateAll(false);
        });
      });

      // Ensure status link always has RID
      window.addEventListener("focus", () => {
        const ridNow = ensureRid("");
        if (ridNow !== state.rid) {
          state.rid = ridNow;
          setParams({ rid: state.rid });
          updateAll(false);
        }
      });
    })();
  </script>

  <!--
  CHANGELOG (v3.2)
  - Rebuilt Gate as a single buyer-first hub with QuickScan tier selector, procurement pack, and sticky CTA.
  - Locked tier values to base|pro|ent across routing; RID persistence via URL + localStorage.
  - Procurement builder generates internal summary + email draft; copy buttons + mailto.
  - Primary CTA switches: card checkout (when Stripe link exists) vs intake.

  SMOKE TEST
  - /gate/ returns 200
  - /assets/noetfield-shell.css returns 200
  - /assets/noetfield-shell.js returns 200
  - Header/footer inject correctly (partials)
  - Buyer mode toggle updates CTAs and sticky bar
  - Tier selection updates CTAs + procurement text
  - RID present in URL and shown in UI
  - Intake link includes need/offer/tier/rid
  -->
</body>
</html>
