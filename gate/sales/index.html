<!-- /gate/sales/index.html — Noetfield Sales v3.3
     (Single Stripe mount slot • multi-QuickScan SKUs • Trust Ledger SKUs • invoice/PO • intake routing • RID continuity • JS-off fallbacks)
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Noetfield — Sales</title>
  <meta name="description" content="Start page for Noetfield packages. Card payment (optional), Invoice/PO procurement lane, and non-confidential intake. Selected package summary with RID continuity." />
  <meta name="robots" content="index,follow" />
  <meta name="author" content="Noetfield Systems Inc." />
  <meta name="theme-color" content="#07070b" />

  <link rel="canonical" href="https://www.noetfield.com/gate/sales/" />
  <link rel="icon" href="/noetfield-favicon-512.png" type="image/png" />
  <link rel="apple-touch-icon" href="/noetfield-favicon-512.png" />

  <!-- OG -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Noetfield" />
  <meta property="og:title" content="Noetfield — Sales" />
  <meta property="og:description" content="Start a package via card pay, invoice/PO, or non-confidential intake. Procurement-ready flow." />
  <meta property="og:url" content="https://www.noetfield.com/gate/sales/" />
  <meta property="og:image" content="https://www.noetfield.com/noetfield-og.png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Noetfield — Sales" />
  <meta name="twitter:description" content="Start a package via card pay, invoice/PO, or non-confidential intake." />
  <meta name="twitter:image" content="https://www.noetfield.com/noetfield-og.png" />

  <!-- LOCKED SHELL -->
  <link rel="stylesheet" href="/assets/noetfield-shell.css" />
  <script src="/assets/noetfield-shell.js" defer></script>

  <!-- Stripe Buy Button (load once) -->
  <script async src="https://js.stripe.com/v3/buy-button.js"></script>

  <style>
    .hero{padding:18px 0 12px}
    .heroShell{
      position:relative;
      border-radius: calc(var(--radius) + 10px);
      border: 1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(1100px 520px at 16% 0%, rgba(200,163,73,.20), transparent 62%),
        radial-gradient(980px 520px at 92% 10%, rgba(122,167,255,.12), transparent 64%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.020));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .heroShell::before{
      content:"";
      position:absolute; inset:-1px;
      background: linear-gradient(120deg, rgba(200,163,73,.28), transparent 32%, rgba(255,255,255,.08) 68%, transparent);
      opacity:.46;
      pointer-events:none;
      mask-image: linear-gradient(180deg, black 0%, black 62%, transparent 96%);
    }
    .heroInner{padding: 26px 22px; position:relative; z-index:1}
    .eyebrow{
      display:inline-flex; gap:10px; align-items:center;
      color:var(--muted);
      font-size:13px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.13);
      background: rgba(255,255,255,.035);
    }
    .dot{
      width:8px; height:8px; border-radius:50%;
      background: rgba(200,163,73,.97);
      box-shadow: 0 0 0 3px rgba(200,163,73,.18);
    }
    h1{margin:14px 0 10px; font-size: clamp(30px, 3.1vw, 46px); line-height:1.06; letter-spacing:-0.8px}
    .lead{margin:0; color:var(--muted); font-size:16px; line-height:1.75; max-width: 980px}
    .lead strong{color:var(--text); font-weight:950}
    .actions{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:14px}
    .actions .btn{min-height:44px}
    .metaRow{display:flex; flex-wrap:wrap; gap:10px; margin-top:14px}
    .pill{
      display:inline-flex; align-items:center; gap:10px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color:var(--muted);
      font-size:13px;
      white-space:nowrap;
    }
    .pill strong{color:var(--text); font-weight:950}
    .notice{
      margin-top:12px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color:var(--muted2);
      font-size:12.8px;
      line-height:1.6;
    }
    .notice strong{ color:var(--text); font-weight:950; }
    .notice a{ border-bottom:1px solid rgba(255,255,255,.18); }

    .grid{
      display:grid;
      grid-template-columns: 1.08fr .92fr;
      gap:16px;
      margin: 14px 0 34px;
      align-items:start;
    }
    .card{
      border-radius:var(--radius);
      border:1px solid rgba(255,255,255,.11);
      background: linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.022));
      box-shadow: var(--shadow2);
      overflow:hidden;
      min-width:0;
    }
    .hd{ padding:18px 18px 0; }
    .bd{ padding:18px; }
    .cardTitle{ margin:0 0 8px; font-size:18px; letter-spacing:-0.2px; font-weight:950; }
    .muted{ color:var(--muted); line-height:1.7; margin:0; }

    .section{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius:16px;
      padding:14px;
      margin-top:12px;
    }
    .sectionTitle{font-weight:950; letter-spacing:-.2px; margin:0 0 6px; font-size:14px; color:var(--text)}
    .sectionDesc{margin:0 0 10px; color:var(--muted2); font-size:12.7px; line-height:1.6}

    .table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      margin-top:10px;
    }
    .table th, .table td{
      text-align:left;
      padding:12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      vertical-align:top;
      font-size:13px;
    }
    .table th{
      color:var(--muted2);
      font-size:11px;
      letter-spacing:.28em;
      text-transform:uppercase;
      background: rgba(255,255,255,.03);
    }
    .table tr:last-child td{border-bottom:none}
    .table .selectLink{
      border-bottom:1px solid rgba(255,255,255,.18);
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }

    /* Single Stripe mount slot (always visible, avoids hide/show failures) */
    .paySlotWrap{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius:16px;
      padding:12px;
      margin-top:10px;
    }
    #paySlot stripe-buy-button{
      display:block;
      max-width: 560px;
    }
    .payFallback{
      margin-top:10px;
      color:var(--muted2);
      font-size:12.7px;
      line-height:1.6;
    }
    .payFallback a{ border-bottom:1px solid rgba(255,255,255,.18); }

    .rail{ position: sticky; top: 14px; }
    .box{
      margin-top:12px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color:var(--muted2);
      font-size:12.8px;
      line-height:1.6;
    }
    .box strong{color:var(--text); font-weight:950}
    .box a{border-bottom:1px solid rgba(255,255,255,.18)}
    .railActions{ display:grid; gap:10px; margin-top:12px; }
    .railActions .btn{ min-height:46px; }
    .divider{ height:1px; background: rgba(255,255,255,.10); margin: 14px 0; }

    .stickyCta{
      position: sticky;
      bottom: 0;
      z-index: 20;
      padding: 10px 0;
      background: linear-gradient(180deg, rgba(7,7,11,0) 0%, rgba(7,7,11,.78) 22%, rgba(7,7,11,.92) 100%);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255,255,255,.08);
      display:none;
    }
    .stickyInner{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      padding: 0 16px;
      max-width: 1120px;
      margin: 0 auto;
    }
    .stickyText{
      min-width:0;
      color:var(--muted);
      font-size:12.6px;
      line-height:1.4;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .stickyText strong{ color:var(--text); font-weight:950; }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .rail{ position: relative; top: 0; }
    }
    @media (max-width: 760px){
      .heroInner{ padding: 18px 14px; }
      .hd, .bd{ padding-left:14px; padding-right:14px; }
      .stickyCta{ display:block; }
      body{ padding-bottom: calc(74px + env(safe-area-inset-bottom)); }
    }
  </style>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Noetfield — Sales",
    "url":"https://www.noetfield.com/gate/sales/",
    "description":"Start page for Noetfield packages: card payment (optional), invoice/PO procurement lane, and non-confidential intake.",
    "isPartOf":{"@type":"WebSite","name":"Noetfield","url":"https://www.noetfield.com/"},
    "publisher":{"@type":"Organization","name":"Noetfield Systems Inc."}
  }
  </script>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>
  <a class="skip" href="#main">Skip to content</a>

  <header id="nfHeader"></header>

  <main id="main" class="wrap">
    <section class="hero" aria-label="Sales hero">
      <div class="heroShell">
        <div class="heroInner">
          <div class="eyebrow"><span class="dot"></span> Purchase/start • procurement-ready • RID continuity</div>

          <h1>Start a package.</h1>

          <p class="lead">
            Three start paths: <strong>card payment (optional)</strong>, <strong>Invoice/PO (procurement)</strong>, or <strong>non-confidential intake</strong>.
            The selected package is shown on the right.
          </p>

          <div class="actions" aria-label="Primary actions">
            <a class="btn secondary" href="/gate/" data-rid-link>Back to Gate</a>
            <a class="btn primary" href="#pay" data-rid-link>Pay by card</a>
            <a class="btn secondary" href="#procurement" data-rid-link>Invoice / PO</a>
            <a class="btn secondary" href="#intake" data-rid-link>Start intake (non-confidential)</a>
          </div>

          <div class="metaRow" aria-label="Highlights">
            <div class="pill"><strong>RID</strong> preserved</div>
            <div class="pill"><strong>Offer</strong> code shown</div>
            <div class="pill"><strong>Procurement</strong> lane</div>
            <div class="pill"><strong>Card pay</strong> optional</div>
          </div>

          <div class="notice" role="note">
            <strong>Public intake is non-confidential by design.</strong>
            Avoid secrets, credentials, private keys, customer identifiers, or regulated personal data.
          </div>
        </div>
      </div>
    </section>

    <section class="grid" aria-label="Sales layout">
      <!-- MAIN -->
      <section class="card" aria-label="Sales main">
        <div class="hd">
          <h2 class="cardTitle">Start options</h2>
          <p class="muted">Select a SKU (if needed), then pay by card or use Invoice/PO. One Stripe widget is mounted below for reliability.</p>
        </div>

        <div class="bd">
          <!-- Card pay selection table (no embedded stripe buttons) -->
          <div class="section" aria-label="Card payment selection">
            <div class="sectionTitle">Option A — Card payment (optional)</div>
            <p class="sectionDesc">Use when procurement allows card payment. Select a SKU to load the card payment widget.</p>

            <table class="table" aria-label="Card pay SKUs">
              <thead>
                <tr>
                  <th>Package</th>
                  <th>Offer code</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>Copilot Readiness — Starter</strong> (2 weeks)</td>
                  <td><code>NF-CR-2W</code></td>
                  <td><span class="selectLink" data-offer="readiness_starter">Select</span></td>
                </tr>
                <tr>
                  <td><strong>Copilot Readiness — Standard</strong> (4 weeks)</td>
                  <td><code>NF-CR-4W</code></td>
                  <td><span class="selectLink" data-offer="readiness_standard">Select</span></td>
                </tr>
                <tr>
                  <td><strong>Copilot Readiness — Extended</strong> (6 weeks)</td>
                  <td><code>NF-CR-6W</code></td>
                  <td><span class="selectLink" data-offer="readiness_extended">Select</span></td>
                </tr>
                <tr>
                  <td><strong>Copilot QuickScan — Base</strong> (5–7 business days)</td>
                  <td><code>NF-QS-BASE</code></td>
                  <td><span class="selectLink" data-offer="quickscan_base">Select</span></td>
                </tr>
                <tr>
                  <td><strong>Copilot QuickScan — Priority</strong></td>
                  <td><code>NF-QS-PRIORITY</code></td>
                  <td><span class="selectLink" data-offer="quickscan_priority">Select</span></td>
                </tr>
                <tr>
                  <td><strong>Copilot QuickScan — Extended</strong></td>
                  <td><code>NF-QS-EXT</code></td>
                  <td><span class="selectLink" data-offer="quickscan_ext">Select</span></td>
                </tr>
                <tr>
                  <td><strong>Trust Ledger — Core</strong> (ongoing)</td>
                  <td><code>NF-TL-CORE</code></td>
                  <td><span class="selectLink" data-offer="trust_ledger_core">Select</span></td>
                </tr>
                <tr>
                  <td><strong>Trust Ledger — Board Reporting Add-On</strong></td>
                  <td><code>NF-TL-BOARD</code></td>
                  <td><span class="selectLink" data-offer="trust_ledger_board">Select</span></td>
                </tr>
              </tbody>
            </table>

            <div class="notice" style="margin-top:12px;">
              <strong>Billing note:</strong> Prices are in CAD. If tax (GST/HST) applies for invoice-based procurement, it is shown on the invoice.
              Card payment tax handling depends on Stripe configuration.
            </div>
          </div>

          <!-- Single reliable Stripe mount slot -->
          <div class="section" id="pay" aria-label="Card payment widget">
            <div class="sectionTitle">Card payment (Stripe)</div>
            <p class="sectionDesc">This widget updates to match the selected package. If it does not load, use the direct payment link below.</p>

            <div class="paySlotWrap">
              <div id="paySlot" aria-live="polite"></div>
              <div class="payFallback" id="payFallback"></div>

              <noscript>
                <div class="payFallback">
                  Card pay links:
                  <a href="https://buy.stripe.com/dRm14o7za95W5mi0UA1Nu08" target="_blank" rel="nofollow noopener">Readiness Starter</a> ·
                  <a href="https://buy.stripe.com/dRm3cw1aMdmc9Cy32I1Nu09" target="_blank" rel="nofollow noopener">Readiness Standard</a> ·
                  <a href="https://buy.stripe.com/28E9AU6v63LC3ea1YE1Nu0a" target="_blank" rel="nofollow noopener">Readiness Extended</a> ·
                  <a href="https://buy.stripe.com/7sY4gA6v681S2a6cDi1Nu00" target="_blank" rel="nofollow noopener">QuickScan Base</a> ·
                  <a href="https://buy.stripe.com/14A4gAg5Gfuk2a646M1Nu01" target="_blank" rel="nofollow noopener">QuickScan Priority</a> ·
                  <a href="https://buy.stripe.com/fZu5kE7za81SdSO5aQ1Nu02" target="_blank" rel="nofollow noopener">QuickScan Extended</a> ·
                  <a href="https://buy.stripe.com/5kQdRa6v64PGg0WfPu1Nu05" target="_blank" rel="nofollow noopener">Trust Ledger Core</a> ·
                  <a href="https://buy.stripe.com/6oU4gA8De81S4ie9r61Nu06" target="_blank" rel="nofollow noopener">Trust Ledger Board Add-on</a>
                </div>
              </noscript>
            </div>
          </div>

          <!-- Procurement -->
          <div class="section" id="procurement" aria-label="Procurement">
            <div class="sectionTitle">Option B — Invoice / PO (Procurement lane)</div>
            <p class="sectionDesc">Use when vendor onboarding, PO, invoice terms, or security/privacy review is required.</p>

            <div class="actions" style="margin-top:10px;">
              <a class="btn primary" id="procLink" href="/gate/procurement/" data-rid-link>Open Procurement lane</a>
              <a class="btn secondary" href="/gate/#procurement" data-rid-link>Approval email builder (Gate)</a>
            </div>

            <div class="notice" style="margin-top:12px;">
              <strong>Contact:</strong> procurement routing via <a href="mailto:ops@noetfield.com">ops@noetfield.com</a>.
            </div>
          </div>

          <!-- Intake -->
          <div class="section" id="intake" aria-label="Intake">
            <div class="sectionTitle">Option C — Start intake (non-confidential)</div>
            <p class="sectionDesc">Use to lock scope and confirm the right tier before payment/procurement.</p>

            <div class="actions" style="margin-top:10px;">
              <a class="btn primary" id="intakeLink" href="/gate/intake/" data-rid-link>Start intake</a>
              <a class="btn secondary" id="detailsLink" href="/gate/" data-rid-link>Back to selection</a>
            </div>

            <div class="notice" style="margin-top:12px;">
              <strong>Reminder:</strong> Public intake is non-confidential. Provide only high-level context (no secrets, credentials, or personal data).
            </div>
          </div>

          <!-- What happens next -->
          <div class="section" aria-label="What happens next">
            <div class="sectionTitle">What happens after start</div>
            <p class="sectionDesc">Designed for minimal supervision and limited back-and-forth.</p>
            <ul style="margin:0; padding-left:18px; color:var(--muted); line-height:1.85">
              <li><strong>Scope lock:</strong> confirm tier + boundaries + owners.</li>
              <li><strong>Kickoff:</strong> email-first; short call only if scope confirmation requires it.</li>
              <li><strong>Delivery:</strong> board/procurement-ready artifact pack + decision gates.</li>
              <li><strong>Optional:</strong> continuity via Trust Ledger.</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- RAIL -->
      <aside class="rail" aria-label="Selected package rail">
        <div class="card">
          <div class="hd">
            <h2 class="cardTitle">Selected package</h2>
            <p class="muted" id="railDesc">Loaded from Gate selection (or query param).</p>
          </div>

          <div class="bd">
            <div class="box">
              <div><strong id="railName">—</strong></div>
              <div style="margin-top:6px;"><span id="railMeta">—</span></div>
              <div style="margin-top:8px;"><strong>Offer code:</strong> <code id="railCode">—</code></div>
            </div>

            <div class="railActions" aria-label="Rail actions">
              <a class="btn primary" id="railPay" href="#pay">Pay by card</a>
              <a class="btn" id="railProc" href="/gate/procurement/" data-rid-link>Invoice / PO</a>
              <a class="btn secondary" id="railIntake" href="/gate/intake/" data-rid-link>Start intake</a>
              <a class="btn secondary" id="railDetails" href="/gate/" data-rid-link>View details</a>
            </div>

            <div class="divider" aria-hidden="true"></div>

            <div class="box">
              <div><strong>Request ID:</strong> <code data-rid>—</code></div>
              <div style="margin-top:6px;">RID is preserved on Gate/Procurement/Intake links.</div>
              <div style="margin-top:6px;">
                Samples:
                <a href="/trust-ledger/sample-report/board-memo.pdf" data-rid-link>Board memo</a> ·
                <a href="/trust-ledger/ledger-entry.pdf" data-rid-link>Ledger entry</a>
              </div>
            </div>

            <div class="box">
              <strong>Sales contact</strong><br/>
              <a href="mailto:sales@noetfield.com">sales@noetfield.com</a><br/>
              <span style="display:block; margin-top:6px;"><strong>Ops:</strong> <a href="mailto:ops@noetfield.com">ops@noetfield.com</a></span>
              <span style="display:block; margin-top:6px;"><strong>Trust:</strong> <a href="mailto:trust@noetfield.com">trust@noetfield.com</a></span>
            </div>
          </div>
        </div>
      </aside>
    </section>
  </main>

  <footer id="nfFooter"></footer>

  <div class="stickyCta" aria-label="Sticky call to action">
    <div class="stickyInner">
      <div class="stickyText" id="stickyText"><strong>Selected:</strong> —</div>
      <div class="actions" style="margin:0">
        <a class="btn primary" href="#pay">Pay</a>
        <a class="btn secondary" id="stickyProc" href="/gate/procurement/" data-rid-link>Invoice / PO</a>
      </div>
    </div>
  </div>

  <script>
    (function(){
      "use strict";

      function $(id){ return document.getElementById(id); }
      function qsa(sel){ try { return Array.prototype.slice.call(document.querySelectorAll(sel)); } catch(_) { return []; } }

      // RID helper
      function getRid(){
        try{
          var u = new URL(window.location.href);
          var rid = (u.searchParams.get("rid") || "").trim();
          if (rid) return rid;

          var ridEl = document.querySelector("[data-rid]");
          var fromDom = ridEl && (ridEl.textContent || "").trim();
          if (fromDom && fromDom !== "—") return fromDom;

          var k = "nf_rid";
          var cur = (localStorage.getItem(k) || "").trim();
          if (!cur){
            cur = "NF-" + Math.random().toString(36).slice(2, 8).toUpperCase() + "-" + Date.now().toString(36).toUpperCase();
            localStorage.setItem(k, cur);
          }
          return cur;
        } catch(e){
          return "NF-" + Date.now().toString(36).toUpperCase();
        }
      }

      function applyRidToLinks(rid){
        qsa("a[data-rid-link]").forEach(function(a){
          try{
            var href = a.getAttribute("href") || "";
            if (!href || href.indexOf("mailto:") === 0 || href.indexOf("#") === 0) return;
            var u = new URL(href, window.location.origin);
            if (!u.searchParams.get("rid")) u.searchParams.set("rid", rid);
            a.setAttribute("href", u.pathname + u.search + u.hash);
          } catch(_) {}
        });
      }

      // Offer selection storage (kept compatible with /gate)
      var STORAGE_KEY = "nf_gate_offer_v4";
      var DEFAULT_OFFER = "readiness_standard";

      var publishableKey = "pk_live_51SfSseJ03eJkL57JNU4voCGfUjjK4WDew62tPBWesZAejr03HX8uTonznYoWDVcpXwLATZpTvWSDfSU4zJbRIB6900xlpPcGSz";

      var offers = {
        readiness_starter: {
          name: "Microsoft 365 Copilot Readiness Assessment — Starter",
          meta: "2 weeks · 9,500 CAD",
          code: "NF-CR-2W",
          details: "/copilot/readiness/?tier=starter",
          intake: "/gate/intake/?need=copilot-readiness-starter",
          proc: "/gate/procurement/?focus=copilot-readiness-starter",
          pay: { link:"https://buy.stripe.com/dRm14o7za95W5mi0UA1Nu08", buyButtonId:"buy_btn_1Sh25JJ03eJkL57JPvKEMuzF" }
        },
        readiness_standard: {
          name: "Microsoft 365 Copilot Readiness Assessment — Standard",
          meta: "4 weeks · 15,000 CAD",
          code: "NF-CR-4W",
          details: "/copilot/readiness/?tier=standard",
          intake: "/gate/intake/?need=copilot-readiness-standard",
          proc: "/gate/procurement/?focus=copilot-readiness-standard",
          pay: { link:"https://buy.stripe.com/dRm3cw1aMdmc9Cy32I1Nu09", buyButtonId:"buy_btn_1Sh27KJ03eJkL57JMwq5iCSg" }
        },
        readiness_extended: {
          name: "Microsoft 365 Copilot Readiness Assessment — Extended",
          meta: "6 weeks · 25,000 CAD",
          code: "NF-CR-6W",
          details: "/copilot/readiness/?tier=extended",
          intake: "/gate/intake/?need=copilot-readiness-extended",
          proc: "/gate/procurement/?focus=copilot-readiness-extended",
          pay: { link:"https://buy.stripe.com/28E9AU6v63LC3ea1YE1Nu0a", buyButtonId:"buy_btn_1Sh29CJ03eJkL57Jyu54Xu3v" }
        },

        // QuickScan (3 SKUs from your 3 buy-buttons)
        quickscan_base: {
          name: "Copilot QuickScan — Base",
          meta: "5–7 business days · Rapid snapshot",
          code: "NF-QS-BASE",
          details: "/copilot/quickscan/",
          intake: "/copilot/quickscan/intake/",
          proc: "/gate/procurement/?focus=quickscan",
          pay: { link:"https://buy.stripe.com/7sY4gA6v681S2a6cDi1Nu00", buyButtonId:"buy_btn_1Sg1q9J03eJkL57J8NIjy5v8" }
        },
        quickscan_priority: {
          name: "Copilot QuickScan — Priority",
          meta: "Priority handling · Rapid snapshot",
          code: "NF-QS-PRIORITY",
          details: "/copilot/quickscan/",
          intake: "/copilot/quickscan/intake/?priority=1",
          proc: "/gate/procurement/?focus=quickscan-priority",
          pay: { link:"https://buy.stripe.com/14A4gAg5Gfuk2a646M1Nu01", buyButtonId:"buy_btn_1Sg0FEJ03eJkL57JsejfI5wu" }
        },
        quickscan_ext: {
          name: "Copilot QuickScan — Extended",
          meta: "Extended scope · Rapid snapshot",
          code: "NF-QS-EXT",
          details: "/copilot/quickscan/",
          intake: "/copilot/quickscan/intake/?extended=1",
          proc: "/gate/procurement/?focus=quickscan-extended",
          pay: { link:"https://buy.stripe.com/fZu5kE7za81SdSO5aQ1Nu02", buyButtonId:"buy_btn_1Sg0ESJ03eJkL57Ju6PFOiwj" }
        },

        // Trust Ledger (2 SKUs)
        trust_ledger_core: {
          name: "Trust Ledger — Core (Ongoing)",
          meta: "Ongoing · Core register + updates",
          code: "NF-TL-CORE",
          details: "/trust-ledger/",
          intake: "/trust-ledger/intake/?need=trust-ledger-core",
          proc: "/gate/procurement/?focus=trust-ledger-core",
          pay: { link:"https://buy.stripe.com/5kQdRa6v64PGg0WfPu1Nu05", buyButtonId:"buy_btn_1SgI5ZJ03eJkL57JEYpsEmWi" }
        },
        trust_ledger_board: {
          name: "Trust Ledger — Board Reporting Add-On",
          meta: "Add-on · Board-ready reporting cycle",
          code: "NF-TL-BOARD",
          details: "/trust-ledger/sample-report/online/",
          intake: "/trust-ledger/intake/?need=trust-ledger-board-reporting",
          proc: "/gate/procurement/?focus=trust-ledger-board",
          pay: { link:"https://buy.stripe.com/6oU4gA8De81S4ie9r61Nu06", buyButtonId:"buy_btn_1SgQtSJ03eJkL57JkNN1aB58" }
        },

        // Non-card default routes (kept for Gate selection compatibility)
        trust_brief: {
          name: "Trust Brief (6-week)",
          meta: "6 weeks · Base + add-ons",
          code: "NF-TB-6W",
          details: "/trust-brief/",
          intake: "/trust-brief/intake/",
          proc: "/gate/procurement/?focus=trust-brief",
          pay: null
        },
        trust_ledger: {
          name: "Trust Ledger (Overview)",
          meta: "Ongoing · Governance register",
          code: "NF-TL",
          details: "/trust-ledger/",
          intake: "/trust-ledger/intake/",
          proc: "/gate/procurement/?focus=trust-ledger",
          pay: null
        }
      };

      // Backward-compat aliases (if older flows store "quickscan")
      function normalizeOffer(id){
        if (!id) return DEFAULT_OFFER;
        if (id === "quickscan") return "quickscan_base";
        return offers[id] ? id : DEFAULT_OFFER;
      }

      function readOffer(){
        try{
          var u = new URL(window.location.href);
          var offer = (u.searchParams.get("offer") || "").trim();
          if (offer) return normalizeOffer(offer);
        } catch(_) {}
        try{
          var saved = (localStorage.getItem(STORAGE_KEY) || "").trim();
          if (saved) return normalizeOffer(saved);
        } catch(_) {}
        return DEFAULT_OFFER;
      }

      function writeOfferToUrl(id){
        try{
          var u = new URL(window.location.href);
          u.searchParams.set("offer", id);
          history.replaceState({}, "", u.pathname + u.search + u.hash);
        } catch(_) {}
      }

      function mountStripe(o){
        var slot = $("paySlot");
        var fb = $("payFallback");
        if (!slot || !fb) return;

        // Always replace the element (no hide/show); this prevents Stripe render failures.
        slot.innerHTML = "";
        fb.innerHTML = "";

        if (!o.pay || !o.pay.buyButtonId){
          fb.innerHTML =
            "Card pay is not enabled for this selection. Use " +
            '<a href="#procurement">Invoice / PO</a> or <a href="#intake">intake</a>.';
          return;
        }

        // Build the buy-button element fresh
        var el = document.createElement("stripe-buy-button");
        el.setAttribute("buy-button-id", o.pay.buyButtonId);
        el.setAttribute("publishable-key", publishableKey);
        slot.appendChild(el);

        // Direct link fallback (works if widget blocked)
        fb.innerHTML =
          'If the widget does not load, use the direct link: ' +
          '<a href="' + o.pay.link + '" target="_blank" rel="nofollow noopener">Pay by card</a>.';
      }

      function setOffer(id, opts){
        id = normalizeOffer(id);
        var o = offers[id];

        // Persist selection (same key as /gate)
        try{ localStorage.setItem(STORAGE_KEY, id); } catch(_) {}

        // Optional: keep URL in sync
        if (!opts || opts.pushUrl !== false) writeOfferToUrl(id);

        // Rail + main links
        $("railName").textContent = o.name;
        $("railMeta").textContent = o.meta;
        $("railCode").textContent = o.code || "—";
        $("stickyText").innerHTML = "<strong>Selected:</strong> " + o.name;

        $("railDetails").setAttribute("href", "/gate/?offer=" + encodeURIComponent(id));
        $("railIntake").setAttribute("href", o.intake);
        $("railProc").setAttribute("href", o.proc);

        $("detailsLink").setAttribute("href", "/gate/?offer=" + encodeURIComponent(id));
        $("intakeLink").setAttribute("href", o.intake);
        $("procLink").setAttribute("href", o.proc);

        // Stripe mount
        mountStripe(o);

        // RID after href changes
        var rid = getRid();
        applyRidToLinks(rid);
      }

      // Bind selection clicks
      function bindSelectors(){
        qsa("[data-offer]").forEach(function(x){
          x.addEventListener("click", function(){
            var id = x.getAttribute("data-offer");
            setOffer(id);
            // Scroll to pay area for immediate checkout
            try{ document.getElementById("pay").scrollIntoView({behavior:"smooth", block:"start"}); } catch(_) {}
          });
          x.setAttribute("role","button");
          x.setAttribute("tabindex","0");
          x.addEventListener("keydown", function(e){
            if (e.key === "Enter" || e.key === " ") { e.preventDefault(); x.click(); }
          });
        });
      }

      // Init
      var rid = getRid();
      applyRidToLinks(rid);
      bindSelectors();
      setOffer(readOffer(), {pushUrl:false});

    })();
  </script>
</body>
</html>
