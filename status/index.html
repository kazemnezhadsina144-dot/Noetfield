<!-- /status/index.html — Noetfield Status v2.4 (MVP polish)
     (RID lookup • Share link • Stepper • SLA • Non-confidential • Debug hidden) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Noetfield — Status (Request ID)</title>
  <meta name="description" content="Check Noetfield request status by Request ID. High-level routing updates only. Non-confidential by design." />
  <meta name="robots" content="index,follow" />
  <meta name="author" content="Noetfield Systems Inc." />
  <meta name="theme-color" content="#07070b" />

  <link rel="canonical" href="https://www.noetfield.com/status/" />
  <link rel="icon" href="/noetfield-favicon-512.png" type="image/png" />
  <link rel="apple-touch-icon" href="/noetfield-favicon-512.png" />

  <!-- OG -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Noetfield" />
  <meta property="og:title" content="Noetfield — Status (Request ID)" />
  <meta property="og:description" content="Check request status by Request ID. High-level updates only." />
  <meta property="og:url" content="https://www.noetfield.com/status/" />
  <meta property="og:image" content="https://www.noetfield.com/noetfield-og.png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Noetfield — Status (Request ID)" />
  <meta name="twitter:description" content="Check request status by Request ID. High-level updates only." />
  <meta name="twitter:image" content="https://www.noetfield.com/noetfield-og.png" />

  <!-- LOCKED SHELL -->
  <link rel="stylesheet" href="/assets/noetfield-shell.css" />
  <script src="/assets/noetfield-shell.js" defer></script>

  <style>
    /* Polish layer only (keeps shell as source of truth) */
    .hero{padding:22px 0 14px}
    .heroShell{
      position:relative;
      border-radius: calc(var(--radius) + 8px);
      border:1px solid rgba(255,255,255,.11);
      background:
        radial-gradient(1000px 420px at 18% 0%, rgba(200,163,73,.18), transparent 60%),
        radial-gradient(1000px 420px at 90% 10%, rgba(122,167,255,.10), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.022));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .heroShell::before{
      content:"";
      position:absolute; inset:-1px;
      background: linear-gradient(120deg, rgba(200,163,73,.26), transparent 30%, rgba(255,255,255,.08) 68%, transparent);
      opacity:.44;
      pointer-events:none;
      mask-image: linear-gradient(180deg, black 0%, black 58%, transparent 96%);
    }
    .heroInner{padding:24px 22px}
    .eyebrow{
      display:inline-flex; gap:10px; align-items:center;
      color:var(--muted);
      font-size:13px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.13);
      background: rgba(255,255,255,.035);
    }
    .dot{
      width:8px; height:8px; border-radius:50%;
      background: rgba(200,163,73,.97);
      box-shadow: 0 0 0 3px rgba(200,163,73,.18);
    }
    h1{margin:14px 0 10px; font-size:40px; line-height:1.07; letter-spacing:-0.75px}
    .lead{margin:0; color:var(--muted); font-size:16px; max-width: 980px; line-height:1.75}
    .lead strong{color:var(--text); font-weight:900}

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:18px;
      margin: 18px 0 34px;
      align-items:start;
    }

    .card{
      border-radius:var(--radius);
      border:1px solid rgba(255,255,255,.11);
      background: linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.022));
      box-shadow: var(--shadow2);
      overflow:hidden;
      min-width:0;
    }
    .card .hd{padding:18px 18px 0}
    .card .bd{padding:18px}
    .card h2{margin:0 0 8px; font-size:18px; letter-spacing:-.2px}
    .card p{margin:0 0 12px; color:var(--muted); line-height:1.7}

    /* RID bar */
    .ridBar{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-top:12px;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      min-width:0;
    }
    .ridLabel{font-size:11px; letter-spacing:.28em; text-transform:uppercase; color:var(--muted2)}
    .ridValue{
      font-weight:800; color:var(--text); font-size:13px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:520px
    }
    .ridActions{display:flex; gap:8px; align-items:center; flex-wrap:wrap}

    .miniBtn{
      font-size:13px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      padding:9px 12px;
      border-radius:14px;
      cursor:pointer;
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      color: var(--text);
      text-decoration:none;
      user-select:none;
      transition: border-color .15s ease, background .15s ease, transform .06s ease;
      white-space:nowrap;
    }
    .miniBtn.primary{border-color: rgba(200,163,73,.38); background: rgba(200,163,73,.10)}
    .miniBtn:hover{border-color:rgba(255,255,255,.22); background:rgba(255,255,255,.06)}
    .miniBtn:active{transform: translateY(1px)}

    label{display:block; font-size:12px; color:var(--muted2); margin:0 0 6px}
    input{
      width:100%;
      background: rgba(10,10,16,.55);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--text);
      padding: 12px 12px;
      border-radius: 14px;
      font-family:inherit;
      font-size:14px;
      transition: border-color .15s ease, box-shadow .15s ease, background .15s ease;
    }
    input::placeholder{color: rgba(185,187,207,.55)}
    input:focus{box-shadow: var(--focus); background: rgba(12,12,18,.62)}
    .actions{display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-top:12px}

    .msg{
      display:none;
      margin-top:12px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size:12.8px;
      line-height:1.6;
    }

    .resultWrap{margin-top:12px}
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .badge.ok{border-color: rgba(45,227,138,.22); background: rgba(45,227,138,.06); color:#dfffea}
    .badge.muted{border-color: rgba(255,255,255,.12); background: rgba(255,255,255,.03); color:var(--muted)}
    .bDot{
      width:8px; height:8px; border-radius:50%;
      background: rgba(200,163,73,.95);
      box-shadow: 0 0 0 3px rgba(200,163,73,.18);
    }

    .stepper{
      margin-top:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      padding:14px;
    }
    .steps{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap:10px;
      margin-top:10px;
    }
    .step{
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      padding:10px 10px;
      min-width:0;
    }
    .step .k{font-size:11px; letter-spacing:.18em; text-transform:uppercase; color:var(--muted2)}
    .step .v{margin-top:6px; font-size:12.8px; color:var(--muted); line-height:1.45}
    .step.active{
      border-color: rgba(200,163,73,.30);
      background: linear-gradient(180deg, rgba(200,163,73,.12), rgba(255,255,255,.02));
    }

    .kv{
      margin-top:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      padding:14px;
    }
    .kRow{
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:12px; padding:10px 0;
      border-top:1px solid rgba(255,255,255,.08);
    }
    .kRow:first-child{border-top:0; padding-top:0}
    .kRow .k{color:var(--muted2); font-size:12px; letter-spacing:.12em; text-transform:uppercase; min-width:160px}
    .kRow .v{color:var(--text); font-size:13.5px; line-height:1.55; flex:1}
    .muted{color:var(--muted2)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}

    .box{
      margin-top:12px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color:var(--muted2);
      font-size:12.8px;
      line-height:1.6;
    }
    .box strong{color:var(--text); font-weight:900}
    .box a{border-bottom:1px solid rgba(255,255,255,.18)}
    .hr{height:1px; background:rgba(255,255,255,.10); margin:14px 0}
    .small{font-size:12.5px; color:var(--muted2); line-height:1.65}

    details{
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      padding:12px 12px;
    }
    summary{cursor:pointer; color:var(--text); font-weight:800}
    details p{margin:10px 0 0; color:var(--muted); line-height:1.7}

    a:focus-visible, button:focus-visible, input:focus-visible{
      outline:2px solid rgba(200,163,73,.65);
      outline-offset:3px;
      border-radius:12px;
    }

    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .ridValue{max-width:100%}
      .steps{grid-template-columns:1fr 1fr 1fr}
    }
    @media (max-width: 760px){
      h1{font-size:30px}
      .ridBar{flex-direction:column; align-items:flex-start}
      .ridActions{width:100%}
      .ridActions .miniBtn{flex:1 1 auto}
      .kRow{flex-direction:column}
      .kRow .k{min-width:0}
      .steps{grid-template-columns:1fr 1fr}
    }
  </style>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Noetfield — Status (Request ID)",
    "url":"https://www.noetfield.com/status/",
    "description":"Check Noetfield request status by Request ID. High-level routing updates only.",
    "isPartOf":{"@type":"WebSite","name":"Noetfield","url":"https://www.noetfield.com/"},
    "publisher":{"@type":"Organization","name":"Noetfield Systems Inc."}
  }
  </script>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>
  <a class="skip" href="#main">Skip to content</a>

  <header id="nfHeader"></header>

  <main id="main" class="wrap">
    <section class="hero" aria-label="Status hero">
      <div class="heroShell">
        <div class="heroInner">
          <div class="eyebrow"><span class="dot"></span> Status • Request ID tracker</div>
          <h1>Track a request by Request ID.</h1>
          <p class="lead">
            High-level routing updates only. This page is <strong>non-confidential by design</strong> and never shows sensitive details.
          </p>
        </div>
      </div>
    </section>

    <section class="grid" aria-label="Status grid">
      <!-- LEFT -->
      <section class="card" aria-label="Status lookup">
        <div class="hd">
          <h2>Status lookup</h2>
          <p>Paste a Request ID or use the saved ID from Gate.</p>

          <div class="ridBar" aria-label="Current Request ID bar">
            <div style="min-width:0">
              <div class="ridLabel">Current Request ID</div>
              <div class="ridValue mono" id="ridText">—</div>
            </div>
            <div class="ridActions">
              <button class="miniBtn" type="button" id="copyRidBtn">Copy</button>
              <button class="miniBtn" type="button" id="shareRidBtn">Share</button>
              <a class="miniBtn primary" id="openNextBtn" href="/gate/intake/">Open next step</a>
            </div>
          </div>
        </div>

        <div class="bd">
          <form id="ridForm" novalidate>
            <label for="ridInput">Request ID</label>
            <input id="ridInput" type="text" inputmode="latin" autocomplete="off" spellcheck="false" placeholder="NF-G-... or NF-P-..." />
            <div class="actions">
              <button class="btn" type="submit">Check status</button>
              <button class="btn secondary" id="useSavedBtn" type="button">Use saved ID</button>
              <button class="btn secondary" id="resetBtn" type="button">Reset</button>
              <a class="btn secondary" href="/gate/">Back to Gate</a>
            </div>
          </form>

          <div id="msg" class="msg" role="status" aria-live="polite"></div>

          <div class="resultWrap" id="resultWrap" hidden>
            <div class="stepper" aria-label="Request progress">
              <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
                <div class="badge muted" id="modeBadge"><span class="bDot" aria-hidden="true"></span><span>Preview mode</span></div>
                <div class="small" id="updatedText">Updated: —</div>
              </div>

              <div class="hr"></div>

              <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                <span class="badge ok" id="statusBadge">Received</span>
                <span class="badge muted" id="trackBadge">Track: —</span>
                <span class="badge muted" id="laneBadge">Lane: —</span>
                <span class="badge muted" id="createdBadge">Created: —</span>
              </div>

              <div class="steps" id="steps">
                <div class="step" data-step="received"><div class="k">Step 1</div><div class="v">Received</div></div>
                <div class="step" data-step="ack"><div class="k">Step 2</div><div class="v">Acknowledged</div></div>
                <div class="step" data-step="routing"><div class="k">Step 3</div><div class="v">Routing review</div></div>
                <div class="step" data-step="kickoff"><div class="k">Step 4</div><div class="v">Kickoff scheduled</div></div>
                <div class="step" data-step="secure"><div class="k">Step 5</div><div class="v">Secure exchange</div></div>
                <div class="step" data-step="delivery"><div class="k">Step 6</div><div class="v">Delivery started</div></div>
                <div class="step" data-step="closed"><div class="k">Step 7</div><div class="v">Delivered / closed</div></div>
              </div>
            </div>

            <div class="kv" aria-label="Request details (safe)">
              <div class="kRow">
                <div class="k">Next step</div>
                <div class="v" id="nextStep">—</div>
              </div>
              <div class="kRow">
                <div class="k">SLA (typical)</div>
                <div class="v" id="slaText">Acknowledgement: 1 business day • Routing: 1–2 business days</div>
              </div>
              <div class="kRow">
                <div class="k">Notes</div>
                <div class="v muted" id="notesText">—</div>
              </div>
              <div class="kRow">
                <div class="k">Share link</div>
                <div class="v">
                  <span class="mono" id="shareUrl" style="word-break:break-all;">—</span>
                </div>
              </div>
            </div>

            <div class="box">
              <strong>Non-confidential posture:</strong> This page shows status only. If fit is confirmed, a safer exchange channel can be proposed after kickoff.
            </div>

            <!-- Hidden debug tools (only ?debug=1) -->
            <div class="box" id="debugBox" hidden>
              <strong>Debug tools:</strong> simulate step (UI only).
              <div class="small" style="margin-top:8px;">Append <span class="mono">?debug=1</span> to enable.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT -->
      <aside class="card" aria-label="How it works">
        <div class="hd">
          <h2>How Status works</h2>
          <p>Clear expectations for routing.</p>
        </div>
        <div class="bd">
          <div class="box"><strong>Shows:</strong> Request ID, track/lane hints, next step, SLA windows, and non-sensitive progress.</div>
          <div class="box"><strong>Does not show:</strong> internal assessments, client data, documents, or security details.</div>

          <div class="box" style="margin-top:14px;">
            <strong>Response windows (America/Vancouver):</strong><br />
            Acknowledgement: 1 business day (typical).<br />
            Routing decision: 1–2 business days (typical).
          </div>

          <details style="margin-top:14px;">
            <summary>Lost the Request ID?</summary>
            <p>Re-submit via <a href="/gate/intake/">Gate Intake</a> to generate a new Request ID. Public intake is non-confidential by design.</p>
          </details>

          <details style="margin-top:12px;">
            <summary>Need procurement-ready start?</summary>
            <p>Use <a href="/gate/procurement/">Invoice / PO</a> for vendor onboarding, or <a href="/gate/sales/">Purchase</a> for card-ready starts.</p>
          </details>

          <div class="box" style="margin-top:14px;">
            <strong>Recommended paths:</strong><br />
            <a href="/copilot/quickscan/">Copilot QuickScan</a> ·
            <a href="/copilot/readiness/">Copilot Readiness</a> ·
            <a href="/trust-brief/">Trust Brief</a> ·
            <a href="/trust-ledger/">Trust Ledger</a>
          </div>

          <div class="box" style="margin-top:14px;">
            <strong>Security posture:</strong> Do not submit confidential information via public forms.
          </div>
        </div>
      </aside>
    </section>
  </main>

  <footer id="nfFooter"></footer>

  <script>
    (function(){
      var ridText = document.getElementById("ridText");
      var ridInput = document.getElementById("ridInput");
      var ridForm = document.getElementById("ridForm");

      var copyRidBtn = document.getElementById("copyRidBtn");
      var shareRidBtn = document.getElementById("shareRidBtn");
      var openNextBtn = document.getElementById("openNextBtn");

      var useSavedBtn = document.getElementById("useSavedBtn");
      var resetBtn = document.getElementById("resetBtn");

      var msg = document.getElementById("msg");
      var resultWrap = document.getElementById("resultWrap");

      var modeBadge = document.getElementById("modeBadge");
      var updatedText = document.getElementById("updatedText");
      var statusBadge = document.getElementById("statusBadge");
      var trackBadge = document.getElementById("trackBadge");
      var laneBadge = document.getElementById("laneBadge");
      var createdBadge = document.getElementById("createdBadge");
      var nextStep = document.getElementById("nextStep");
      var slaText = document.getElementById("slaText");
      var notesText = document.getElementById("notesText");
      var shareUrl = document.getElementById("shareUrl");

      var debugBox = document.getElementById("debugBox");

      var STEPS = ["received","ack","routing","kickoff","secure","delivery","closed"];

      var RID_CANON = "nf_rid";
      var RID_KEYS = [
        "nf_rid",
        "nf_request_id",
        "nf_gate_rid",
        "nf_partner_rid",
        "nf_gate_last_submitted_rid",
        "nf_partner_last_submitted_rid"
      ];

      function qs(name){
        try { return new URLSearchParams(window.location.search || "").get(name) || ""; }
        catch(e){ return ""; }
      }
      function norm(x){ return (x || "").trim().toLowerCase(); }

      function sanitizeRID(x){
        x = (x || "").trim();
        if (!x) return "";
        x = x.replace(/[^a-zA-Z0-9\-_]/g, "").slice(0, 80);
        return x;
      }
      function isLikelyRID(x){
        if (!x) return false;
        if (x.length < 12) return false;
        if (/^NF[-_]/i.test(x)) return (x.match(/-/g) || []).length >= 3;
        return /[-_]/.test(x);
      }

      function setMsg(text, kind){
        if (!msg) return;
        msg.style.display = "block";
        msg.textContent = text;

        if (kind === "ok") {
          msg.style.borderColor = "rgba(45,227,138,.25)";
          msg.style.background = "rgba(45,227,138,.06)";
        } else if (kind === "err") {
          msg.style.borderColor = "rgba(255,90,90,.25)";
          msg.style.background = "rgba(255,90,90,.06)";
        } else {
          msg.style.borderColor = "rgba(255,255,255,.12)";
          msg.style.background = "rgba(255,255,255,.03)";
        }
      }
      function hideMsg(){
        if (!msg) return;
        msg.style.display = "none";
        msg.textContent = "";
      }

      function fallbackCopy(text){
        try{
          var ta = document.createElement("textarea");
          ta.value = text;
          ta.setAttribute("readonly","");
          ta.style.position = "fixed";
          ta.style.left = "-9999px";
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          document.body.removeChild(ta);
          return true;
        }catch(e){ return false; }
      }

      async function copyText(text){
        try{
          if (navigator.clipboard && navigator.clipboard.writeText){
            await navigator.clipboard.writeText(text);
            return true;
          }
          return fallbackCopy(text);
        }catch(e){ return fallbackCopy(text); }
      }

      function saveRID(rid){
        try { localStorage.setItem(RID_CANON, rid); } catch(e){}
        try { localStorage.setItem("nf_gate_rid", rid); } catch(e){}
      }

      function getSavedRID(){
        for (var i=0; i<RID_KEYS.length; i++){
          try {
            var v = sanitizeRID(localStorage.getItem(RID_KEYS[i]) || "");
            if (v) return v;
          } catch(e){}
        }
        return "";
      }

      function getTrackLane(){
        var track = "";
        var lane = "";
        try { track = (localStorage.getItem("nf_gate_track") || "").trim(); } catch(e){}
        try { lane = (localStorage.getItem("nf_gate_lane") || "").trim(); } catch(e){}
        if (!lane) { try { lane = (localStorage.getItem("nf_partner_lane") || "").trim(); } catch(e){} }
        track = (track || "").trim().toLowerCase();
        lane = (lane || "").trim().toLowerCase();
        if (!track) track = "gate";
        return { track: track, lane: lane };
      }

      function inferFromRID(rid){
        var r = (rid || "").toUpperCase();
        if (r.indexOf("NF-P-") !== -1 || r.indexOf("NF-P_") !== -1) return { track: "partners", lane: "" };
        if (r.indexOf("NF-PR-") !== -1) return { track: "procurement", lane: "" };
        if (r.indexOf("QS") !== -1 || r.indexOf("QUICKSCAN") !== -1) return { track: "gate", lane: "copilot-quickscan" };
        if (r.indexOf("READINESS") !== -1) return { track: "gate", lane: "copilot-readiness" };
        if (r.indexOf("TB") !== -1 || r.indexOf("TRUSTBRIEF") !== -1) return { track: "gate", lane: "trust-brief" };
        if (r.indexOf("TL") !== -1 || r.indexOf("TRUSTLEDGER") !== -1) return { track: "gate", lane: "trust-ledger" };
        return { track: "", lane: "" };
      }

      function parseCreatedFromRID(rid){
        var m = (rid || "").match(/(\d{8})-(\d{6})/);
        if (!m) return "";
        var d = m[1], t = m[2];
        var yyyy = d.slice(0,4), mm = d.slice(4,6), dd = d.slice(6,8);
        var HH = t.slice(0,2), MI = t.slice(2,4), SS = t.slice(4,6);
        try {
          var dt = new Date(yyyy + "-" + mm + "-" + dd + "T" + HH + ":" + MI + ":" + SS);
          if (isNaN(dt.getTime())) return "";
          return dt.toLocaleString();
        } catch(e){
          return "";
        }
      }

      function nextStepFor(track, lane, rid){
        if (track === "partners") return { text: "Open Partners Gate and select a lane.", href: "/gate/partners/?rid=" + encodeURIComponent(rid) };
        if (track === "procurement") return { text: "Open Procurement path (Invoice / PO).", href: "/gate/procurement/?rid=" + encodeURIComponent(rid) };
        if (lane === "copilot-quickscan") return { text: "Copilot QuickScan — review details and intake.", href: "/copilot/quickscan/?rid=" + encodeURIComponent(rid) };
        if (lane === "copilot-readiness") return { text: "Copilot Readiness — choose tier (2/4/6 weeks).", href: "/copilot/readiness/?rid=" + encodeURIComponent(rid) };
        if (lane === "trust-brief") return { text: "Trust Brief — confirm scope and stakeholders.", href: "/trust-brief/?rid=" + encodeURIComponent(rid) };
        if (lane === "trust-ledger") return { text: "Trust Ledger — confirm evidence and cadence.", href: "/trust-ledger/?rid=" + encodeURIComponent(rid) };
        return { text: "Open Gate Intake to (re)submit and confirm routing.", href: "/gate/intake/?rid=" + encodeURIComponent(rid) };
      }

      function setActiveStep(step){
        var s = norm(step);
        if (STEPS.indexOf(s) === -1) s = "received";
        var nodes = document.querySelectorAll(".step[data-step]");
        nodes.forEach(function(n){ n.classList.remove("active"); });
        var idx = STEPS.indexOf(s);
        for (var i=0; i<=idx; i++){
          var el = document.querySelector('.step[data-step="'+STEPS[i]+'"]');
          if (el) el.classList.add("active");
        }
        return s;
      }

      function makeShareUrl(rid){
        var base = window.location.origin + "/status/";
        if (!rid) return base;
        return base + "?rid=" + encodeURIComponent(rid);
      }

      function statusLabelFor(step){
        return (step === "closed") ? "Delivered / closed" :
               (step === "delivery") ? "Delivery started" :
               (step === "secure") ? "Secure exchange" :
               (step === "kickoff") ? "Kickoff scheduled" :
               (step === "routing") ? "Routing review" :
               (step === "ack") ? "Acknowledged" :
               "Received";
      }

      function labelOrDash(x){ x = (x || "").trim(); return x ? x : "—"; }

      function render(rid){
        rid = sanitizeRID(rid);

        if (!rid || !isLikelyRID(rid)){
          if (resultWrap) resultWrap.hidden = true;
          setMsg("Enter a valid Request ID (non-confidential).", "err");
          return;
        }

        hideMsg();
        saveRID(rid);

        var meta = getTrackLane();
        var hinted = inferFromRID(rid);

        var track = meta.track || hinted.track || "gate";
        var lane  = meta.lane  || hinted.lane  || "";

        // Preview step only (MVP)
        var step = norm(qs("step"));
        if (!step) {
          try { step = norm(localStorage.getItem("nf_status_step") || ""); } catch(e){}
        }
        if (!step) step = "received";
        step = setActiveStep(step);

        var ns = nextStepFor(track, lane, rid);
        if (openNextBtn) openNextBtn.href = ns.href;

        if (modeBadge) modeBadge.innerHTML = '<span class="bDot" aria-hidden="true"></span><span>Preview mode</span>';
        if (updatedText) updatedText.textContent = "Updated: " + new Date().toLocaleString();
        if (statusBadge) statusBadge.textContent = statusLabelFor(step);

        if (trackBadge) trackBadge.textContent = "Track: " + labelOrDash(track);
        if (laneBadge)  laneBadge.textContent  = "Lane: " + labelOrDash(lane);

        var created = parseCreatedFromRID(rid);
        if (createdBadge) createdBadge.textContent = "Created: " + (created || "—");

        if (slaText) slaText.textContent = "Acknowledgement: 1 business day • Routing: 1–2 business days";

        if (nextStep){
          nextStep.innerHTML = "";
          var a = document.createElement("a");
          a.href = ns.href;
          a.textContent = ns.text;
          nextStep.appendChild(a);

          var br = document.createElement("div");
          br.style.marginTop = "6px";
          br.className = "small";
          br.innerHTML = 'If procurement required: <a href="/gate/procurement/?rid=' + encodeURIComponent(rid) + '">Invoice / PO</a> · <a href="/gate/sales/?rid=' + encodeURIComponent(rid) + '">Purchase</a>';
          nextStep.appendChild(br);
        }

        if (notesText) notesText.textContent = "Status store not connected (MVP preview). This page remains non-confidential.";
        if (shareUrl) shareUrl.textContent = makeShareUrl(rid);

        if (ridText) ridText.textContent = rid;
        if (ridInput && ridInput.value !== rid) ridInput.value = rid;

        if (resultWrap) resultWrap.hidden = false;
      }

      // Init
      var initialRID = sanitizeRID(qs("rid"));
      if (!initialRID) {
        var h = (window.location.hash || "").replace("#","").trim();
        initialRID = sanitizeRID(h);
      }
      if (!initialRID) initialRID = getSavedRID();

      if (ridText) ridText.textContent = initialRID || "—";
      if (ridInput) ridInput.value = initialRID || "";

      // Debug UI hidden unless ?debug=1
      var debug = norm(qs("debug")) === "1";
      if (debugBox) debugBox.hidden = !debug;

      if (initialRID) render(initialRID);

      if (ridForm){
        ridForm.addEventListener("submit", function(ev){
          ev.preventDefault();
          var x = sanitizeRID(ridInput ? ridInput.value : "");
          if (!x || !isLikelyRID(x)){
            if (resultWrap) resultWrap.hidden = true;
            setMsg("Please enter a valid Request ID.", "err");
            return;
          }
          render(x);
          setMsg("Loaded Request ID. Share link available.", "ok");
        });
      }

      if (useSavedBtn){
        useSavedBtn.addEventListener("click", function(){
          var saved = getSavedRID();
          if (!saved){
            if (resultWrap) resultWrap.hidden = true;
            setMsg("No saved Request ID found. Submit via Gate Intake to generate one.", "err");
            return;
          }
          render(saved);
          setMsg("Loaded saved Request ID.", "ok");
        });
      }

      if (resetBtn){
        resetBtn.addEventListener("click", function(){
          try{
            var keys = RID_KEYS.concat(["nf_gate_track","nf_gate_lane","nf_partner_lane","nf_status_step"]);
            keys.forEach(function(k){ try{ localStorage.removeItem(k); }catch(e){} });
          }catch(e){}
          if (ridText) ridText.textContent = "—";
          if (ridInput) ridInput.value = "";
          if (resultWrap) resultWrap.hidden = true;
          setActiveStep("received");
          setMsg("Reset complete. Paste a Request ID or use Gate Intake.", "ok");
        });
      }

      if (copyRidBtn){
        copyRidBtn.addEventListener("click", async function(){
          var x = sanitizeRID((ridInput && ridInput.value) ? ridInput.value : (ridText ? ridText.textContent : ""));
          if (!x || x === "—"){ setMsg("No Request ID to copy.", "err"); return; }
          var ok = await copyText(x);
          copyRidBtn.textContent = ok ? "Copied" : "Copy failed";
          setTimeout(function(){ copyRidBtn.textContent = "Copy"; }, 1200);
        });
      }

      if (shareRidBtn){
        shareRidBtn.addEventListener("click", async function(){
          var x = sanitizeRID((ridInput && ridInput.value) ? ridInput.value : (ridText ? ridText.textContent : ""));
          if (!x || x === "—"){ setMsg("No Request ID to share.", "err"); return; }

          var url = makeShareUrl(x);

          try{
            if (navigator.share){
              await navigator.share({ title: "Noetfield — Status", text: "Request status (non-confidential):", url: url });
              setMsg("Shared via system share sheet.", "ok");
              return;
            }
          }catch(e){}

          var ok = await copyText(url);
          shareRidBtn.textContent = ok ? "Link copied" : "Copy failed";
          setTimeout(function(){ shareRidBtn.textContent = "Share"; }, 1400);
          if (ok) setMsg("Shareable link copied (non-confidential).", "ok");
        });
      }
    })();
  </script>
</body>
</html>
